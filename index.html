<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brangkas - Dashboard Keuangan</title>
    <link rel="icon" type="image/png" href="/images/dsg.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --dark-bg: #0f172a;
            --dark-surface: #1e293b;
            --dark-surface-light: #334155;
            --dark-surface-lighter: #475569;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --success: #10b981;
            --success-dark: #059669;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --info: #3b82f6;
            --info-dark: #2563eb;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a2332 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-surface);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        /* Notification System - MODIFIED POSITION */
        .notification {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            transition: var(--transition);
            max-width: 380px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            margin-left: auto;
            padding: 4px;
            border-radius: 6px;
            transition: var(--transition-fast);
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Real-time Indicator */
        .real-time-indicator {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            z-index: 1000;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .real-time-indicator .pulse {
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }

    .cart-badge {
        position: absolute;
        top: 2px;
        right: 2px;
        background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        color: white;
        border-radius: 50%;
        min-width: 18px;
        height: 18px;
        font-size: 0.65rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow);
        border: 2px solid var(--dark-surface);
        line-height: 1;
        padding: 0 4px;
    }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a2332 100%);
            padding: 1rem;
        }

        .login-form {
            background: var(--dark-surface);
            padding: 2.5rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            width: 420px;
            max-width: 100%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        /* Tambahkan di section CSS */
.modal-body {
    max-height: 70vh;
    overflow-y: auto;
    padding: 0 2rem 2rem;
}

.detail-section {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: var(--dark-surface-light);
    border-radius: var(--border-radius);
}
/* Tambahkan di section CSS */
.btn-copy {
    background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
}

.btn-copy:hover {
    background: linear-gradient(135deg, #60a5fa 0%, var(--info) 100%);
}

.btn-paid {
    background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
}

.btn-paid:hover {
    background: linear-gradient(135deg, #34d399 0%, var(--success) 100%);
}

.detail-section h4 {
    margin-bottom: 1rem;
    color: var(--text-primary);
    border-bottom: 1px solid var(--dark-surface-lighter);
    padding-bottom: 0.5rem;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.detail-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.detail-value {
    color: var(--text-primary);
    text-align: right;
}

/* Tambahkan di section CSS */
.btn-info {
    background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
}

.btn-info:hover {
    background: linear-gradient(135deg, #60a5fa 0%, var(--info) 100%);
}

.items-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}

.items-table th,
.items-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--dark-surface-lighter);
}

.items-table th {
    background: var(--dark-surface);
    color: var(--text-secondary);
    font-weight: 600;
}

.items-table tr:hover {
    background: var(--dark-surface-light);
}

.status-badge {
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.summary-total {
    background: var(--dark-surface);
    padding: 1rem;
    border-radius: var(--border-radius);
    margin-top: 1rem;
    border-left: 4px solid var(--primary);
}

        .login-logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-weight: bold;
            font-size: 1.8rem;
            box-shadow: var(--shadow-lg);
        }

        .login-logo-text {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.9rem 1rem;
            background: var(--dark-bg);
            border: 1px solid var(--dark-surface-light);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 0.9rem 1.5rem;
            border-radius: var(--border-radius);
            background: var(--dark-surface-light);
            color: var(--text-primary);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #34d399 0%, var(--success) 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #f87171 0%, var(--danger) 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #fbbf24 0%, var(--warning) 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #60a5fa 0%, var(--info) 100%);
        }

        .login-footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .public-access {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--dark-surface-light);
        }

        /* Payment Status Styles */
        .payment-status {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .payment-status.lunas {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .payment-status.hutang {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .payment-status.belum {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .payment-summary {
            background: var(--dark-surface-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
        }

        .payment-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .payment-summary-item:last-child {
            margin-bottom: 0;
            font-weight: 700;
            border-top: 1px solid var(--dark-surface-lighter);
            padding-top: 0.5rem;
        }

        .public-access-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            width: 100%;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .public-access-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Main App Container */
        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--dark-surface);
            padding: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 1.3rem;
            box-shadow: var(--shadow);
        }

        .logo-text {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 0.5rem;
            position: relative;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 0.9rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            position: relative;
            font-weight: 500;
        }

        .nav-links a:hover {
            background: var(--dark-surface-light);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .nav-links a.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-links i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: transparent;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            box-shadow: var(--shadow);
        }

        .logout-btn {
            background: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
            cursor: pointer;
            padding: 0.6rem 1rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            transform: translateY(-2px);
        }

        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .card {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            padding: 1.8rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .card-title {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: var(--shadow);
        }

        .card-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .bg-primary { background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(79, 70, 229, 0.2) 100%); color: var(--primary); }
        .bg-success { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%); color: var(--success); }
        .bg-warning { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%); color: var(--warning); }
        .bg-danger { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%); color: var(--danger); }
        .bg-info { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%); color: var(--info); }

        /* Tables */
        .tables {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .table-container {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        /* Custom Confirmation Modal */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        /* Payment Badge Styles */
.payment-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-block;
    text-align: center;
    min-width: 80px;
}

.payment-badge.lunas {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
    color: var(--success);
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.payment-badge.dp {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
    color: var(--warning);
    border: 1px solid rgba(245, 158, 11, 0.3);
}

.payment-badge.belum {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
    color: var(--danger);
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.payment-badge.sebagian {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%);
    color: var(--info);
    border: 1px solid rgba(59, 130, 246, 0.3);
}

        .confirmation-modal.active {
            display: flex;
        }

        .confirmation-content {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            width: 400px;
            max-width: 95%;
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            text-align: center;
            animation: modalSlideIn 0.3s ease-out;
        }

        .confirmation-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 1.5rem;
            color: white;
        }

        .confirmation-icon.success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }

        .confirmation-icon.danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        }

        .confirmation-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .confirmation-message {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .confirmation-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirmation-btn {
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            min-width: 100px;
        }

        .confirmation-btn.cancel {
            background: var(--dark-surface-light);
            color: var(--text-primary);
            border: 1px solid var(--dark-surface-lighter);
        }

        .confirmation-btn.confirm {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
        }

        .confirmation-btn.delete {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
        }

        .confirmation-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
        }

        .table-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .table-content {
            padding: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem 0.8rem;
            text-align: left;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        th {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: var(--text-primary);
            font-weight: 500;
        }

        .status {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Charts */
        .chart-container {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Success Text */
        .success-text {
            color: var(--success);
            font-weight: 600;
        }

        .btn-sm {
            padding: 0.6rem 1rem;
            font-size: 0.85rem;
            border-radius: var(--border-radius);
        }

        /* Chart Placeholder */
        .chart-placeholder {
            height: 300px;
            background: linear-gradient(135deg, var(--dark-surface) 0%, var(--dark-surface-light) 100%);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 1.5rem;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--dark-surface-light);
            margin-top: 2rem;
        }

        /* Page Content */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Search and Filter */
        .search-filter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            border-radius: var(--border-radius);
            padding: 0.8rem 1.2rem;
            width: 320px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .search-box input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            width: 100%;
            margin-left: 0.8rem;
            outline: none;
            font-size: 0.95rem;
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .filter-options {
            display: flex;
            gap: 1rem;
        }

        /* Item Grid */
        .item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .item-card {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .item-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .item-image {
            height: 200px;
            background: linear-gradient(135deg, var(--dark-surface-light) 0%, var(--dark-surface-lighter) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            overflow: hidden;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            position: relative;
        }

        .item-image img {
            width: 140px;
            height: 140px;
            object-fit: cover;
            transition: var(--transition);
        }

        .item-card:hover .item-image img {
            transform: scale(1.05);
        }

        .item-image .placeholder {
            color: var(--text-muted);
            font-size: 3.5rem;
        }

        .item-content {
            padding: 1.5rem;
        }

        .item-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .item-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1.2rem;
            line-height: 1.5;
        }

        .item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .item-value {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--success);
        }

        .item-stock {
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--dark-surface-light);
            padding: 0.4rem 0.8rem;
            border-radius: var(--border-radius);
            font-size: 0.85rem;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Badges */
        .badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .badge-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .badge-info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%);
            color: var(--info);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .badge-secondary {
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.2) 0%, rgba(71, 85, 105, 0.2) 100%);
            color: var(--text-muted);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            width: 500px;
            max-width: 95%;
            padding: 2.5rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: var(--transition-fast);
        }

        .close-modal:hover {
            background: var(--dark-surface-light);
            color: var(--text-primary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--dark-surface-light);
            gap: 0.5rem;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .tab:hover {
            color: var(--text-primary);
            background: var(--dark-surface-light);
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            background: var(--dark-surface-light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Pesanan Styles */
        .pesanan-card {
            border-left: 4px solid var(--warning);
        }

        .pesanan-lunas {
            border-left: 4px solid var(--success);
        }

        .pesanan-hutang {
            border-left: 4px solid var(--danger);
        }

        /* Checkout Styles */
        .checkout-container {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            padding: 2.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .checkout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .checkout-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Cart Items Styles */
        .cart-items {
            margin-bottom: 2rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-btn {
            background: var(--dark-bg);
            border: none;
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .quantity-btn:hover {
            background: var(--primary);
        }

        .quantity-input {
            width: 50px;
            text-align: center;
            background: var(--dark-bg);
            border: 1px solid var(--dark-surface-lighter);
            color: var(--text-primary);
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
        }

        .remove-btn {
            background: var(--danger);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .remove-btn:hover {
            background: var(--danger-dark);
        }

        .empty-cart {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .empty-cart i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .checkout-summary {
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--dark-surface-lighter);
        }

        .summary-total {
            font-weight: 700;
            font-size: 1.2rem;
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .tables {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 1rem;
            }
            
            .main-content {
                padding: 1.5rem;
            }
            
            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .item-grid {
                grid-template-columns: 1fr;
            }
            
            .cards {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                padding: 2rem 1.5rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-radius: var(--border-radius);
                border-bottom: none;
                border-left: 3px solid transparent;
            }
            
            .tab.active {
                border-left: 3px solid var(--primary);
                border-bottom: none;
            }
        }
    </style>
</head>
<body>
    <!-- Notification System -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <i class="fas fa-info-circle"></i>
            <span id="notification-message">Pesan notifikasi</span>
            <button class="notification-close" onclick="hideNotification()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Real-time Indicator -->
    <div id="real-time-indicator" class="real-time-indicator">
        <div class="pulse"></div>
        <span>Real-time Active</span>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="login-container" style="display: none;">
        <div class="login-form">
            <div class="login-logo">
                <div class="login-logo-icon">
                    <i class="fas fa-vault"></i>
                </div>
                <div class="login-logo-text">Brangkas</div>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="form-control" placeholder="Masukkan email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login Admin
                    </button>
                </div>
            </form>
            <div class="public-access">
                <button class="public-access-btn" id="public-access-btn">
                    <i class="fas fa-eye"></i> Akses sebagai Pembeli
                </button>
            </div>
            <div class="login-footer">
                &copy; DSG JAYA JAYA JAYA
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-vault"></i>
                </div>
                <div class="logo-text">Brangkas</div>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a></li>
                <li><a href="#" class="nav-link" data-page="barang-brangkas">
                    <i class="fas fa-box"></i> Barang Brangkas
                </a></li>
                <li><a href="#" class="nav-link" data-page="pemesanan">
                    <i class="fas fa-shopping-cart"></i> Pemesanan 
                    <span id="cart-count-badge" class="cart-badge" style="display: none;">0</span>
                </a></li>
                <li id="admin-keuangan" style="display: none;"><a href="#" class="nav-link" data-page="keuangan">
                    <i class="fas fa-chart-pie"></i> Keuangan
                </a></li>
                <li><a href="#" class="nav-link" data-page="laporan">
                    <i class="fas fa-chart-bar"></i> Laporan
                </a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard-page">
                <div class="header">
                    <h1>Dashboard</h1>
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <button class="logout-btn" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <!-- Cards -->
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Barang Brangkas</div>
                            <div class="card-icon bg-primary">
                                <i class="fas fa-box"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-barang">0</div>
                        <div class="card-desc">Jumlah barang tersedia</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Nilai Barang</div>
                            <div class="card-icon bg-success">
                                <i class="fas fa-coins"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-nilai">$ 0</div>
                        <div class="card-desc">Nilai total inventory</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pesanan Aktif</div>
                            <div class="card-icon bg-warning">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-pesanan">0</div>
                        <div class="card-desc">Pesanan dalam proses</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Keuangan</div>
                            <div class="card-icon bg-info">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-keuangan">$ 0</div>
                        <div class="card-desc">Saldo kas saat ini</div>
                    </div>
                </div>

                <!-- Tables -->
                <div class="tables">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Barang Terbaru</div>
                            <button class="btn btn-primary btn-sm" onclick="showPage('barang-brangkas')">
                                <i class="fas fa-eye"></i> Lihat Semua
                            </button>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nama Barang</th>
                                        <th>Kategori</th>
                                        <th>Stok</th>
                                        <th>Nilai</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-barang">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Terbaru</div>
                            <button class="btn btn-primary btn-sm" onclick="showPage('pemesanan')">
                                <i class="fas fa-eye"></i> Lihat Semua
                            </button>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Customer</th>
                                        <th>Status</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-pesanan">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Grafik Nilai Barang per Kategori</div>
                        <div class="chart-actions">
                            <button class="btn btn-primary btn-sm" id="refresh-chart">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-pie"></i> Grafik akan ditampilkan di sini
                    </div>
                </div>
            </div>

            <!-- Barang Brangkas Page -->
            <div class="page" id="barang-brangkas-page">
                <div class="header">
                    <h1>Barang Brangkas</h1>
                    <div class="user-info">
                        <button class="btn btn-primary" id="tambah-barang-btn">
                            <i class="fas fa-plus"></i> Tambah Barang
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-barang" placeholder="Cari barang...">
                    </div>
                    <div class="filter-options">
                        <select id="filter-kategori" class="form-control">
                            <option value="">Semua Kategori</option>
                            <option value="Class 1">Class 1</option>
                            <option value="Class 2">Class 2</option>
                            <option value="Narcotics">Narcotics</option>
                            <option value="Heist-Stuff">Heist Stuff</option>
                            <option value="Ammo">Ammo</option>
                            <option value="Armor">Armor</option>
                            <option value="Attachment">Attachment</option>
                        </select>
                    </div>
                </div>

                <!-- Item Grid -->
                <div class="item-grid" id="barang-grid">
                    <!-- Data barang akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Pemesanan Page -->
            <div class="page" id="pemesanan-page">
                <div class="header">
                    <h1>Pemesanan</h1>
                    <div class="user-info">
                        <button class="btn btn-info" id="copy-all-pending-btn">
                            <i class="fas fa-copy"></i> Copy Semua Pending
                        </button>
                        <button class="btn btn-primary" id="buat-pesanan-btn">
                            <i class="fas fa-plus"></i> Buat Pesanan
                        </button>
                        <button class="btn btn-success" id="checkout-btn" style="display: none;">
                            <i class="fas fa-cash-register"></i> Checkout 
                            <span id="cart-count" class="cart-badge">0</span>
                        </button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="semua-pesanan">Semua Pesanan</div>
                    <div class="tab" data-tab="pesanan-aktif">Pesanan Aktif</div>
                    <div class="tab" data-tab="pesanan-lunas">Lunas</div>
                    <div class="tab" data-tab="pesanan-hutang">Hutang</div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content active" id="semua-pesanan-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Daftar Semua Pesanan</div>
                        </div>
                        <div class="table-content">
                            <table>
<!-- Di semua table header pesanan, tambahkan kolom baru: -->
<thead>
    <tr>
        <th>ID Pesanan</th>
        <th>Tanggal</th>
        <th>Customer</th>
        <th>Items</th>
        <th>Total</th>
        <th>Status</th>
        <th>Pembayaran</th> <!-- KOLOM BARU -->
        <th>Aksi</th>
    </tr>
</thead>
                                <tbody id="semua-pesanan-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="pesanan-aktif-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Aktif</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Tanggal</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pesanan-aktif-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="pesanan-lunas-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Lunas</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Tanggal</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pesanan-lunas-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="pesanan-hutang-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Hutang</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Tanggal</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Sisa</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pesanan-hutang-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checkout Page -->
            <div class="page" id="checkout-page">
                <div class="header">
                    <h1>Checkout Pesanan</h1>
                    <div class="user-info">
                        <button class="btn btn-primary" id="kembali-pesanan-btn">
                            <i class="fas fa-arrow-left"></i> Kembali ke Pemesanan
                        </button>
                    </div>
                </div>

                <div class="checkout-container">
                    <div class="checkout-header">
                        <div class="checkout-title">Keranjang Belanja</div>
                        <button class="btn btn-danger" id="kosongkan-keranjang-btn">
                            <i class="fas fa-trash"></i> Kosongkan Keranjang
                        </button>
                    </div>

                    <div class="cart-items" id="cart-items">
                        <!-- Item keranjang akan diisi oleh JavaScript -->
                    </div>

                    <div class="checkout-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotal">$ 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Diskon:</span>
                            <span id="diskon">$ 0</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total:</span>
                            <span id="total-checkout">$ 0</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customer-name">Nama Customer</label>
                        <input type="text" id="customer-name" class="form-control" placeholder="Masukkan nama customer">
                    </div>
                    <div class="form-group">
                        <label for="status-pembayaran">Status Pembayaran</label>
                        <select id="status-pembayaran" class="form-control" onchange="toggleUangDibayar()">
                            <option value="belum">Belum Bayar</option>
                            <option value="lunas">Lunas</option>
                        </select>
                    </div>

                    <div class="form-group" id="uang-dibayar-group" style="display: none;">
                        <label for="uang-dibayar">Uang Dibayar ($)</label>
                        <input type="number" id="uang-dibayar" class="form-control" placeholder="0" min="0" value="0">
                    </div>

                    <div class="form-group" id="keterangan-pembayaran-group" style="display: none;">
                        <label for="keterangan-pembayaran">Keterangan Pembayaran</label>
                        <textarea id="keterangan-pembayaran" class="form-control" placeholder="Tambahkan keterangan pembayaran (opsional)" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="keterangan">Keterangan</label>
                        <textarea id="keterangan" class="form-control" placeholder="Tambahkan keterangan pesanan"></textarea>
                    </div>

                    <div class="form-group">
                        <button class="btn btn-success btn-block" id="proses-checkout-btn">
                            <i class="fas fa-check"></i> Proses Checkout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Keuangan Page -->
            <div class="page" id="keuangan-page">
                <div class="header">
                    <h1>Manajemen Keuangan</h1>
                    <div class="user-info">
                        <button class="btn btn-primary" id="tambah-transaksi-btn">
                            <i class="fas fa-plus"></i> Tambah Transaksi
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Saldo Kas</div>
                            <div class="card-icon bg-primary">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="saldo-kas">$ 0</div>
                        <div class="card-desc">Total saldo saat ini</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pemasukan Bulan Ini</div>
                            <div class="card-icon bg-success">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pemasukan-bulan">$ 0</div>
                        <div class="card-desc">Total pemasukan bulan ini</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pengeluaran Bulan Ini</div>
                            <div class="card-icon bg-danger">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pengeluaran-bulan">$ 0</div>
                        <div class="card-desc">Total pengeluaran bulan ini</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Laba Bulan Ini</div>
                            <div class="card-icon bg-info">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laba-bulan">$ 0</div>
                        <div class="card-desc">Laba bersih bulan ini</div>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-keuangan" placeholder="Cari transaksi...">
                    </div>
                    <div class="filter-options">
                        <select id="filter-jenis" class="form-control">
                            <option value="">Semua Jenis</option>
                            <option value="pemasukan">Pemasukan</option>
                            <option value="pengeluaran">Pengeluaran</option>
                        </select>
                        <input type="month" id="filter-bulan" class="form-control">
                    </div>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Riwayat Transaksi</div>
                        <div class="action-buttons">
                            <button class="btn btn-success btn-sm">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th>Jenis</th>
                                    <th>Jumlah</th>
                                    <th>Saldo</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="transaksi-table">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Laporan Page -->
            <div class="page" id="laporan-page">
                <div class="header">
                    <h1>Laporan</h1>
                    <div class="user-info">
                        <button class="btn btn-success">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                </div>

                <!-- Filter Options -->
                <div class="search-filter">
                    <div class="filter-options">
                        <span class="filter-label">Periode:</span>
                        <input type="month" id="laporan-bulan" class="form-control">
                        <button class="btn btn-primary" id="generate-laporan-btn">
                            <i class="fas fa-sync-alt"></i> Generate Laporan
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Pemasukan</div>
                            <div class="card-icon bg-success">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-pemasukan">$ 0</div>
                        <div class="card-desc">Total pemasukan periode</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Pengeluaran</div>
                            <div class="card-icon bg-danger">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-pengeluaran">$ 0</div>
                        <div class="card-desc">Total pengeluaran periode</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Laba Bersih</div>
                            <div class="card-icon bg-info">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-laba">$ 0</div>
                        <div class="card-desc">Laba bersih periode</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Pesanan</div>
                            <div class="card-icon bg-warning">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-pesanan">0</div>
                        <div class="card-desc">Jumlah pesanan periode</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="chart-container" id="laporan-charts">
                    <div class="chart-header">
                        <div class="chart-title">Grafik Laporan Keuangan</div>
                    </div>
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-bar"></i> Grafik laporan akan ditampilkan di sini
                    </div>
                </div>

                <!-- Tables -->
                <div class="tables">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Transaksi Keuangan</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Keterangan</th>
                                        <th>Jenis</th>
                                        <th>Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody id="laporan-transaksi-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Customer</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="laporan-pesanan-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                &copy; 2025 DSG on TOP
            </div>
        </div>
    </div>

    <!-- Modal Tambah Barang -->
    <div class="modal" id="tambah-barang-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Tambah Barang Baru</div>
                <button class="close-modal" onclick="closeModal('tambah-barang-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="tambah-barang-form">
                <div class="form-group">
                    <label for="nama-barang">Nama Barang</label>
                    <input type="text" id="nama-barang" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="kategori-barang">Kategori</label>
                    <select id="kategori-barang" class="form-control" required>
                            <option value="">Semua Kategori</option>
                            <option value="Class 1">Class 1</option>
                            <option value="Class 2">Class 2</option>
                            <option value="Narcotics">Narcotics</option>
                            <option value="Heist-Stuff">Heist Stuff</option>
                            <option value="Ammo">Ammo</option>
                            <option value="Armor">Armor</option>
                            <option value="Attachment">Attachment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="harga-barang">Harga ($)</label>
                    <input type="number" id="harga-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="stok-barang">Stok</label>
                    <input type="number" id="stok-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="deskripsi-barang">Deskripsi</label>
                    <textarea id="deskripsi-barang" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">Simpan Barang</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Edit Barang -->
    <div class="modal" id="edit-barang-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Barang</div>
                <button class="close-modal" onclick="closeModal('edit-barang-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-barang-form">
                <input type="hidden" id="edit-barang-id">
                <div class="form-group">
                    <label for="edit-nama-barang">Nama Barang</label>
                    <input type="text" id="edit-nama-barang" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="edit-kategori-barang">Kategori</label>
                    <select id="edit-kategori-barang" class="form-control" required>
                            <option value="">Semua Kategori</option>
                            <option value="Class 1">Class 1</option>
                            <option value="Class 2">Class 2</option>
                            <option value="Narcotics">Narcotics</option>
                            <option value="Heist-Stuff">Heist Stuff</option>
                            <option value="Ammo">Ammo</option>
                            <option value="Armor">Armor</option>
                            <option value="Attachment">Attachment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-harga-barang">Harga ($)</label>
                    <input type="number" id="edit-harga-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="edit-stok-barang">Stok</label>
                    <input type="number" id="edit-stok-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="edit-deskripsi-barang">Deskripsi</label>
                    <textarea id="edit-deskripsi-barang" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">Update Barang</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Tambah Transaksi -->
    <div class="modal" id="tambah-transaksi-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Tambah Transaksi</div>
                <button class="close-modal" onclick="closeModal('tambah-transaksi-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="tambah-transaksi-form">
                <div class="form-group">
                    <label for="jenis-transaksi">Jenis Transaksi</label>
                    <select id="jenis-transaksi" class="form-control" required>
                        <option value="">Pilih Jenis</option>
                        <option value="pemasukan">Pemasukan</option>
                        <option value="pengeluaran">Pengeluaran</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="jumlah-transaksi">Jumlah ($)</label>
                    <input type="number" id="jumlah-transaksi" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="keterangan-transaksi">Keterangan</label>
                    <textarea id="keterangan-transaksi" class="form-control" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="tanggal-transaksi">Tanggal</label>
                    <input type="date" id="tanggal-transaksi" class="form-control" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">Simpan Transaksi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // ===============================
        // MAPPING GAMBAR BARANG - LENGKAP
        // ===============================
        const gambarBarang = {
            'ceramic': 'images/ceramic.png',
            'glock': 'images/glock.png',
            'blue': 'images/armor.png',
            'mini smg': 'images/mini.png',
            'submachine': 'images/smg.png',
            'p50': 'images/DE.png',
            'black revolver': 'images/black.png',
            'micro': 'images/micro.png',
            'shotgun': 'images/shotgun.png',
            'navy': 'images/navy.png',
            'tec9': 'images/tec9.png',
            '.44': 'images/ammo44.png',
            '.9mm': 'images/9mm.png',
            '.50': 'images/ammo50.png',
            'sg': 'images/sg.png',
            'seeds': 'images/canabis.png',
            'baggy': 'images/baggy.png',
            'lockpick': 'images/lp.png',
            'flashlight': 'images/tf.png',
            'supresor': 'images/supre.png',
            'tactical': 'images/tsupre.png',
            'grip': 'images/grip.png',
            'clip': 'images/clip.png',
            'drum': 'images/drum.png',
            'extended': 'images/extended.png',
            'scope': 'images/scope.png',
            'meth': 'images/meth.png',
            'red': 'images/red.png',
            'tablet': 'images/tablet.png',
            'meja': 'images/meja.png',
            // Fallback dan default
            'default': 'images/default.jpg'
        };

        // Fungsi untuk mendapatkan path gambar berdasarkan nama barang
        function getGambarBarang(namaBarang) {
            if (!namaBarang) return gambarBarang.default;
            
            const namaLower = namaBarang.toLowerCase();
            
            // Cek kata kunci dalam nama barang
            for (const [keyword, path] of Object.entries(gambarBarang)) {
                if (namaLower.includes(keyword.toLowerCase())) {
                    return path;
                }
            }
            
            // Default image jika tidak ditemukan
            return gambarBarang.default;
        }

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyApaIrtIi2FHY4gMlvC_hOfIT8jxiAC_84",
            authDomain: "brangkas-b589c.firebaseapp.com",
            databaseURL: "https://brangkas-b589c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "brangkas-b589c",
            storageBucket: "brangkas-b589c.firebasestorage.app",
            messagingSenderId: "299756262395",
            appId: "1:299756262395:web:ef8cfc8c89a51ba53eb15e",
            measurementId: "G-L94TPZ82Q7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Data barang dan transaksi
        let barangData = [];
        let transaksiData = [];
        let pesananData = [];
        let isAdmin = false;
        let currentUser = null;
        let cart = [];

        // ===============================
        // AUTO REFRESH REAL-TIME SYSTEM
        // ===============================
        
        // Setup real-time listeners untuk auto refresh
        function setupRealtimeListeners() {
            // Listen untuk perubahan data barang
            database.ref('barang').on('value', (snapshot) => {
                const newBarangData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const barang = childSnapshot.val();
                        barang.id = childSnapshot.key;
                        // Pastikan harga berupa number
                        if (barang.harga && typeof barang.harga === 'string') {
                            barang.harga = parseInt(barang.harga.replace(/\D/g, '')) || 0;
                        }
                        newBarangData.push(barang);
                    });
                }
                
                // Update hanya jika ada perubahan
                if (JSON.stringify(barangData) !== JSON.stringify(newBarangData)) {
                    barangData = newBarangData;
                    updateDashboard();
                    updateBarangUI();
                    console.log('🔄 Data barang diperbarui secara real-time');
                }
            });

             // Checkout button - dengan error handling
            const checkoutBtn = document.getElementById('checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function() {
                    console.log('🛒 Tombol checkout diklik');
                    if (cart.length === 0) {
                        showNotification('Keranjang masih kosong!', 'error');
                        return;
                    }
                    showPage('checkout');
                });
            } else {
                console.error('❌ Tombol checkout tidak ditemukan');
            }

            // Kembali ke pesanan dari checkout
            const kembaliBtn = document.getElementById('kembali-pesanan-btn');
            if (kembaliBtn) {
                kembaliBtn.addEventListener('click', function() {
                    showPage('pemesanan');
                });
            }

            // Listen untuk perubahan data pesanan
            database.ref('pesanan').on('value', (snapshot) => {
                const newPesananData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const pesanan = childSnapshot.val();
                        pesanan.id = childSnapshot.key;
                        if (pesanan.sudah_dikasih === undefined) {
                            pesanan.sudah_dikasih = false;
                        }
                        newPesananData.push(pesanan);
                    });
                }
                
                if (JSON.stringify(pesananData) !== JSON.stringify(newPesananData)) {
                    pesananData = newPesananData;
                    updateDashboard();
                    updatePesananUI();
                    updateLaporan();
                    console.log('🔄 Data pesanan diperbarui secara real-time');
                }
            });

            // Listen untuk perubahan data transaksi
            database.ref('transaksi').on('value', (snapshot) => {
                const newTransaksiData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const transaksi = childSnapshot.val();
                        transaksi.id = childSnapshot.key;
                        newTransaksiData.push(transaksi);
                    });
                }
                
                if (JSON.stringify(transaksiData) !== JSON.stringify(newTransaksiData)) {
                    transaksiData = newTransaksiData;
                    updateDashboard();
                    updateTransaksiUI();
                    console.log('🔄 Data transaksi diperbarui secara real-time');
                }
            });
        }

        // ===============================
        // CONFIRMATION MODAL SYSTEM
        // ===============================

        let currentConfirmationCallback = null;
        let currentDeleteCallback = null;

        // Show confirmation modal
        function showConfirmation(message, callback, type = 'confirm') {
            const modal = document.getElementById('confirmation-modal');
            const messageElement = document.getElementById('confirmation-message');
            const iconElement = document.getElementById('confirmation-icon');
            const confirmBtn = document.getElementById('confirmation-confirm-btn');
            
            messageElement.textContent = message;
            currentConfirmationCallback = callback;
            
            // Set icon and button based on type
            if (type === 'success') {
                iconElement.className = 'confirmation-icon success';
                iconElement.innerHTML = '<i class="fas fa-check"></i>';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> Ya';
            } else if (type === 'warning') {
                iconElement.className = 'confirmation-icon';
                iconElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> Ya';
            } else {
                iconElement.className = 'confirmation-icon';
                iconElement.innerHTML = '<i class="fas fa-question"></i>';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> Ya';
            }
            
            modal.classList.add('active');
        }

        // ===============================
// NEW FUNCTIONS FOR PAYMENT AND COPY FEATURES
// ===============================

// Fungsi untuk menandai pesanan sudah dibayar lunas
function markPesananAsPaid(pesananId) {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menandai pesanan sudah dibayar!', 'error');
        return;
    }
    
    const pesanan = pesananData.find(p => p.id === pesananId);
    if (!pesanan) return;
    
    showConfirmation(
        `Tandai pesanan ${pesanan.id} sebagai LUNAS?
            Customer: ${pesanan.customer}
            Total: ${formatDollar(pesanan.total)}
            Uang dibayar akan disesuaikan menjadi ${formatDollar(pesanan.total)}`,
        function() {
            // Update status menjadi lunas dengan uang dibayar sama dengan total
            database.ref('pesanan/' + pesananId).update({
                status_pembayaran: 'lunas',
                uang_dibayar: pesanan.total,
                status: 'lunas'
            })
            .then(() => {
                showNotification(`Pesanan ${pesanan.id} berhasil ditandai sebagai LUNAS!`, 'success');
                closeModal('detail-pesanan-modal');
                
                // Jika ada transaksi terkait, update juga
                addTransaksiFromPesanan(pesanan);
            })
            .catch(error => {
                showNotification('Gagal memperbarui status pembayaran: ' + error.message, 'error');
            });
        },
        'warning'
    );
}

// Fungsi untuk menambahkan transaksi dari pesanan yang sudah dibayar
function addTransaksiFromPesanan(pesanan) {
    const newTransaksi = {
        jenis: 'pemasukan',
        jumlah: pesanan.total,
        keterangan: `Pembayaran pesanan ${pesanan.id} dari ${pesanan.customer}`,
        tanggal: new Date().toISOString().split('T')[0],
        created_at: new Date().toISOString(),
        related_pesanan: pesanan.id
    };
    
    // Save to Firebase
    database.ref('transaksi').push(newTransaksi)
        .then(() => {
            console.log('✅ Transaksi pembayaran berhasil ditambahkan');
        })
        .catch(error => {
            console.error('❌ Gagal menambah transaksi pembayaran:', error);
        });
}

// ===============================
// NEW FUNCTION FOR COPY ALL PENDING ORDERS
// ===============================

// Fungsi untuk menyalin semua item dari pesanan yang belum diproses
function copyAllPendingOrders() {
    // Filter pesanan yang belum diproses (belum dikasih)
    const pendingPesanan = pesananData.filter(p => !p.sudah_dikasih);
    
    if (pendingPesanan.length === 0) {
        showNotification('Tidak ada pesanan yang belum diproses!', 'info');
        return;
    }
    
    // Gabungkan semua items dari pesanan pending
    const allItems = [];
    
    pendingPesanan.forEach(pesanan => {
        pesanan.items.forEach(item => {
            // Cek apakah item sudah ada di allItems
            const existingItem = allItems.find(i => i.nama === item.nama);
            
            if (existingItem) {
                // Jika sudah ada, tambahkan quantity
                existingItem.quantity += item.quantity;
            } else {
                // Jika belum ada, tambahkan item baru
                allItems.push({
                    nama: item.nama,
                    quantity: item.quantity
                });
            }
        });
    });
    
    if (allItems.length === 0) {
        showNotification('Tidak ada items dalam pesanan pending!', 'info');
        return;
    }
    
    // Format teks untuk disalin
    let itemsText = `ITEMS PESANAN PENDING (${pendingPesanan.length} pesanan)\n\n`;
    
    allItems.forEach((item, index) => {
        itemsText += `${item.nama} - ${item.quantity}x\n`;
    });
    
    // Tambahkan ringkasan
    itemsText += `\n-------------------\n`;
    itemsText += `Total Items: ${allItems.length} jenis\n`;
    itemsText += `Total Pesanan: ${pendingPesanan.length} pesanan`;
    
    // Salin ke clipboard
    navigator.clipboard.writeText(itemsText)
        .then(() => {
            showNotification(`Berhasil menyalin ${allItems.length} items dari ${pendingPesanan.length} pesanan pending!`, 'success');
        })
        .catch(err => {
            console.error('Gagal menyalin teks: ', err);
            fallbackCopyTextToClipboard(itemsText);
        });
}

// Versi alternatif jika ingin format yang lebih sederhana
function copyAllPendingOrdersSimple() {
    const pendingPesanan = pesananData.filter(p => !p.sudah_dikasih);
    
    if (pendingPesanan.length === 0) {
        showNotification('Tidak ada pesanan yang belum diproses!', 'info');
        return;
    }
    
    const allItems = [];
    
    pendingPesanan.forEach(pesanan => {
        pesanan.items.forEach(item => {
            const existingItem = allItems.find(i => i.nama === item.nama);
            if (existingItem) {
                existingItem.quantity += item.quantity;
            } else {
                allItems.push({
                    nama: item.nama,
                    quantity: item.quantity
                });
            }
        });
    });
    
    if (allItems.length === 0) {
        showNotification('Tidak ada items dalam pesanan pending!', 'info');
        return;
    }
    
    // Format sederhana hanya items dan quantity
    let itemsText = ``;
    
    allItems.forEach(item => {
        itemsText += `${item.nama} - ${item.quantity}x\n`;
    });
    
    navigator.clipboard.writeText(itemsText)
        .then(() => {
            showNotification(`Berhasil menyalin ${allItems.length} items!`, 'success');
        })
        .catch(err => {
            console.error('Gagal menyalin teks: ', err);
            fallbackCopyTextToClipboard(itemsText);
        });
}

// Fungsi untuk menyalin items pesanan ke clipboard
function copyPesananItems(pesanan) {
    // Format teks untuk disalin - HANYA ITEM DAN QUANTITY
    let itemsText = ``;
    
    pesanan.items.forEach((item, index) => {
        itemsText += `${item.nama} - ${item.quantity}x\n`;
    });
    
    // Salin ke clipboard
    navigator.clipboard.writeText(itemsText)
        .then(() => {
            showNotification('Items pesanan berhasil disalin ke clipboard!', 'success');
        })
        .catch(err => {
            console.error('Gagal menyalin teks: ', err);
            // Fallback untuk browser yang tidak support clipboard API
            fallbackCopyTextToClipboard(itemsText);
        });
}

        // Fallback untuk menyalin teks (untuk browser lama)
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification('Items pesanan berhasil disalin ke clipboard!', 'success');
                } else {
                    showNotification('Gagal menyalin items pesanan!', 'error');
                }
            } catch (err) {
                console.error('Fallback copy gagal: ', err);
                showNotification('Gagal menyalin items pesanan!', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // Hide confirmation modal
        function hideConfirmation() {
            document.getElementById('confirmation-modal').classList.remove('active');
            currentConfirmationCallback = null;
        }

        // Show delete confirmation modal
        function showDeleteConfirmation(message, callback) {
            const modal = document.getElementById('delete-confirmation-modal');
            const messageElement = document.getElementById('delete-confirmation-message');
            
            messageElement.textContent = message;
            currentDeleteCallback = callback;
            modal.classList.add('active');
        }

        // Hide delete confirmation modal
        function hideDeleteConfirmation() {
            document.getElementById('delete-confirmation-modal').classList.remove('active');
            currentDeleteCallback = null;
        }

        // Setup confirmation button handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Confirmation modal
            document.getElementById('confirmation-confirm-btn').addEventListener('click', function() {
                if (currentConfirmationCallback) {
                    currentConfirmationCallback();
                }
                hideConfirmation();
            });
            
            // Delete confirmation modal
            document.getElementById('delete-confirm-btn').addEventListener('click', function() {
                if (currentDeleteCallback) {
                    currentDeleteCallback();
                }
                hideDeleteConfirmation();
            });
            
            // Close modals when clicking outside
            document.getElementById('confirmation-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideConfirmation();
                }
            });
            
            document.getElementById('delete-confirmation-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideDeleteConfirmation();
                }
            });
        });

        // ===============================
        // AUTHENTICATION SYSTEM
        // ===============================

        // Admin credentials
        const adminUsers = {
            'admin@brangkas.com': {
                password: 'admin123',
                name: 'Admin Brangkas',
                role: 'Administrator'
            }
        };

        // Initialize app for public access
        function initializeApp() {
            // Cek status login dari localStorage
            const savedUser = localStorage.getItem('brangkas_user');
            const savedAdmin = localStorage.getItem('brangkas_admin');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isAdmin = savedAdmin === 'true';
                showApp();
            } else {
                showLogin();
            }
        }

        function setupEventListeners() {
            setupPaymentListeners();
            const statusPembayaranElement = document.getElementById('status-pembayaran');
                if (statusPembayaranElement) {
                    statusPembayaranElement.addEventListener('change', toggleUangDibayar);
                }

            // Login form
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('public-access-btn').addEventListener('click', handlePublicAccess);
            
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });

            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Modal buttons
            document.getElementById('tambah-barang-btn').addEventListener('click', function() {
                showModal('tambah-barang-modal');
            });

             document.getElementById('copy-all-pending-btn').addEventListener('click', function() {
                copyAllPendingOrders();
            });

            document.getElementById('tambah-transaksi-btn').addEventListener('click', function() {
                showModal('tambah-transaksi-modal');
            });

            document.getElementById('buat-pesanan-btn').addEventListener('click', function() {
                showPage('barang-brangkas');
            });

            document.getElementById('checkout-btn').addEventListener('click', function() {
                showPage('checkout-page');
            });

            document.getElementById('kembali-pesanan-btn').addEventListener('click', function() {
                showPage('pemesanan');
            });

            document.getElementById('copy-items-btn').addEventListener('click', function() {
                // Handler sudah diatur di viewPesananDetail
            });

            document.getElementById('mark-paid-btn').addEventListener('click', function() {
                // Handler sudah diatur di viewPesananDetail
            });

            document.getElementById('kosongkan-keranjang-btn').addEventListener('click', function() {
                kosongkanKeranjang();
            });

            document.getElementById('proses-checkout-btn').addEventListener('click', function() {
                prosesCheckout();
            });

            // Forms
            document.getElementById('tambah-barang-form').addEventListener('submit', handleTambahBarang);
            document.getElementById('edit-barang-form').addEventListener('submit', handleEditBarang);
            document.getElementById('tambah-transaksi-form').addEventListener('submit', handleTambahTransaksi);

            // Logout
            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            // Real-time listeners
            setupRealtimeListeners();
        }

        // Fungsi-fungsi UI
        function showLogin() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        function showApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            
            // Tampilkan/hide menu admin berdasarkan role
            document.getElementById('admin-keuangan').style.display = isAdmin ? 'block' : 'none';
            
            // Update UI awal
            updateDashboard();
            updateBarangUI();
            updatePesananUI();
            if (isAdmin) {
                updateTransaksiUI();
            }
            
            showNotification('Selamat datang di Brangkas!', 'success');
        }

        function showPage(pageId) {
            try {
                console.log('🔄 Menampilkan halaman:', pageId);
                
                // Sembunyikan semua halaman
                document.querySelectorAll('.page').forEach(page => {
                    if (page && page.classList) {
                        page.classList.remove('active');
                    }
                });
                
                // Cek apakah halaman yang diminta ada
                const pageElement = document.getElementById(`${pageId}-page`);
                if (!pageElement) {
                    console.error(`❌ Halaman ${pageId} tidak ditemukan (${pageId}-page)`);
                    // Fallback ke dashboard
                    pageId = 'dashboard';
                }
                
                // Tampilkan halaman yang dipilih
                const targetPage = document.getElementById(`${pageId}-page`);
                if (targetPage && targetPage.classList) {
                    targetPage.classList.add('active');
                } else {
                    console.error(`❌ Tidak dapat menampilkan halaman ${pageId}`);
                    return;
                }
                
                // Update nav link active state
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link && link.classList) {
                        link.classList.remove('active');
                        if (link.getAttribute('data-page') === pageId) {
                            link.classList.add('active');
                        }
                    }
                });
                
                // Update cart badge
                updateCartBadge();
                
                // Jika pindah ke checkout page, update UI-nya
                if (pageId === 'checkout') {
                    updateCheckoutPage();
                }
                
                console.log('✅ Halaman berhasil ditampilkan:', pageId);
                
            } catch (error) {
                console.error('❌ Error dalam showPage:', error);
                // Fallback ke dashboard jika ada error
                try {
                    document.querySelectorAll('.page').forEach(page => {
                        if (page && page.classList) {
                            page.classList.remove('active');
                        }
                    });
                    const dashboardPage = document.getElementById('dashboard-page');
                    if (dashboardPage && dashboardPage.classList) {
                        dashboardPage.classList.add('active');
                    }
                } catch (fallbackError) {
                    console.error('❌ Error fallback:', fallbackError);
                }
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function switchTab(tabId) {
            // Update tab active state
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            
            // Set message and type
            messageElement.textContent = message;
            notification.className = `notification ${type}`;
            
            // Show notification
            notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // Fungsi-fungsi Authentication
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simulasi login admin
            if (email === 'dsg@brangkas.com' && password === 'dsgjaya') {
                currentUser = { email: email, name: 'Administrator' };
                isAdmin = true;
                
                // Simpan ke localStorage
                localStorage.setItem('brangkas_user', JSON.stringify(currentUser));
                localStorage.setItem('brangkas_admin', 'true');
                
                showApp();
            } else {
                showNotification('Email atau password salah!', 'error');
            }
        }

        function handlePublicAccess() {
            currentUser = { email: 'public@brangkas.com', name: 'Pengguna Biasa' };
            isAdmin = false;
            
            // Simpan ke localStorage
            localStorage.setItem('brangkas_user', JSON.stringify(currentUser));
            localStorage.setItem('brangkas_admin', 'false');
            
            showApp();
        }

        function handleLogout() {
            currentUser = null;
            isAdmin = false;
            
            // Hapus dari localStorage
            localStorage.removeItem('brangkas_user');
            localStorage.removeItem('brangkas_admin');
            
            // Reset cart
            cart = [];
            saveCartToStorage();
            updateCartUI();
            
            showLogin();
            showNotification('Anda telah logout', 'info');
        }

        // ===============================
        // CART MANAGEMENT - IMPROVED DENGAN AUTO REFRESH
        // ===============================

        // Load cart from localStorage
        function loadCartFromStorage() {
            const savedCart = localStorage.getItem('brangkas_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
            updateCartUI();
        }

        // Save cart to localStorage
        function saveCartToStorage() {
            localStorage.setItem('brangkas_cart', JSON.stringify(cart));
        }

        // Add item to cart dengan real-time update
        function addToCart(barangId, jumlah = 1) {
            const barang = barangData.find(b => b.id === barangId);
            if (!barang) {
                showNotification('Barang tidak ditemukan!', 'error');
                return;
            }

            // Check stok
            if (barang.stok < jumlah) {
                showNotification(`Stok ${barang.nama} tidak mencukupi! Stok tersedia: ${barang.stok}`, 'error');
                return;
            }

            // Check if item already in cart
            const existingItem = cart.find(item => item.id === barangId);
            if (existingItem) {
                // Update quantity
                existingItem.quantity += jumlah;
                if (existingItem.quantity > barang.stok) {
                    existingItem.quantity = barang.stok;
                    showNotification(`Jumlah ${barang.nama} disesuaikan dengan stok tersedia: ${barang.stok}`, 'warning');
                }
            } else {
                // Add new item
                cart.push({
                    id: barangId,
                    nama: barang.nama,
                    harga: barang.harga,
                    quantity: jumlah
                });
            }

            saveCartToStorage();
            updateCartUI();
            showNotification(`${barang.nama} ditambahkan ke keranjang`, 'success');
        }

        // Remove item from cart
        function removeFromCart(barangId) {
            cart = cart.filter(item => item.id !== barangId);
            saveCartToStorage();
            updateCartUI();
            showNotification('Item dihapus dari keranjang', 'info');
        }

        // Update cart quantity
        function updateCartQuantity(barangId, quantity) {
            const item = cart.find(item => item.id === barangId);
            if (item) {
                const barang = barangData.find(b => b.id === barangId);
                if (barang && quantity > barang.stok) {
                    showNotification(`Stok ${barang.nama} tidak mencukupi! Stok tersedia: ${barang.stok}`, 'error');
                    return;
                }
                
                if (quantity <= 0) {
                    removeFromCart(barangId);
                } else {
                    item.quantity = quantity;
                    saveCartToStorage();
                    updateCartUI();
                }
            }
        }

        // Clear cart
        function kosongkanKeranjang() {
            if (cart.length === 0) {
                showNotification('Keranjang sudah kosong', 'info');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin mengosongkan keranjang?')) {
                cart = [];
                saveCartToStorage();
                updateCartUI();
                showNotification('Keranjang berhasil dikosongkan', 'success');
            }
        }

        // Update cart UI
        function updateCartUI() {
            // Update cart count badge
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
            document.getElementById('cart-count-badge').textContent = totalItems;
            
            // Show/hide cart badge
            const cartBadge = document.getElementById('cart-count-badge');
            cartBadge.style.display = totalItems > 0 ? 'block' : 'none';
            
            // Show/hide checkout button
            document.getElementById('checkout-btn').style.display = totalItems > 0 ? 'inline-flex' : 'none';
            
            // Update cart items in checkout page
            updateCheckoutPage();
        }

        // Update checkout page
        function updateCheckoutPage() {
            try {
                const cartItemsContainer = document.getElementById('cart-items');
                const subtotalElement = document.getElementById('subtotal');
                const diskonElement = document.getElementById('diskon');
                const totalElement = document.getElementById('total-checkout');
                
                if (!cartItemsContainer || !subtotalElement) {
                    console.error('❌ Elemen checkout tidak ditemukan');
                    return;
                }
                
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = `
                        <div class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Keranjang Kosong</h3>
                            <p>Silakan tambahkan barang dari halaman Barang Brangkas</p>
                        </div>
                    `;
                    if (subtotalElement) subtotalElement.textContent = '$ 0';
                    if (diskonElement) diskonElement.textContent = '$ 0';
                    if (totalElement) totalElement.textContent = '$ 0';
                    return;
                }
                
                // Calculate totals
                const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
                const diskonInput = document.getElementById('diskon-input');
                const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
                const total = subtotal - diskon;
                
                // Update totals
                subtotalElement.textContent = formatDollar(subtotal);
                diskonElement.textContent = formatDollar(diskon);
                totalElement.textContent = formatDollar(total);
                
                // Update cart items
                cartItemsContainer.innerHTML = '';
                cart.forEach(item => {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    cartItemElement.innerHTML = `
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.nama}</div>
                            <div class="cart-item-price">${formatDollar(item.harga)} x ${item.quantity}</div>
                        </div>
                        <div class="cart-item-controls">
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="${item.quantity}" 
                                    onchange="updateCartQuantity('${item.id}', parseInt(this.value))" min="1">
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <button class="remove-btn" onclick="removeFromCart('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemElement);
                });
                
            } catch (error) {
                console.error('❌ Error dalam updateCheckoutPage:', error);
            }
        }

        // ===============================
// PAYMENT STATUS MANAGEMENT
// ===============================

// Toggle uang dibayar field based on payment status
function toggleUangDibayar() {
    const statusPembayaran = document.getElementById('status-pembayaran').value;
    const uangDibayarGroup = document.getElementById('uang-dibayar-group');
    const keteranganGroup = document.getElementById('keterangan-pembayaran-group');
    const uangDibayarInput = document.getElementById('uang-dibayar');
    
    if (statusPembayaran === 'belum') {
        // Belum bayar - hide input uang
        uangDibayarGroup.style.display = 'none';
        keteranganGroup.style.display = 'none';
        uangDibayarInput.value = '0';
    } else if (statusPembayaran === 'lunas') {
        // Lunas - show uang dibayar dan set ke total
        uangDibayarGroup.style.display = 'block';
        keteranganGroup.style.display = 'block';
        
        // Calculate total
        const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
        const diskonInput = document.getElementById('diskon-input');
        const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
        const total = subtotal - diskon;
        
        uangDibayarInput.value = total;
    } else if (statusPembayaran === 'dp') {
        // DP - show uang dibayar dengan nilai default 0
        uangDibayarGroup.style.display = 'block';
        keteranganGroup.style.display = 'block';
        uangDibayarInput.value = '0';
    }
    
    updatePaymentSummary();
}

// Update payment summary display
function updatePaymentSummary() {
    const statusPembayaran = document.getElementById('status-pembayaran').value;
    const uangDibayar = parseInt(document.getElementById('uang-dibayar').value) || 0;
    
    // Calculate totals
    const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
    const diskonInput = document.getElementById('diskon-input');
    const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
    const total = subtotal - diskon;
    
    const sisaBayar = total - uangDibayar;
    
    // Update summary display
    let summaryHtml = `
        <div class="payment-summary">
            <div class="payment-summary-item">
                <span>Subtotal:</span>
                <span>${formatDollar(subtotal)}</span>
            </div>
            <div class="payment-summary-item">
                <span>Diskon:</span>
                <span>-${formatDollar(diskon)}</span>
            </div>
            <div class="payment-summary-item">
                <span>Total:</span>
                <span>${formatDollar(total)}</span>
            </div>
    `;
    
    if (statusPembayaran !== 'belum') {
        summaryHtml += `
            <div class="payment-summary-item">
                <span>Uang Dibayar:</span>
                <span>${formatDollar(uangDibayar)}</span>
            </div>
            <div class="payment-summary-item">
                <span>Sisa:</span>
                <span style="color: ${sisaBayar > 0 ? 'var(--danger)' : 'var(--success)'}">
                    ${formatDollar(sisaBayar)}
                </span>
            </div>
        `;
    }
    
    summaryHtml += `</div>`;
    
    // Add payment status indicator
    let statusText = '';
    let statusClass = '';
    
    if (statusPembayaran === 'lunas' && uangDibayar >= total) {
        statusText = 'LUNAS';
        statusClass = 'lunas';
    } else if (statusPembayaran === 'dp' && uangDibayar > 0) {
        statusText = 'BAYAR SEBAGIAN';
        statusClass = 'hutang';
    } else {
        statusText = 'BELUM BAYAR';
        statusClass = 'belum';
    }
    
    summaryHtml += `<div class="payment-status ${statusClass}">${statusText}</div>`;
    
    // Update or create summary element
    let summaryElement = document.getElementById('payment-summary');
    if (!summaryElement) {
        summaryElement = document.createElement('div');
        summaryElement.id = 'payment-summary';
        const checkoutSummary = document.querySelector('.checkout-summary');
        checkoutSummary.parentNode.insertBefore(summaryElement, checkoutSummary.nextSibling);
    }
    summaryElement.innerHTML = summaryHtml;
}

// Update checkout page to include payment status
function updateCheckoutPage() {
    try {
        console.log('🔄 Memperbarui halaman checkout...');
        
        const cartItemsContainer = document.getElementById('cart-items');
        const subtotalElement = document.getElementById('subtotal');
        const diskonElement = document.getElementById('diskon');
        const totalElement = document.getElementById('total-checkout');
        
        if (!cartItemsContainer || !subtotalElement) {
            console.error('❌ Elemen checkout tidak ditemukan');
            return;
        }
        
        if (cart.length === 0) {
            cartItemsContainer.innerHTML = `
                <div class="empty-cart">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>Keranjang Kosong</h3>
                    <p>Silakan tambahkan barang dari halaman Barang Brangkas</p>
                </div>
            `;
            if (subtotalElement) subtotalElement.textContent = '$ 0';
            if (diskonElement) diskonElement.textContent = '$ 0';
            if (totalElement) totalElement.textContent = '$ 0';
            
            // Reset payment status
            document.getElementById('status-pembayaran').value = 'belum';
            toggleUangDibayar();
            return;
        }
        
        // Calculate totals
        const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
        const diskonInput = document.getElementById('diskon-input');
        const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
        const total = subtotal - diskon;
        
        console.log('💰 Update totals:', { subtotal, diskon, total });
        
        // Update totals
        subtotalElement.textContent = formatDollar(subtotal);
        if (diskonElement) diskonElement.textContent = formatDollar(diskon);
        if (totalElement) totalElement.textContent = formatDollar(total);
        
        // Update cart items
        cartItemsContainer.innerHTML = '';
        cart.forEach(item => {
            const cartItemElement = document.createElement('div');
            cartItemElement.className = 'cart-item';
            cartItemElement.innerHTML = `
                <div class="cart-item-info">
                    <div class="cart-item-name">${item.nama}</div>
                    <div class="cart-item-price">${formatDollar(item.harga)} x ${item.quantity}</div>
                </div>
                <div class="cart-item-controls">
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})">
                            <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" class="quantity-input" value="${item.quantity}" 
                            onchange="updateCartQuantity('${item.id}', parseInt(this.value))" min="1">
                        <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <button class="remove-btn" onclick="removeFromCart('${item.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            cartItemsContainer.appendChild(cartItemElement);
        });
        
        // Update payment summary
        updatePaymentSummary();
        
    } catch (error) {
        console.error('❌ Error dalam updateCheckoutPage:', error);
    }
}

// Add event listeners for payment fields
function setupPaymentListeners() {
    const uangDibayarInput = document.getElementById('uang-dibayar');
    const diskonInput = document.getElementById('diskon-input');
    
    if (uangDibayarInput) {
        uangDibayarInput.addEventListener('input', updatePaymentSummary);
    }
    
    if (diskonInput) {
        diskonInput.addEventListener('input', function() {
            // Update totals first
            const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
            const diskon = parseInt(this.value) || 0;
            const total = subtotal - diskon;
            
            document.getElementById('subtotal').textContent = formatDollar(subtotal);
            document.getElementById('diskon').textContent = formatDollar(diskon);
            document.getElementById('total-checkout').textContent = formatDollar(total);
            
            // If status is lunas, update uang dibayar to match new total
            const statusPembayaran = document.getElementById('status-pembayaran').value;
            if (statusPembayaran === 'lunas') {
                document.getElementById('uang-dibayar').value = total;
            }
            
            updatePaymentSummary();
        });
    }
}

        // Process checkout - UPDATED dengan status pembayaran
function prosesCheckout() {
    console.log('🔄 Memulai proses checkout...');
    
    if (cart.length === 0) {
        showNotification('Keranjang masih kosong!', 'error');
        return;
    }
    
    // Dapatkan elemen dengan null checking
    const customerNameElement = document.getElementById('customer-name');
    const statusPembayaranElement = document.getElementById('status-pembayaran');
    const uangDibayarElement = document.getElementById('uang-dibayar');
    const diskonInputElement = document.getElementById('diskon-input');
    const keteranganElement = document.getElementById('keterangan');
    const keteranganPembayaranElement = document.getElementById('keterangan-pembayaran');
    
    // Validasi elemen exists
    if (!customerNameElement || !statusPembayaranElement) {
        console.error('❌ Elemen form checkout tidak ditemukan');
        showNotification('Error: Form checkout tidak lengkap!', 'error');
        return;
    }
    
    const customerName = customerNameElement.value;
    const statusPembayaran = statusPembayaranElement.value;
    const diskon = diskonInputElement ? parseInt(diskonInputElement.value) || 0 : 0;
    const uangDibayar = uangDibayarElement ? parseInt(uangDibayarElement.value) || 0 : 0;
    const keterangan = keteranganElement ? keteranganElement.value : '';
    const keteranganPembayaran = keteranganPembayaranElement ? keteranganPembayaranElement.value : '';
    
    console.log('📋 Data checkout:', { 
        customerName, 
        statusPembayaran, 
        diskon, 
        uangDibayar,
        keteranganPembayaran
    });
    
    if (!customerName) {
        showNotification('Nama customer harus diisi!', 'error');
        customerNameElement.focus();
        return;
    }
    
    // Calculate totals
    const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
    const total = subtotal - diskon;
    
    // Validasi pembayaran berdasarkan status
    if (statusPembayaran === 'lunas' && uangDibayar < total) {
        showNotification('Untuk status LUNAS, uang dibayar harus sama dengan total!', 'error');
        uangDibayarElement.focus();
        return;
    }
    
    if (statusPembayaran === 'dp' && uangDibayar <= 0) {
        showNotification('Untuk status Bayar Sebagian, uang dibayar harus lebih dari 0!', 'error');
        uangDibayarElement.focus();
        return;
    }
    
    if (statusPembayaran === 'dp' && uangDibayar >= total) {
        showNotification('Untuk status Bayar Sebagian, uang dibayar harus kurang dari total!', 'error');
        uangDibayarElement.focus();
        return;
    }
    
    // Tentukan status berdasarkan pembayaran
    let statusPesanan = 'belum';
    if (statusPembayaran === 'lunas') {
        statusPesanan = 'lunas';
    } else if (statusPembayaran === 'dp' && uangDibayar > 0) {
        statusPesanan = 'hutang';
    }
    
    // Generate order ID
    const orderId = 'ORD' + Date.now();
    
    // Create order object
    const newOrder = {
        id: orderId,
        tanggal: new Date().toISOString(),
        customer: customerName,
        items: cart.map(item => ({
            id: item.id,
            nama: item.nama,
            harga: item.harga,
            quantity: item.quantity
        })),
        subtotal: subtotal,
        diskon: diskon,
        total: total,
        uang_dibayar: uangDibayar,
        status_pembayaran: statusPembayaran,
        keterangan_pembayaran: keteranganPembayaran,
        sudah_dikasih: false,
        keterangan: keterangan,
        status: statusPesanan
    };
    
    console.log('💾 Menyimpan pesanan:', newOrder);
    
    // Save to Firebase
    database.ref('pesanan/' + orderId).set(newOrder)
        .then(() => {
            console.log('✅ Pesanan berhasil disimpan ke Firebase');
            
            // Update stock for each item
            const updatePromises = cart.map(item => {
                const barang = barangData.find(b => b.id === item.id);
                if (barang) {
                    const newStock = barang.stok - item.quantity;
                    console.log(`📦 Update stok ${barang.nama}: ${barang.stok} -> ${newStock}`);
                    return database.ref('barang/' + item.id).update({ stok: newStock });
                }
                return Promise.resolve();
            });
            
            return Promise.all(updatePromises);
        })
        .then(() => {
            console.log('✅ Semua stok berhasil diupdate');
            
            // Clear cart
            cart = [];
            saveCartToStorage();
            updateCartUI();
            
            // Reset form
            customerNameElement.value = '';
            statusPembayaranElement.value = 'belum';
            if (diskonInputElement) diskonInputElement.value = '0';
            if (uangDibayarElement) uangDibayarElement.value = '0';
            if (keteranganElement) keteranganElement.value = '';
            if (keteranganPembayaranElement) keteranganPembayaranElement.value = '';
            
            toggleUangDibayar(); // Reset UI
            
            // Show success message and redirect
            showNotification(`Pesanan ${orderId} berhasil dibuat! Status: ${getStatusTextByPayment(statusPembayaran)}`, 'success');
            setTimeout(() => {
                showPage('pemesanan');
            }, 2000);
        })
        .catch(error => {
            console.error('❌ Error saat checkout:', error);
            showNotification('Gagal membuat pesanan: ' + error.message, 'error');
        });
}

// Helper function untuk teks status pembayaran
function getStatusTextByPayment(status) {
    const statusMap = {
        'belum': 'BELUM BAYAR',
        'lunas': 'LUNAS',
        'dp': 'BAYAR SEBAGIAN'
    };
    return statusMap[status] || 'BELUM BAYAR';
}

        // ===============================
        // DATA MANAGEMENT - DENGAN AUTO REFRESH REAL-TIME
        // ===============================

        // Update dashboard
        function updateDashboard() {
            // Update total barang
            document.getElementById('total-barang').textContent = barangData.length;
            
            // Update total nilai barang
            // const totalNilai = barangData.reduce((sum, barang) => sum + (barang.harga * barang.stok), 0);
            // document.getElementById('total-nilai').textContent = formatDollar(totalNilai);
            
            // Update total pesanan aktif
            const totalPesananAktif = pesananData.filter(p => !p.sudah_dikasih).length;
            document.getElementById('total-pesanan').textContent = totalPesananAktif;
            
            // Update total keuangan
            const saldoKas = calculateSaldoKas();
            document.getElementById('total-keuangan').textContent = formatDollar(saldoKas);
            
            // Update recent barang
            updateRecentBarang();
            
            // Update recent pesanan
            updateRecentPesanan();
        }

        // Update recent barang table
        function updateRecentBarang() {
            const recentBarangContainer = document.getElementById('recent-barang');
            const recentBarang = barangData.slice(-5).reverse(); // 5 terbaru
            
            if (recentBarang.length === 0) {
                recentBarangContainer.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada data barang</td></tr>';
                return;
            }
            
            recentBarangContainer.innerHTML = recentBarang.map(barang => `
                <tr>
                    <td>${barang.nama}</td>
                    <td><span class="badge badge-secondary">${barang.kategori}</span></td>
                    <td>${barang.stok}</td>
                    <td>${formatDollar(barang.harga)}</td>
                </tr>
            `).join('');
        }

        // Update recent pesanan table
        function updateRecentPesanan() {
            const recentPesananContainer = document.getElementById('recent-pesanan');
            const recentPesanan = pesananData.slice(-5).reverse(); // 5 terbaru
            
            if (recentPesanan.length === 0) {
                recentPesananContainer.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada data pesanan</td></tr>';
                return;
            }
            
            recentPesananContainer.innerHTML = recentPesanan.map(pesanan => `
                <tr>
                    <td>${pesanan.id}</td>
                    <td>${pesanan.customer}</td>
                    <td><span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span></td>
                    <td>${formatDollar(pesanan.total)}</td>
                </tr>
            `).join('');
        }

        // Update barang UI
        function updateBarangUI() {
            const barangGrid = document.getElementById('barang-grid');
            const searchTerm = document.getElementById('search-barang').value.toLowerCase();
            const filterKategori = document.getElementById('filter-kategori').value;
            
            // Filter barang
            let filteredBarang = barangData.filter(barang => {
                const matchesSearch = barang.nama.toLowerCase().includes(searchTerm) || 
                                    barang.deskripsi?.toLowerCase().includes(searchTerm);
                const matchesCategory = !filterKategori || barang.kategori === filterKategori;
                return matchesSearch && matchesCategory;
            });
            
            if (filteredBarang.length === 0) {
                barangGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h3>Tidak ada barang ditemukan</h3>
                        <p>Coba ubah kata kunci pencarian atau filter kategori</p>
                    </div>
                `;
                return;
            }
            
            // Render barang grid
            barangGrid.innerHTML = filteredBarang.map(barang => {
                const gambarPath = getGambarBarang(barang.nama);
                return `
                    <div class="item-card">
                        <div class="item-image">
                            <img src="${gambarPath}" alt="${barang.nama}" 
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="placeholder" style="display: none;">
                                <i class="fas fa-box"></i>
                            </div>
                        </div>
                        <div class="item-content">
                            <div class="item-title">${barang.nama}</div>
                            <div class="item-desc">${barang.deskripsi || 'Tidak ada deskripsi'}</div>
                            <div class="item-meta">
                                <div class="item-value">${formatDollar(barang.harga)}</div>
                                <div class="item-stock">Stok: ${barang.stok}</div>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-primary" onclick="addToCart('${barang.id}', 1)" 
                                    ${barang.stok <= 0 ? 'disabled' : ''}>
                                    <i class="fas fa-cart-plus"></i> Tambah
                                </button>
                                ${isAdmin ? `
                                <button class="btn btn-warning" onclick="editBarang('${barang.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger" onclick="deleteBarang('${barang.id}')">
                                    <i class="fas fa-trash"></i> Hapus
                                </button>
                                ` : ''}
                                <span class="badge badge-secondary">${barang.kategori}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Edit barang
        function editBarang(barangId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat mengedit barang!', 'error');
                return;
            }
            
            const barang = barangData.find(b => b.id === barangId);
            if (!barang) return;
            
            // Isi form edit
            document.getElementById('edit-barang-id').value = barang.id;
            document.getElementById('edit-nama-barang').value = barang.nama;
            document.getElementById('edit-kategori-barang').value = barang.kategori;
            document.getElementById('edit-harga-barang').value = barang.harga;
            document.getElementById('edit-stok-barang').value = barang.stok;
            document.getElementById('edit-deskripsi-barang').value = barang.deskripsi || '';
            
            showModal('edit-barang-modal');
        }

        // Delete barang
        function deleteBarang(barangId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menghapus barang!', 'error');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus barang ini?')) {
                database.ref('barang/' + barangId).remove()
                    .then(() => {
                        showNotification('Barang berhasil dihapus!', 'success');
                    })
                    .catch(error => {
                        showNotification('Gagal menghapus barang: ' + error.message, 'error');
                    });
            }
        }

        // Update pesanan UI
        function updatePesananUI() {
            updateSemuaPesananTable();
            updatePesananAktifTable();
            updatePesananLunasTable();
            updatePesananHutangTable();
        }

        // Update semua pesanan table - MODIFIED dengan status pembayaran
function updateSemuaPesananTable() {
    const tableBody = document.getElementById('semua-pesanan-table');
    if (pesananData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Tidak ada data pesanan</td></tr>';
        return;
    }
    
    tableBody.innerHTML = pesananData.map(pesanan => `
        <tr class="${pesanan.sudah_dikasih ? 'pesanan-lunas' : 'pesanan-card'}">
            <td>${pesanan.id}</td>
            <td>${formatDate(pesanan.tanggal)}</td>
            <td>${pesanan.customer}</td>
            <td>${pesanan.items.length} item</td>
            <td>${formatDollar(pesanan.total)}</td>
            <td>
                <span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span>
            </td>
            <td>
                <span class="payment-badge ${getPaymentStatusClass(pesanan)}">
                    ${getPaymentStatusText(pesanan)}
                </span>
            </td>
            <td>
                <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                    <i class="fas fa-eye"></i>
                </button>
                ${!pesanan.sudah_dikasih && isAdmin ? `
                <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                    <i class="fas fa-check"></i>
                </button>
                ` : ''}
                ${isAdmin ? `
                <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                    <i class="fas fa-trash"></i>
                </button>
                ` : ''}
            </td>
        </tr>
    `).join('');
}

// Update pesanan aktif table - MODIFIED dengan status pembayaran
function updatePesananAktifTable() {
    const tableBody = document.getElementById('pesanan-aktif-table');
    const aktifPesanan = pesananData.filter(p => !p.sudah_dikasih);
    
    if (aktifPesanan.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Tidak ada pesanan aktif</td></tr>';
        return;
    }
    
    tableBody.innerHTML = aktifPesanan.map(pesanan => `
        <tr class="pesanan-card">
            <td>${pesanan.id}</td>
            <td>${formatDate(pesanan.tanggal)}</td>
            <td>${pesanan.customer}</td>
            <td>${pesanan.items.length} item</td>
            <td>${formatDollar(pesanan.total)}</td>
            <td>
                <span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span>
            </td>
            <td>
                <span class="payment-badge ${getPaymentStatusClass(pesanan)}">
                    ${getPaymentStatusText(pesanan)}
                </span>
            </td>
            <td>
                <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                    <i class="fas fa-eye"></i>
                </button>
                ${isAdmin ? `
                <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                    <i class="fas fa-check"></i>
                </button>
                ` : ''}
                ${isAdmin ? `
                <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                    <i class="fas fa-trash"></i>
                </button>
                ` : ''}
            </td>
        </tr>
    `).join('');
}

// Update pesanan lunas table - MODIFIED dengan status pembayaran
function updatePesananLunasTable() {
    const tableBody = document.getElementById('pesanan-lunas-table');
    const lunasPesanan = pesananData.filter(p => p.sudah_dikasih);
    
    if (lunasPesanan.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Tidak ada pesanan lunas</td></tr>';
        return;
    }
    
    tableBody.innerHTML = lunasPesanan.map(pesanan => `
        <tr class="pesanan-lunas">
            <td>${pesanan.id}</td>
            <td>${formatDate(pesanan.tanggal)}</td>
            <td>${pesanan.customer}</td>
            <td>${pesanan.items.length} item</td>
            <td>${formatDollar(pesanan.total)}</td>
            <td>
                <span class="status status-success">Selesai</span>
            </td>
            <td>
                <span class="payment-badge ${getPaymentStatusClass(pesanan)}">
                    ${getPaymentStatusText(pesanan)}
                </span>
            </td>
            <td>
                <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                    <i class="fas fa-eye"></i>
                </button>
                ${isAdmin ? `
                <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                    <i class="fas fa-trash"></i>
                </button>
                ` : ''}
            </td>
        </tr>
    `).join('');
}

// Update pesanan hutang table - MODIFIED dengan status pembayaran
function updatePesananHutangTable() {
    const tableBody = document.getElementById('pesanan-hutang-table');
    const hutangPesanan = pesananData.filter(p => p.status === 'hutang' && !p.sudah_dikasih);
    
    if (hutangPesanan.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Tidak ada pesanan hutang</td></tr>';
        return;
    }
    
    tableBody.innerHTML = hutangPesanan.map(pesanan => {
        const sisaHutang = pesanan.total - pesanan.uang_dibayar;
        return `
        <tr class="pesanan-hutang">
            <td>${pesanan.id}</td>
            <td>${formatDate(pesanan.tanggal)}</td>
            <td>${pesanan.customer}</td>
            <td>${pesanan.items.length} item</td>
            <td>${formatDollar(pesanan.total)}</td>
            <td>
                <span class="status status-danger">Hutang</span>
            </td>
            <td>
                <span class="payment-badge ${getPaymentStatusClass(pesanan)}">
                    ${getPaymentStatusText(pesanan)}
                </span>
            </td>
            <td>
                <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                    <i class="fas fa-eye"></i>
                </button>
                ${isAdmin ? `
                <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                    <i class="fas fa-check"></i>
                </button>
                ` : ''}
                ${isAdmin ? `
                <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                    <i class="fas fa-trash"></i>
                </button>
                ` : ''}
            </td>
        </tr>
    `}).join('');
}

        // Update pesanan aktif table
        function updatePesananAktifTable() {
            const tableBody = document.getElementById('pesanan-aktif-table');
            const aktifPesanan = pesananData.filter(p => !p.sudah_dikasih);
            
            if (aktifPesanan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada pesanan aktif</td></tr>';
                return;
            }
            
            tableBody.innerHTML = aktifPesanan.map(pesanan => `
                <tr class="pesanan-card">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td><span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Update pesanan lunas table
        function updatePesananLunasTable() {
            const tableBody = document.getElementById('pesanan-lunas-table');
            const lunasPesanan = pesananData.filter(p => p.sudah_dikasih);
            
            if (lunasPesanan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada pesanan lunas</td></tr>';
                return;
            }
            
            tableBody.innerHTML = lunasPesanan.map(pesanan => `
                <tr class="pesanan-lunas">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td><span class="status status-success">Selesai</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        


        // ===============================
// PAYMENT STATUS HELPER FUNCTIONS
// ===============================

// Get payment status class
function getPaymentStatusClass(pesanan) {
    if (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) {
        return 'lunas';
    } else if (pesanan.status_pembayaran === 'dp' || (pesanan.uang_dibayar > 0 && pesanan.uang_dibayar < pesanan.total)) {
        return 'sebagian';
    } else if (pesanan.status_pembayaran === 'belum' || pesanan.uang_dibayar === 0) {
        return 'belum';
    }
    return 'belum';
}

// Get payment status text
function getPaymentStatusText(pesanan) {
    if (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) {
        return 'LUNAS';
    } else if (pesanan.status_pembayaran === 'dp' || (pesanan.uang_dibayar > 0 && pesanan.uang_dibayar < pesanan.total)) {
        const persentase = Math.round((pesanan.uang_dibayar / pesanan.total) * 100);
        return `DP ${persentase}%`;
    } else if (pesanan.status_pembayaran === 'belum' || pesanan.uang_dibayar === 0) {
        return 'BELUM';
    }
    return 'BELUM';
}

// Get detailed payment status text for modal
function getDetailedPaymentStatus(pesanan) {
    if (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) {
        return 'LUNAS';
    } else if (pesanan.status_pembayaran === 'dp' || (pesanan.uang_dibayar > 0 && pesanan.uang_dibayar < pesanan.total)) {
        const persentase = Math.round((pesanan.uang_dibayar / pesanan.total) * 100);
        const sisa = pesanan.total - pesanan.uang_dibayar;
        return `BAYAR SEBAGIAN (${persentase}%) - Sisa: ${formatDollar(sisa)}`;
    } else if (pesanan.status_pembayaran === 'belum' || pesanan.uang_dibayar === 0) {
        return 'BELUM BAYAR';
    }
    return 'BELUM BAYAR';
}

        // Update pesanan hutang table
        function updatePesananHutangTable() {
            const tableBody = document.getElementById('pesanan-hutang-table');
            const hutangPesanan = pesananData.filter(p => p.status === 'hutang' && !p.sudah_dikasih);
            
            if (hutangPesanan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada pesanan hutang</td></tr>';
                return;
            }
            
            tableBody.innerHTML = hutangPesanan.map(pesanan => {
                const sisaHutang = pesanan.total - pesanan.uang_dibayar;
                return `
                <tr class="pesanan-hutang">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td>${formatDollar(sisaHutang)}</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `}).join('');
        }

        // Update transaksi UI
        function updateTransaksiUI() {
            const transaksiTable = document.getElementById('transaksi-table');
            const saldoKasElement = document.getElementById('saldo-kas');
            const pemasukanBulanElement = document.getElementById('pemasukan-bulan');
            const pengeluaranBulanElement = document.getElementById('pengeluaran-bulan');
            const labaBulanElement = document.getElementById('laba-bulan');
            
            // Filter transaksi
            const searchTerm = document.getElementById('search-keuangan').value.toLowerCase();
            const filterJenis = document.getElementById('filter-jenis').value;
            const filterBulan = document.getElementById('filter-bulan').value;
            
            let filteredTransaksi = transaksiData.filter(transaksi => {
                const matchesSearch = transaksi.keterangan.toLowerCase().includes(searchTerm);
                const matchesJenis = !filterJenis || transaksi.jenis === filterJenis;
                const matchesBulan = !filterBulan || transaksi.tanggal.startsWith(filterBulan);
                return matchesSearch && matchesJenis && matchesBulan;
            });
            
            // Update table
            if (filteredTransaksi.length === 0) {
                transaksiTable.innerHTML = '<tr><td colspan="6" class="text-center">Tidak ada data transaksi</td></tr>';
            } else {
                let runningBalance = 0;
                transaksiTable.innerHTML = filteredTransaksi.map(transaksi => {
                    runningBalance += transaksi.jenis === 'pemasukan' ? transaksi.jumlah : -transaksi.jumlah;
                    return `
                        <tr>
                            <td>${formatDate(transaksi.tanggal)}</td>
                            <td>${transaksi.keterangan}</td>
                            <td><span class="badge ${transaksi.jenis === 'pemasukan' ? 'badge-success' : 'badge-danger'}">${transaksi.jenis}</span></td>
                            <td>${formatDollar(transaksi.jumlah)}</td>
                            <td>${formatDollar(runningBalance)}</td>
                            <td>
                                ${isAdmin ? `
                                <button class="btn btn-danger btn-sm" onclick="deleteTransaksi('${transaksi.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update summary cards
            const saldoKas = calculateSaldoKas();
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            const pemasukanBulan = transaksiData
                .filter(t => t.jenis === 'pemasukan' && t.tanggal.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const pengeluaranBulan = transaksiData
                .filter(t => t.jenis === 'pengeluaran' && t.tanggal.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const labaBulan = pemasukanBulan - pengeluaranBulan;
            
            saldoKasElement.textContent = formatDollar(saldoKas);
            pemasukanBulanElement.textContent = formatDollar(pemasukanBulan);
            pengeluaranBulanElement.textContent = formatDollar(pengeluaranBulan);
            labaBulanElement.textContent = formatDollar(labaBulan);
        }

        // Update laporan
        function updateLaporan() {
            const laporanBulan = document.getElementById('laporan-bulan').value || new Date().toISOString().slice(0, 7);
            
            // Filter data berdasarkan bulan
            const transaksiBulan = transaksiData.filter(t => t.tanggal.startsWith(laporanBulan));
            const pesananBulan = pesananData.filter(p => p.tanggal.startsWith(laporanBulan));
            
            // Calculate totals
            const totalPemasukan = transaksiBulan
                .filter(t => t.jenis === 'pemasukan')
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const totalPengeluaran = transaksiBulan
                .filter(t => t.jenis === 'pengeluaran')
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const totalLaba = totalPemasukan - totalPengeluaran;
            const totalPesanan = pesananBulan.length;
            
            // Update summary cards
            document.getElementById('laporan-pemasukan').textContent = formatDollar(totalPemasukan);
            document.getElementById('laporan-pengeluaran').textContent = formatDollar(totalPengeluaran);
            document.getElementById('laporan-laba').textContent = formatDollar(totalLaba);
            document.getElementById('laporan-pesanan').textContent = totalPesanan;
            
            // Update tables
            updateLaporanTransaksiTable(transaksiBulan);
            updateLaporanPesananTable(pesananBulan);
        }

        // Update laporan transaksi table
        function updateLaporanTransaksiTable(transaksiBulan) {
            const tableBody = document.getElementById('laporan-transaksi-table');
            
            if (transaksiBulan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada transaksi pada periode ini</td></tr>';
                return;
            }
            
            tableBody.innerHTML = transaksiBulan.map(transaksi => `
                <tr>
                    <td>${formatDate(transaksi.tanggal)}</td>
                    <td>${transaksi.keterangan}</td>
                    <td><span class="badge ${transaksi.jenis === 'pemasukan' ? 'badge-success' : 'badge-danger'}">${transaksi.jenis}</span></td>
                    <td>${formatDollar(transaksi.jumlah)}</td>
                </tr>
            `).join('');
        }

        // Update laporan pesanan table
        function updateLaporanPesananTable(pesananBulan) {
            const tableBody = document.getElementById('laporan-pesanan-table');
            
            if (pesananBulan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada pesanan pada periode ini</td></tr>';
                return;
            }
            
            tableBody.innerHTML = pesananBulan.map(pesanan => `
                <tr>
                    <td>${pesanan.id}</td>
                    <td>${pesanan.customer}</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td><span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span></td>
                </tr>
            `).join('');
        }

        // ===============================
        // FORM HANDLERS
        // ===============================

        // Handle tambah barang
        function handleTambahBarang(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menambah barang!', 'error');
                return;
            }
            
            const nama = document.getElementById('nama-barang').value;
            const kategori = document.getElementById('kategori-barang').value;
            const harga = parseInt(document.getElementById('harga-barang').value);
            const stok = parseInt(document.getElementById('stok-barang').value);
            const deskripsi = document.getElementById('deskripsi-barang').value;
            
            const newBarang = {
                nama: nama,
                kategori: kategori,
                harga: harga,
                stok: stok,
                deskripsi: deskripsi,
                created_at: new Date().toISOString()
            };
            
            // Save to Firebase
            database.ref('barang').push(newBarang)
                .then(() => {
                    showNotification('Barang berhasil ditambahkan!', 'success');
                    closeModal('tambah-barang-modal');
                    document.getElementById('tambah-barang-form').reset();
                })
                .catch(error => {
                    showNotification('Gagal menambah barang: ' + error.message, 'error');
                });
        }

        // Handle edit barang
        function handleEditBarang(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat mengedit barang!', 'error');
                return;
            }
            
            const barangId = document.getElementById('edit-barang-id').value;
            const nama = document.getElementById('edit-nama-barang').value;
            const kategori = document.getElementById('edit-kategori-barang').value;
            const harga = parseInt(document.getElementById('edit-harga-barang').value);
            const stok = parseInt(document.getElementById('edit-stok-barang').value);
            const deskripsi = document.getElementById('edit-deskripsi-barang').value;
            
            const updatedBarang = {
                nama: nama,
                kategori: kategori,
                harga: harga,
                stok: stok,
                deskripsi: deskripsi,
                updated_at: new Date().toISOString()
            };
            
            // Update to Firebase
            database.ref('barang/' + barangId).update(updatedBarang)
                .then(() => {
                    showNotification('Barang berhasil diupdate!', 'success');
                    closeModal('edit-barang-modal');
                })
                .catch(error => {
                    showNotification('Gagal mengupdate barang: ' + error.message, 'error');
                });
        }

        // Handle tambah transaksi
        function handleTambahTransaksi(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menambah transaksi!', 'error');
                return;
            }
            
            const jenis = document.getElementById('jenis-transaksi').value;
            const jumlah = parseInt(document.getElementById('jumlah-transaksi').value);
            const keterangan = document.getElementById('keterangan-transaksi').value;
            const tanggal = document.getElementById('tanggal-transaksi').value;
            
            const newTransaksi = {
                jenis: jenis,
                jumlah: jumlah,
                keterangan: keterangan,
                tanggal: tanggal,
                created_at: new Date().toISOString()
            };
            
            // Save to Firebase
            database.ref('transaksi').push(newTransaksi)
                .then(() => {
                    showNotification('Transaksi berhasil ditambahkan!', 'success');
                    closeModal('tambah-transaksi-modal');
                    document.getElementById('tambah-transaksi-form').reset();
                })
                .catch(error => {
                    showNotification('Gagal menambah transaksi: ' + error.message, 'error');
                });
        }

        // ===============================
        // UTILITY FUNCTIONS
        // ===============================

        // Format currency to Dollar
        function formatDollar(amount) {
            if (isNaN(amount) || amount === null) {
                return '$ 0';
            }
            return '$ ' + amount.toLocaleString('en-US');
        }

        // Format date
        function formatDate(dateString) {
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        // Get status class for pesanan
        function getStatusClass(pesanan) {
            if (pesanan.sudah_dikasih) return 'status-success';
            if (pesanan.status === 'hutang') return 'status-danger';
            return 'status-warning';
        }

        // Get status text for pesanan
        function getStatusText(pesanan) {
            if (pesanan.sudah_dikasih) return 'Selesai';
            if (pesanan.status === 'hutang') return 'Hutang';
            return 'Proses';
        }

        // Calculate saldo kas
        function calculateSaldoKas() {
            return transaksiData.reduce((saldo, transaksi) => {
                return transaksi.jenis === 'pemasukan' ? 
                    saldo + transaksi.jumlah : 
                    saldo - transaksi.jumlah;
            }, 0);
        }

// Mark pesanan as given - MODIFIED dengan modal kustom
function markAsGiven(pesananId) {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menandai pesanan sudah diberikan!', 'error');
        return;
    }
    
    const pesanan = pesananData.find(p => p.id === pesananId);
    if (!pesanan) return;
    
    showConfirmation(
        `Apakah Anda yakin menandai pesanan ${pesanan.id} sudah diberikan?`,
        function() {
            database.ref('pesanan/' + pesananId).update({
                sudah_dikasih: true
            })
            .then(() => {
                showNotification('Pesanan berhasil ditandai sudah diberikan!', 'success');
            })
            .catch(error => {
                showNotification('Gagal memperbarui pesanan: ' + error.message, 'error');
            });
        },
        'warning'
    );
}

// Delete pesanan - MODIFIED dengan modal kustom
function deletePesanan(pesananId) {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menghapus pesanan!', 'error');
        return;
    }
    
    const pesanan = pesananData.find(p => p.id === pesananId);
    if (!pesanan) return;
    
    showDeleteConfirmation(
        `Apakah Anda yakin ingin menghapus pesanan ${pesanan.id}
       Customer: ${pesanan.customer} - Total: ${formatDollar(pesanan.total)}`,
        function() {
            database.ref('pesanan/' + pesananId).remove()
                .then(() => {
                    showNotification('Pesanan berhasil dihapus!', 'success');
                })
                .catch(error => {
                    showNotification('Gagal menghapus pesanan: ' + error.message, 'error');
                });
        }
    );
}

// Delete barang - MODIFIED dengan modal kustom
function deleteBarang(barangId) {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menghapus barang!', 'error');
        return;
    }
    
    const barang = barangData.find(b => b.id === barangId);
    if (!barang) return;
    
    showDeleteConfirmation(
        `Apakah Anda yakin ingin menghapus barang <strong>${barang.nama}</strong>?<br>
        <small style="color: var(--text-muted);">Kategori: ${barang.kategori} - Stok: ${barang.stok}</small>`,
        function() {
            database.ref('barang/' + barangId).remove()
                .then(() => {
                    showNotification('Barang berhasil dihapus!', 'success');
                })
                .catch(error => {
                    showNotification('Gagal menghapus barang: ' + error.message, 'error');
                });
        }
    );
}

// Delete transaksi - MODIFIED dengan modal kustom
function deleteTransaksi(transaksiId) {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menghapus transaksi!', 'error');
        return;
    }
    
    const transaksi = transaksiData.find(t => t.id === transaksiId);
    if (!transaksi) return;
    
    showDeleteConfirmation(
        `Apakah Anda yakin ingin menghapus transaksi ini?<br>
        <small style="color: var(--text-muted);">${transaksi.keterangan} - ${formatDollar(transaksi.jumlah)}</small>`,
        function() {
            database.ref('transaksi/' + transaksiId).remove()
                .then(() => {
                    showNotification('Transaksi berhasil dihapus!', 'success');
                })
                .catch(error => {
                    showNotification('Gagal menghapus transaksi: ' + error.message, 'error');
                });
        }
    );
}

// Kosongkan keranjang - MODIFIED dengan modal kustom
function kosongkanKeranjang() {
    if (cart.length === 0) {
        showNotification('Keranjang sudah kosong', 'info');
        return;
    }
    
    showConfirmation(
        'Apakah Anda yakin ingin mengosongkan keranjang?<br><small style="color: var(--text-muted);">Semua item dalam keranjang akan dihapus</small>',
        function() {
            cart = [];
            saveCartToStorage();
            updateCartUI();
            showNotification('Keranjang berhasil dikosongkan', 'success');
        },
        'warning'
    );
}

// View pesanan detail dengan modal - MODIFIED dengan tombol baru
function viewPesananDetail(pesananId) {
    const pesanan = pesananData.find(p => p.id === pesananId);
    if (!pesanan) {
        showNotification('Pesanan tidak ditemukan!', 'error');
        return;
    }
    
    // Hitung sisa hutang jika ada
    const sisaHutang = pesanan.total - pesanan.uang_dibayar;
    const persentaseBayar = pesanan.total > 0 ? Math.round((pesanan.uang_dibayar / pesanan.total) * 100) : 0;
    
    // Buat HTML untuk detail pesanan
    let detailHtml = `
        <div class="detail-section">
            <h4>Informasi Pesanan</h4>
            <div class="detail-row">
                <span class="detail-label">ID Pesanan:</span>
                <span class="detail-value">${pesanan.id}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Customer:</span>
                <span class="detail-value">${pesanan.customer}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Tanggal:</span>
                <span class="detail-value">${formatDate(pesanan.tanggal)}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Status Pesanan:</span>
                <span class="detail-value">
                    <span class="status-badge ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span>
                </span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Status Pembayaran:</span>
                <span class="detail-value">
                    <span class="payment-badge ${getPaymentStatusClass(pesanan)}" style="font-size: 0.8rem;">
                        ${getDetailedPaymentStatus(pesanan)}
                    </span>
                </span>
            </div>
            ${pesanan.keterangan ? `
            <div class="detail-row">
                <span class="detail-label">Keterangan:</span>
                <span class="detail-value">${pesanan.keterangan}</span>
            </div>
            ` : ''}
        </div>
        
        <div class="detail-section">
            <h4>Informasi Pembayaran</h4>
            <div class="detail-row">
                <span class="detail-label">Total Tagihan:</span>
                <span class="detail-value">${formatDollar(pesanan.total)}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Uang Dibayar:</span>
                <span class="detail-value ${pesanan.uang_dibayar > 0 ? 'success-text' : ''}">
                    ${formatDollar(pesanan.uang_dibayar)}
                    ${persentaseBayar > 0 ? `(${persentaseBayar}%)` : ''}
                </span>
            </div>
    `;
    
    // Tampilkan sisa jika belum lunas
    if (sisaHutang > 0) {
        detailHtml += `
            <div class="detail-row">
                <span class="detail-label">Sisa Pembayaran:</span>
                <span class="detail-value" style="color: var(--danger); font-weight: 700;">
                    ${formatDollar(sisaHutang)}
                </span>
            </div>
        `;
    }
    
    // Tampilkan status pembayaran asli dari form
    if (pesanan.status_pembayaran) {
        const statusText = {
            'belum': 'Belum Bayar',
            'lunas': 'Lunas',
            'dp': 'Bayar Sebagian (DP)'
        }[pesanan.status_pembayaran] || 'Belum Bayar';
        
        detailHtml += `
            <div class="detail-row">
                <span class="detail-label">Status Awal:</span>
                <span class="detail-value">${statusText}</span>
            </div>
        `;
    }
    
    // Tampilkan keterangan pembayaran jika ada
    if (pesanan.keterangan_pembayaran) {
        detailHtml += `
            <div class="detail-row">
                <span class="detail-label">Keterangan Pembayaran:</span>
                <span class="detail-value">${pesanan.keterangan_pembayaran}</span>
            </div>
        `;
    }
    
    detailHtml += `</div>`;
    
    // Items pesanan
    detailHtml += `
        <div class="detail-section">
            <h4>Items Pesanan</h4>
            <table class="items-table">
                <thead>
                    <tr>
                        <th>Nama Barang</th>
                        <th>Harga</th>
                        <th>Qty</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    // Tambahkan items
    pesanan.items.forEach(item => {
        const subtotal = item.harga * item.quantity;
        detailHtml += `
            <tr>
                <td>${item.nama}</td>
                <td>${formatDollar(item.harga)}</td>
                <td>${item.quantity}</td>
                <td>${formatDollar(subtotal)}</td>
            </tr>
        `;
    });
    
    detailHtml += `
                </tbody>
            </table>
        </div>
        
        <div class="detail-section">
            <h4>Ringkasan</h4>
            <div class="detail-row">
                <span class="detail-label">Subtotal:</span>
                <span class="detail-value">${formatDollar(pesanan.subtotal)}</span>
            </div>
            ${pesanan.diskon > 0 ? `
            <div class="detail-row">
                <span class="detail-label">Diskon:</span>
                <span class="detail-value">-${formatDollar(pesanan.diskon)}</span>
            </div>
            ` : ''}
            <div class="detail-row summary-total">
                <span class="detail-label">Total:</span>
                <span class="detail-value" style="font-weight: 700; font-size: 1.1rem;">${formatDollar(pesanan.total)}</span>
            </div>
        </div>
    `;
    
    // Tampilkan modal
    document.getElementById('detail-pesanan-content').innerHTML = detailHtml;
    
    // Setup tombol aksi
    const copyItemsBtn = document.getElementById('copy-items-btn');
    const markPaidBtn = document.getElementById('mark-paid-btn');
    
    // Tampilkan tombol salin items untuk semua pesanan
    copyItemsBtn.style.display = 'inline-flex';
    copyItemsBtn.onclick = function() {
        copyPesananItems(pesanan);
    };
    
    // Tampilkan tombol tandai sudah dibayar hanya untuk admin dan pesanan yang belum lunas
    if (isAdmin && (pesanan.status_pembayaran !== 'lunas' || pesanan.uang_dibayar < pesanan.total)) {
        markPaidBtn.style.display = 'inline-flex';
        markPaidBtn.onclick = function() {
            markPesananAsPaid(pesanan.id);
        };
    } else {
        markPaidBtn.style.display = 'none';
    }
    
    // Tambahkan tombol aksi lainnya hanya untuk admin
    if (isAdmin && !pesanan.sudah_dikasih) {
        detailHtml += `
            <div class="detail-section">
                <h4>Aksi Admin</h4>
                <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="markAsGiven('${pesanan.id}'); closeModal('detail-pesanan-modal');">
                        <i class="fas fa-check"></i> Tandai Sudah Diberikan
                    </button>
                    <button class="btn btn-danger" onclick="deletePesanan('${pesanan.id}'); closeModal('detail-pesanan-modal');">
                        <i class="fas fa-trash"></i> Hapus Pesanan
                    </button>
                </div>
            </div>
        `;
    }
    
    showModal('detail-pesanan-modal');
}

        // Delete transaksi
        function deleteTransaksi(transaksiId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menghapus transaksi!', 'error');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                database.ref('transaksi/' + transaksiId).remove()
                    .then(() => {
                        showNotification('Transaksi berhasil dihapus!', 'success');
                    })
                    .catch(error => {
                        showNotification('Gagal menghapus transaksi: ' + error.message, 'error');
                    });
            }
        }

        // Update cart badge
        function updateCartBadge() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartBadge = document.getElementById('cart-count-badge');
            cartBadge.textContent = totalItems;
            cartBadge.style.display = totalItems > 0 ? 'block' : 'none';
        }

        // ===============================
        // INITIALIZATION
        // ===============================

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadCartFromStorage();
            
            // Setup search and filter events
            document.getElementById('search-barang').addEventListener('input', updateBarangUI);
            document.getElementById('filter-kategori').addEventListener('change', updateBarangUI);
            document.getElementById('search-keuangan').addEventListener('input', updateTransaksiUI);
            document.getElementById('filter-jenis').addEventListener('change', updateTransaksiUI);
            document.getElementById('filter-bulan').addEventListener('change', updateTransaksiUI);
            document.getElementById('laporan-bulan').addEventListener('change', updateLaporan);
            document.getElementById('generate-laporan-btn').addEventListener('click', updateLaporan);
            
            // Setup real-time indicator
            setInterval(() => {
                const indicator = document.getElementById('real-time-indicator');
                indicator.style.opacity = indicator.style.opacity === '0.7' ? '1' : '0.7';
            }, 2000);
            
            console.log('🚀 Brangkas System initialized with AUTO REFRESH REAL-TIME');
        });
    </script>
    <!-- Modal Detail Pesanan - MODIFIED -->
    <div class="modal" id="detail-pesanan-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title">Detail Pesanan</div>
                <button class="close-modal" onclick="closeModal('detail-pesanan-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="detail-pesanan-content">
                    <!-- Konten detail pesanan akan diisi oleh JavaScript -->
                </div>
            </div>
            <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid var(--dark-surface-light); display: flex; justify-content: space-between; align-items: center;">
                <div class="footer-actions-left">
                    <button class="btn btn-copy" id="copy-items-btn" style="display: none;">
                        <i class="fas fa-copy"></i> Salin Items
                    </button>
                </div>
                <div class="footer-actions-right">
                    <button class="btn btn-paid" id="mark-paid-btn" style="display: none;">
                        <i class="fas fa-money-bill-wave"></i> Tandai Sudah Dibayar
                    </button>
                    <button class="btn btn-primary" onclick="closeModal('detail-pesanan-modal')">
                        <i class="fas fa-times"></i> Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-icon" id="confirmation-icon">
                <i class="fas fa-question"></i>
            </div>
            <div class="confirmation-title" id="confirmation-title">Konfirmasi</div>
            <div class="confirmation-message" id="confirmation-message">
                Apakah Anda yakin ingin melakukan tindakan ini?
            </div>
            <div class="confirmation-actions">
                <button class="confirmation-btn cancel" onclick="hideConfirmation()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="confirmation-btn confirm" id="confirmation-confirm-btn">
                    <i class="fas fa-check"></i> Ya
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="confirmation-modal" id="delete-confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-icon danger">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="confirmation-title">Hapus Data</div>
            <div class="confirmation-message" id="delete-confirmation-message">
                Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.
            </div>
            <div class="confirmation-actions">
                <button class="confirmation-btn cancel" onclick="hideDeleteConfirmation()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="confirmation-btn delete" id="delete-confirm-btn">
                    <i class="fas fa-trash"></i> Hapus
                </button>
            </div>
        </div>
    </div>
</body>
</html>