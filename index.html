<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brangkas - Dashboard Keuangan</title>
    <link rel="icon" type="image/png" href="/images/dsg.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --dark-bg: #0f172a;
            --dark-surface: #1e293b;
            --dark-surface-light: #334155;
            --dark-surface-lighter: #475569;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --success: #10b981;
            --success-dark: #059669;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --info: #3b82f6;
            --info-dark: #2563eb;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a2332 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-surface);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            transition: var(--transition);
            max-width: 380px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            margin-left: auto;
            padding: 4px;
            border-radius: 6px;
            transition: var(--transition-fast);
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Dashboard Bendahara Styles */
        .bendahara-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--dark-surface);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            border-left: 4px solid var(--success);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .bendahara-summary {
            background: var(--dark-surface);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--info);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
        }

        .summary-item-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .summary-item-value {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .uang-dikasih-item {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border-left: 3px solid var(--success);
        }

        .uang-belum-dikasih-item {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%);
            border-left: 3px solid var(--warning);
        }

        /* Style untuk profit display */
        .profit-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            text-align: center;
            min-width: 80px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
            margin-left: 0.5rem;
        }

        .profit-card {
            border-left: 4px solid var(--success) !important;
        }

        .profit-summary {
            background: var(--dark-surface-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            border-left: 4px solid var(--success);
        }

        .profit-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--dark-surface-lighter);
        }

        .profit-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Real-time Indicator */
        .real-time-indicator {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            z-index: 1000;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .real-time-indicator .pulse {
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }

        .cart-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
            border-radius: 50%;
            min-width: 18px;
            height: 18px;
            font-size: 0.65rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            border: 2px solid var(--dark-surface);
            line-height: 1;
            padding: 0 4px;
        }

        /* Status Badge untuk Barang */
        .status-badge-barang {
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            display: inline-block;
            margin-left: 0.5rem;
        }

        .status-ready {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-preorder {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* Badge untuk Penerima Pembayaran */
        .penerima-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
            margin-left: 0.5rem;
            background: var(--dark-surface-light);
            color: var(--text-primary);
            border: 1px solid var(--dark-surface-lighter);
        }

        .penerima-dibayar {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a2332 100%);
            padding: 1rem;
        }

        .login-form {
            background: var(--dark-surface);
            padding: 2.5rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            width: 420px;
            max-width: 100%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
            padding: 0 2rem 2rem;
        }

        .detail-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
        }

        .btn-copy {
            background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
        }

        .btn-copy:hover {
            background: linear-gradient(135deg, #60a5fa 0%, var(--info) 100%);
        }

        .btn-paid {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }

        .btn-paid:hover {
            background: linear-gradient(135deg, #34d399 0%, var(--success) 100%);
        }

        .detail-section h4 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            border-bottom: 1px solid var(--dark-surface-lighter);
            padding-bottom: 0.5rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .detail-value {
            color: var(--text-primary);
            text-align: right;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #60a5fa 0%, var(--info) 100%);
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .items-table th,
        .items-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--dark-surface-lighter);
        }

        .items-table th {
            background: var(--dark-surface);
            color: var(--text-secondary);
            font-weight: 600;
        }

        .items-table tr:hover {
            background: var(--dark-surface-light);
        }

        .status-badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .summary-total {
            background: var(--dark-surface);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-top: 1rem;
            border-left: 4px solid var(--primary);
        }

        .login-logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-weight: bold;
            font-size: 1.8rem;
            box-shadow: var(--shadow-lg);
        }

        .login-logo-text {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.9rem 1rem;
            background: var(--dark-bg);
            border: 1px solid var(--dark-surface-light);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 0.9rem 1.5rem;
            border-radius: var(--border-radius);
            background: var(--dark-surface-light);
            color: var(--text-primary);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Tambahkan di bagian CSS */
        .btn-delete {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition-fast);
        }

        .btn-delete:hover {
            background: linear-gradient(135deg, #f87171 0%, var(--danger) 100%);
            transform: translateY(-1px);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #34d399 0%, var(--success) 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #f87171 0%, var(--danger) 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #fbbf24 0%, var(--warning) 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #60a5fa 0%, var(--info) 100%);
        }

        .login-footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .public-access {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--dark-surface-light);
        }

        /* Payment Status Styles */
        .payment-status {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .payment-status.lunas {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* Tambahkan di bagian CSS */
        .status-badge-kasih {
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
        }

        .status-sudah-dikasih {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-belum-dikasih {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .payment-status.hutang {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .payment-status.belum {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .payment-summary {
            background: var(--dark-surface-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
        }

        .payment-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .payment-summary-item:last-child {
            margin-bottom: 0;
            font-weight: 700;
            border-top: 1px solid var(--dark-surface-lighter);
            padding-top: 0.5rem;
        }

        .public-access-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            width: 100%;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .public-access-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Main App Container */
        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--dark-surface);
            padding: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 1.3rem;
            box-shadow: var(--shadow);
        }

        .logo-text {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 0.5rem;
            position: relative;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 0.9rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            position: relative;
            font-weight: 500;
        }

        .nav-links a:hover {
            background: var(--dark-surface-light);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .nav-links a.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-links i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: transparent;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        /* Checklist Styles */
        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .item-checkbox {
            display: none;
        }

        .checkbox-label {
            width: 20px;
            height: 20px;
            border: 2px solid var(--dark-surface-lighter);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkbox-label:hover {
            border-color: var(--primary);
        }

        .item-checkbox:checked + .checkbox-label {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            border-color: var(--success);
        }

        .item-checkbox:checked + .checkbox-label::after {
            content: 'âœ“';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        /* Progress Bar Styles */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--dark-surface-lighter);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Item Given Style */
        .item-given {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%) !important;
        }

        .item-given td {
            opacity: 0.7;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            box-shadow: var(--shadow);
        }

        .logout-btn {
            background: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
            cursor: pointer;
            padding: 0.6rem 1rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            transform: translateY(-2px);
        }

        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .card {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            padding: 1.8rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .card-title {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: var(--shadow);
        }

        .card-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .bg-primary { background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(79, 70, 229, 0.2) 100%); color: var(--primary); }
        .bg-success { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%); color: var(--success); }
        .bg-warning { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%); color: var(--warning); }
        .bg-danger { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%); color: var(--danger); }
        .bg-info { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%); color: var(--info); }

        /* Tables */
        .tables {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .table-container {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        /* Custom Confirmation Modal */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        /* Payment Badge Styles */
        .payment-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            text-align: center;
            min-width: 80px;
        }

        .payment-badge.lunas {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .payment-badge.dp {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .payment-badge.belum {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .payment-badge.sebagian {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%);
            color: var(--info);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .confirmation-modal.active {
            display: flex;
        }

        .confirmation-content {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            width: 400px;
            max-width: 95%;
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            text-align: center;
            animation: modalSlideIn 0.3s ease-out;
        }

        .confirmation-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 1.5rem;
            color: white;
        }

        .confirmation-icon.success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }

        .confirmation-icon.danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        }

        .confirmation-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .confirmation-message {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .confirmation-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirmation-btn {
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            min-width: 100px;
        }

        .confirmation-btn.cancel {
            background: var(--dark-surface-light);
            color: var(--text-primary);
            border: 1px solid var(--dark-surface-lighter);
        }

        .confirmation-btn.confirm {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
        }

        .confirmation-btn.delete {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
        }

        .confirmation-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
        }

        .table-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .table-content {
            padding: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem 0.8rem;
            text-align: left;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        th {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: var(--text-primary);
            font-weight: 500;
        }

        .status {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Charts */
        .chart-container {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Success Text */
        .success-text {
            color: var(--success);
            font-weight: 600;
        }

        .btn-sm {
            padding: 0.6rem 1rem;
            font-size: 0.85rem;
            border-radius: var(--border-radius);
        }

        /* Chart Placeholder */
        .chart-placeholder {
            height: 300px;
            background: linear-gradient(135deg, var(--dark-surface) 0%, var(--dark-surface-light) 100%);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 1.5rem;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--dark-surface-light);
            margin-top: 2rem;
        }

        /* Page Content */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Search and Filter */
        .search-filter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            border-radius: var(--border-radius);
            padding: 0.8rem 1.2rem;
            width: 320px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .search-box input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            width: 100%;
            margin-left: 0.8rem;
            outline: none;
            font-size: 0.95rem;
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .filter-options {
            display: flex;
            gap: 1rem;
        }

        /* Item Grid */
        .item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .item-card {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .item-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .item-image {
            height: 200px;
            background: linear-gradient(135deg, var(--dark-surface-light) 0%, var(--dark-surface-lighter) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            overflow: hidden;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            position: relative;
        }

        .item-image img {
            width: 140px;
            height: 140px;
            object-fit: cover;
            transition: var(--transition);
        }

        .item-card:hover .item-image img {
            transform: scale(1.05);
        }

        .item-image .placeholder {
            color: var(--text-muted);
            font-size: 3.5rem;
        }

        .item-content {
            padding: 1.5rem;
        }

        .item-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .item-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1.2rem;
            line-height: 1.5;
        }

        .item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .item-value {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--success);
        }

        .item-stock {
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--dark-surface-light);
            padding: 0.4rem 0.8rem;
            border-radius: var(--border-radius);
            font-size: 0.85rem;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Badges */
        .badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tambahkan di section CSS Anda */
        .detail-pesanan-container {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 500px;
            margin: 0 auto;
        }

        .detail-pesanan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .detail-pesanan-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Info section yang lebih kompak */
        .info-section {
            background: var(--dark-surface-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 120px;
        }

        .info-value {
            color: var(--text-primary);
            text-align: right;
            flex: 1;
        }

        /* Tabel yang lebih kompak */
        .compact-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.85rem;
        }

        .compact-table th {
            background: var(--dark-surface-light);
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.6rem 0.4rem;
            text-align: left;
            border-bottom: 2px solid var(--dark-surface-lighter);
            font-size: 0.8rem;
        }

        .compact-table td {
            padding: 0.5rem 0.4rem;
            border-bottom: 1px solid var(--dark-surface-light);
            color: var(--text-primary);
        }

        .compact-table tr:last-child td {
            border-bottom: none;
        }

        /* Checkbox yang lebih kecil */
        .compact-checkbox {
            transform: scale(0.8);
            margin: 0;
        }

        /* Progress section yang kompak */
        .compact-progress {
            background: var(--dark-surface-light);
            padding: 0.8rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            font-size: 0.85rem;
        }

        .progress-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .progress-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .progress-count {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9rem;
        }

        /* Summary yang kompak */
        .compact-summary {
            background: var(--dark-surface-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            border-left: 3px solid var(--success);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .summary-total-row {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 1.1rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--dark-surface-lighter);
            margin-top: 0.5rem;
        }

        /* Tombol aksi yang lebih kompak */
        .compact-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            padding-top: 1rem;
            border-top: 1px solid var(--dark-surface-light);
            flex-wrap: wrap;
        }

        .btn-compact {
            padding: 0.5rem 0.8rem;
            font-size: 0.8rem;
            border-radius: var(--border-radius-sm);
        }

        /* Badge yang lebih kecil */
        .badge-sm {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            border-radius: 10px;
        }

        /* Modal yang lebih kecil */
        .compact-modal .modal-content {
            max-width: 520px;
            padding: 1.5rem;
        }

        .compact-modal .modal-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
        }

        .compact-modal .modal-title {
            font-size: 1.3rem;
        }

        /* Item given style untuk tabel kompak */
        .item-given-compact {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%) !important;
        }

        .item-given-compact td {
            opacity: 0.7;
        }

        .badge-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .badge-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .badge-info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.2) 100%);
            color: var(--info);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .badge-secondary {
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.2) 0%, rgba(71, 85, 105, 0.2) 100%);
            color: var(--text-muted);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        /* Edit Penerima Form Styles */
        .edit-penerima-form {
            background: var(--dark-surface-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            border-left: 3px solid var(--info);
        }

        .edit-penerima-row {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .edit-penerima-input {
            flex: 1;
        }

        .edit-penerima-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-edit {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition-fast);
        }

        .btn-edit:hover {
            background: linear-gradient(135deg, #fbbf24 0%, var(--warning) 100%);
            transform: translateY(-1px);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition-fast);
        }

        .btn-save:hover {
            background: linear-gradient(135deg, #34d399 0%, var(--success) 100%);
            transform: translateY(-1px);
        }

        .btn-cancel {
            background: var(--dark-surface-lighter);
            color: var(--text-primary);
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition-fast);
        }

        .btn-cancel:hover {
            background: var(--dark-surface-light);
            transform: translateY(-1px);
        }

        .penerima-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
            margin: 0.5rem 0;
        }

        .penerima-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            width: 500px;
            max-width: 95%;
            padding: 2.5rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: var(--transition-fast);
        }

        .close-modal:hover {
            background: var(--dark-surface-light);
            color: var(--text-primary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--dark-surface-light);
            gap: 0.5rem;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .tab:hover {
            color: var(--text-primary);
            background: var(--dark-surface-light);
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            background: var(--dark-surface-light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Pesanan Styles */
        .pesanan-card {
            border-left: 4px solid var(--warning);
        }

        .pesanan-lunas {
            border-left: 4px solid var(--success);
        }

        .pesanan-hutang {
            border-left: 4px solid var(--danger);
        }

        /* Checkout Styles */
        .checkout-container {
            background: var(--dark-surface);
            border-radius: var(--border-radius-lg);
            padding: 2.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .checkout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--dark-surface-light);
        }

        .checkout-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Cart Items Styles */
        .cart-items {
            margin-bottom: 2rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-btn {
            background: var(--dark-bg);
            border: none;
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .quantity-btn:hover {
            background: var(--primary);
        }

        .quantity-input {
            width: 50px;
            text-align: center;
            background: var(--dark-bg);
            border: 1px solid var(--dark-surface-lighter);
            color: var(--text-primary);
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
        }

        .remove-btn {
            background: var(--danger);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .remove-btn:hover {
            background: var(--danger-dark);
        }

        .empty-cart {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .empty-cart i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .checkout-summary {
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--dark-surface-lighter);
        }

        .summary-total {
            font-weight: 700;
            font-size: 1.2rem;
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Hutang Summary Styles */
        .hutang-summary {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .hutang-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--dark-surface-light);
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--danger);
        }

        .hutang-item:last-child {
            margin-bottom: 0;
        }

        .hutang-customer {
            font-weight: 600;
            color: var(--text-primary);
        }

        .hutang-amount {
            color: var(--danger);
            font-weight: 700;
        }

        .hutang-status {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .tables {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 1rem;
            }
            
            .main-content {
                padding: 1.5rem;
            }
            
            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .item-grid {
                grid-template-columns: 1fr;
            }
            
            .cards {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                padding: 2rem 1.5rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-radius: var(--border-radius);
                border-bottom: none;
                border-left: 3px solid transparent;
            }
            
            .tab.active {
                border-left: 3px solid var(--primary);
                border-bottom: none;
            }
        }
    </style>
</head>
<body>
    <!-- Notification System -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <i class="fas fa-info-circle"></i>
            <span id="notification-message">Pesan notifikasi</span>
            <button class="notification-close" onclick="hideNotification()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Real-time Indicator -->
    <div id="real-time-indicator" class="real-time-indicator">
        <div class="pulse"></div>
        <span>Real-time Active</span>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="login-container" style="display: none;">
        <div class="login-form">
            <div class="login-logo">
                <div class="login-logo-icon">
                    <i class="fas fa-vault"></i>
                </div>
                <div class="login-logo-text">Brangkas</div>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="form-control" placeholder="Masukkan email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login Admin
                    </button>
                </div>
            </form>
            <div class="public-access">
                <button class="public-access-btn" id="public-access-btn">
                    <i class="fas fa-eye"></i> Akses sebagai Pembeli
                </button>
            </div>
            <div class="login-footer">
                &copy; DSG JAYA JAYA JAYA
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-vault"></i>
                </div>
                <div class="logo-text">Brangkas</div>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a></li>
                <li><a href="#" class="nav-link" data-page="barang-brangkas">
                    <i class="fas fa-box"></i> Barang Brangkas
                </a></li>
                <li><a href="#" class="nav-link" data-page="pemesanan">
                    <i class="fas fa-shopping-cart"></i> Pemesanan 
                    <span id="cart-count-badge" class="cart-badge" style="display: none;">0</span>
                </a></li>
                <li id="admin-keuangan" style="display: none;"><a href="#" class="nav-link" data-page="keuangan">
                    <i class="fas fa-chart-pie"></i> Keuangan
                </a></li>
                <li><a href="#" class="nav-link" data-page="laporan">
                    <i class="fas fa-chart-bar"></i> Laporan
                </a></li>
                <!-- Di dalam <ul class="nav-links"> -->
                <li id="admin-bendahara" style="display: none;">
                    <a href="#" class="nav-link" data-page="bendahara">
                        <i class="fas fa-hand-holding-usd"></i> Dashboard Bendahara
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard-page">
                <div class="header">
                    <h1>Dashboard</h1>
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <button class="logout-btn" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <!-- Cards -->
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Barang Brangkas</div>
                            <div class="card-icon bg-primary">
                                <i class="fas fa-box"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-barang">0</div>
                        <div class="card-desc">Jumlah barang tersedia</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pesanan Aktif</div>
                            <div class="card-icon bg-warning">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-pesanan">0</div>
                        <div class="card-desc">Pesanan dalam proses</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Uang Di Terima</div>
                            <div class="card-icon bg-info">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-keuangan">$ 0</div>
                        <div class="card-desc">Saldo kas saat ini</div>
                    </div>
                    <!-- Card Hutang Baru -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Hutang</div>
                            <div class="card-icon bg-danger">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-hutang">$ 0</div>
                        <div class="card-desc">Uang yang belum diterima</div>
                    </div>
                </div>

                <!-- Tables -->
                <div class="tables">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Barang Terbaru</div>
                            <button class="btn btn-primary btn-sm" onclick="showPage('barang-brangkas')">
                                <i class="fas fa-eye"></i> Lihat Semua
                            </button>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nama Barang</th>
                                        <th>Kategori</th>
                                        <th>Status</th>
                                        <th>Stok</th>
                                        <th>Nilai</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-barang">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Terbaru</div>
                            <button class="btn btn-primary btn-sm" onclick="showPage('pemesanan')">
                                <i class="fas fa-eye"></i> Lihat Semua
                            </button>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Customer</th>
                                        <th>Status</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-pesanan">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Barang Brangkas Page -->
            <div class="page" id="barang-brangkas-page">
                <div class="header">
                    <h1>Barang Brangkas</h1>
                    <div class="user-info">
                        <button class="btn btn-primary" id="tambah-barang-btn">
                            <i class="fas fa-plus"></i> Tambah Barang
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-barang" placeholder="Cari barang...">
                    </div>
                    <div class="filter-options">
                        <select id="filter-kategori" class="form-control">
                            <option value="">Semua Kategori</option>
                            <option value="Class 1">Class 1</option>
                            <option value="Class 2">Class 2</option>
                            <option value="Narcotics">Narcotics</option>
                            <option value="Heist-Stuff">Heist Stuff</option>
                            <option value="Ammo">Ammo</option>
                            <option value="Armor">Armor</option>
                            <option value="Attachment">Attachment</option>
                        </select>
                        <select id="filter-status-barang" class="form-control">
                            <option value="">Semua Status</option>
                            <option value="ready">Ready</option>
                            <option value="preorder">Pre-order</option>
                        </select>
                    </div>
                </div>

                <!-- Item Grid -->
                <div class="item-grid" id="barang-grid">
                    <!-- Data barang akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Pemesanan Page -->
            <div class="page" id="pemesanan-page">
                <div class="header">
                    <h1>Pemesanan</h1>
                    <div class="user-info">
                        <button class="btn btn-info" id="copy-all-pending-btn">
                            <i class="fas fa-copy"></i> Copy Semua Pending
                        </button>
                        <button class="btn btn-primary" id="buat-pesanan-btn">
                            <i class="fas fa-plus"></i> Buat Pesanan
                        </button>
                        <button class="btn btn-success" id="checkout-btn" style="display: none;">
                            <i class="fas fa-cash-register"></i> Checkout 
                            <span id="cart-count" class="cart-badge">0</span>
                        </button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="semua-pesanan">Semua Pesanan</div>
                    <div class="tab" data-tab="pesanan-aktif">Pesanan Aktif</div>
                    <div class="tab" data-tab="pesanan-lunas">Lunas</div>
                    <div class="tab" data-tab="pesanan-hutang">Hutang</div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content active" id="semua-pesanan-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Daftar Semua Pesanan</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Tanggal</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Pembayaran</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="semua-pesanan-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="pesanan-aktif-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Aktif</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Tanggal</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pesanan-aktif-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="pesanan-lunas-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Lunas</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Tanggal</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Penerima</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pesanan-lunas-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="pesanan-hutang-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pesanan Hutang</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Tanggal</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Sisa</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pesanan-hutang-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checkout Page -->
            <div class="page" id="checkout-page">
                <div class="header">
                    <h1>Checkout Pesanan</h1>
                    <div class="user-info">
                        <button class="btn btn-primary" id="kembali-pesanan-btn">
                            <i class="fas fa-arrow-left"></i> Kembali ke Pemesanan
                        </button>
                    </div>
                </div>

                <div class="checkout-container">
                    <div class="checkout-header">
                        <div class="checkout-title">Keranjang Belanja</div>
                        <button class="btn btn-danger" id="kosongkan-keranjang-btn">
                            <i class="fas fa-trash"></i> Kosongkan Keranjang
                        </button>
                    </div>

                    <div class="cart-items" id="cart-items">
                        <!-- Item keranjang akan diisi oleh JavaScript -->
                    </div>

                    <div class="checkout-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotal">$ 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Diskon:</span>
                            <span id="diskon">$ 0</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total:</span>
                            <span id="total-checkout">$ 0</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customer-name">Nama Customer</label>
                        <input type="text" id="customer-name" class="form-control" placeholder="Masukkan nama customer">
                    </div>
                    <div class="form-group">
                        <label for="status-pembayaran">Status Pembayaran</label>
                        <select id="status-pembayaran" class="form-control" onchange="toggleUangDibayar()">
                            <option value="belum">Belum Bayar</option>
                            <option value="lunas">Lunas</option>
                        </select>
                    </div>

                    <div class="form-group" id="uang-dibayar-group" style="display: none;">
                        <label for="uang-dibayar">Uang Dibayar ($)</label>
                        <input type="number" id="uang-dibayar" class="form-control" placeholder="0" min="0" value="0">
                    </div>

                    <div class="form-group" id="penerima-pembayaran-group" style="display: none;">
                        <label for="penerima-pembayaran">Penerima Pembayaran</label>
                        <select id="penerima-pembayaran" class="form-control">
                            <option value="">Pilih Penerima</option>
                            <option value="Zowed">Zowed</option>
                            <option value="Asap">Asap</option>
                            <option value="Ruuna">Ruuna</option>
                            <option value="Vyan">Vyan</option>
                        </select>
                    </div>

                    <div class="form-group" id="keterangan-pembayaran-group" style="display: none;">
                        <label for="keterangan-pembayaran">Keterangan Pembayaran</label>
                        <textarea id="keterangan-pembayaran" class="form-control" placeholder="Tambahkan keterangan pembayaran (opsional)" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="keterangan">Keterangan</label>
                        <textarea id="keterangan" class="form-control" placeholder="Tambahkan keterangan pesanan"></textarea>
                    </div>

                    <div class="form-group">
                        <button class="btn btn-success btn-block" id="proses-checkout-btn">
                            <i class="fas fa-check"></i> Proses Checkout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Keuangan Page -->
            <div class="page" id="keuangan-page">
                <div class="header">
                    <h1>Manajemen Keuangan</h1>
                    <div class="user-info">
                        <button class="btn btn-primary" id="tambah-transaksi-btn">
                            <i class="fas fa-plus"></i> Tambah Transaksi
                        </button>
                        <button class="btn btn-danger" id="detail-hutang-btn">
                            <i class="fas fa-file-invoice-dollar"></i> Detail Piutang
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Saldo Kas</div>
                            <div class="card-icon bg-primary">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="saldo-kas">$ 0</div>
                        <div class="card-desc">Total saldo saat ini</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pemasukan Bulan Ini</div>
                            <div class="card-icon bg-success">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pemasukan-bulan">$ 0</div>
                        <div class="card-desc">Total pemasukan bulan ini</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pengeluaran Bulan Ini</div>
                            <div class="card-icon bg-danger">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pengeluaran-bulan">$ 0</div>
                        <div class="card-desc">Total pengeluaran bulan ini</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Laba Bulan Ini</div>
                            <div class="card-icon bg-info">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laba-bulan">$ 0</div>
                        <div class="card-desc">Laba bersih bulan ini</div>
                    </div>
                </div>

                <!-- Hutang Summary -->
                <div id="hutang-summary"></div>

                <!-- Search and Filter -->
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-keuangan" placeholder="Cari transaksi...">
                    </div>
                    <div class="filter-options">
                        <select id="filter-jenis" class="form-control">
                            <option value="">Semua Jenis</option>
                            <option value="pemasukan">Pemasukan</option>
                            <option value="pengeluaran">Pengeluaran</option>
                        </select>
                        <input type="month" id="filter-bulan" class="form-control">
                    </div>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Riwayat Transaksi</div>
                        <div class="action-buttons">
                            <button class="btn btn-success btn-sm">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th>Jenis</th>
                                    <th>Jumlah</th>
                                    <th>Saldo</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="transaksi-table">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Laporan Page -->
            <div class="page" id="laporan-page">
                <div class="header">
                    <h1>Laporan</h1>
                    <div class="user-info">
                        <button class="btn btn-success">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                </div>

                <!-- Filter Options -->
                <div class="search-filter">
                    <div class="filter-options">
                        <span class="filter-label">Periode:</span>
                        <input type="month" id="laporan-bulan" class="form-control">
                        <button class="btn btn-primary" id="generate-laporan-btn">
                            <i class="fas fa-sync-alt"></i> Generate Laporan
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Pemasukan</div>
                            <div class="card-icon bg-success">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-pemasukan">$ 0</div>
                        <div class="card-desc">Total pemasukan periode</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Pengeluaran</div>
                            <div class="card-icon bg-danger">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-pengeluaran">$ 0</div>
                        <div class="card-desc">Total pengeluaran periode</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Laba Bersih</div>
                            <div class="card-icon bg-info">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-laba">$ 0</div>
                        <div class="card-desc">Laba bersih periode</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Pesanan</div>
                            <div class="card-icon bg-warning">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="card-value" id="laporan-pesanan">0</div>
                        <div class="card-desc">Jumlah pesanan periode</div>
                    </div>
                </div>


                <!-- Tables -->
                <div class="tables">
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Transaksi Keuangan</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Keterangan</th>
                                        <th>Jenis</th>
                                        <th>Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody id="laporan-transaksi-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Pembayaran Pesanan Lunas</div>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Pesanan</th>
                                        <th>Customer</th>
                                        <th>Total</th>
                                        <th>Penerima</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="laporan-pembayaran-table">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bendahara Page -->
            <div class="page" id="bendahara-page">
                <div class="header">
                    <h1>Dashboard Bendahara</h1>
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar-bendahara">B</div>
                        <button class="logout-btn" id="logout-btn-bendahara">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="bendahara-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-uang-dikasih">$ 0</div>
                        <div class="stat-label">Total Uang Dikasih</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-pesanan-dikasih">0</div>
                        <div class="stat-label">Pesanan Dikasih</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-pesanan-belum">0</div>
                        <div class="stat-label">Pesanan Belum Dikasih</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="rata-rata-dikasih">$ 0</div>
                        <div class="stat-label">Rata-rata per Pesanan</div>
                    </div>
                </div>

                <!-- Summary Section -->
                <div class="bendahara-summary">
                    <h3>Ringkasan Uang Dikasih ke Bendahara</h3>
                    <div class="summary-grid">
                        <div class="summary-item uang-dikasih-item">
                            <div class="summary-item-label">Uang Sudah Dikasih</div>
                            <div class="summary-item-value" id="summary-sudah-dikasih">$ 0</div>
                        </div>
                        <div class="summary-item uang-belum-dikasih-item">
                            <div class="summary-item-label">Uang Belum Dikasih</div>
                            <div class="summary-item-value" id="summary-belum-dikasih">$ 0</div>
                        </div>
                    </div>
                </div>

                <!-- Penerima Breakdown -->
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Breakdown per Penerima</div>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Penerima</th>
                                    <th>Jumlah Pesanan</th>
                                    <th>Total Uang</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="penerima-breakdown">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Recent Uang Dikasih -->
                <div class="table-container" style="margin-top: 1.5rem;">
                    <div class="table-header">
                        <div class="table-title">Riwayat Uang Dikasih Terbaru</div>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID Pesanan</th>
                                    <th>Tanggal</th>
                                    <th>Customer</th>
                                    <th>Penerima</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recent-uang-dikasih">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                &copy; 2025 DSG on TOP
            </div>
        </div>
    </div>

    <!-- Modal Tambah Barang -->
    <div class="modal" id="tambah-barang-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Tambah Barang Baru</div>
                <button class="close-modal" onclick="closeModal('tambah-barang-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="tambah-barang-form">
                <div class="form-group">
                    <label for="nama-barang">Nama Barang</label>
                    <input type="text" id="nama-barang" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="kategori-barang">Kategori</label>
                    <select id="kategori-barang" class="form-control" required>
                            <option value="">Semua Kategori</option>
                            <option value="Class 1">Class 1</option>
                            <option value="Class 2">Class 2</option>
                            <option value="Narcotics">Narcotics</option>
                            <option value="Heist-Stuff">Heist Stuff</option>
                            <option value="Ammo">Ammo</option>
                            <option value="Armor">Armor</option>
                            <option value="Attachment">Attachment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="status-barang">Status Barang</label>
                    <select id="status-barang" class="form-control" required>
                        <option value="ready">Ready</option>
                        <option value="preorder">Pre-order</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="harga-barang">Harga ($)</label>
                    <input type="number" id="harga-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="stok-barang">Stok</label>
                    <input type="number" id="stok-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="deskripsi-barang">Deskripsi</label>
                    <textarea id="deskripsi-barang" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">Simpan Barang</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Edit Barang -->
    <div class="modal" id="edit-barang-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Barang</div>
                <button class="close-modal" onclick="closeModal('edit-barang-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-barang-form">
                <input type="hidden" id="edit-barang-id">
                <div class="form-group">
                    <label for="edit-nama-barang">Nama Barang</label>
                    <input type="text" id="edit-nama-barang" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="edit-kategori-barang">Kategori</label>
                    <select id="edit-kategori-barang" class="form-control" required>
                            <option value="">Semua Kategori</option>
                            <option value="Class 1">Class 1</option>
                            <option value="Class 2">Class 2</option>
                            <option value="Narcotics">Narcotics</option>
                            <option value="Heist-Stuff">Heist Stuff</option>
                            <option value="Ammo">Ammo</option>
                            <option value="Armor">Armor</option>
                            <option value="Attachment">Attachment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-status-barang">Status Barang</label>
                    <select id="edit-status-barang" class="form-control" required>
                        <option value="ready">Ready</option>
                        <option value="preorder">Pre-order</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-harga-barang">Harga ($)</label>
                    <input type="number" id="edit-harga-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="edit-stok-barang">Stok</label>
                    <input type="number" id="edit-stok-barang" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="edit-deskripsi-barang">Deskripsi</label>
                    <textarea id="edit-deskripsi-barang" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">Update Barang</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Tambah Transaksi -->
    <div class="modal" id="tambah-transaksi-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Tambah Transaksi</div>
                <button class="close-modal" onclick="closeModal('tambah-transaksi-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="tambah-transaksi-form">
                <div class="form-group">
                    <label for="jenis-transaksi">Jenis Transaksi</label>
                    <select id="jenis-transaksi" class="form-control" required>
                        <option value="">Pilih Jenis</option>
                        <option value="pemasukan">Pemasukan</option>
                        <option value="pengeluaran">Pengeluaran</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="jumlah-transaksi">Jumlah ($)</label>
                    <input type="number" id="jumlah-transaksi" class="form-control" required min="0">
                </div>
                <div class="form-group">
                    <label for="keterangan-transaksi">Keterangan</label>
                    <textarea id="keterangan-transaksi" class="form-control" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="tanggal-transaksi">Tanggal</label>
                    <input type="date" id="tanggal-transaksi" class="form-control" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">Simpan Transaksi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // ===============================
        // MAPPING GAMBAR BARANG - LENGKAP
        // ===============================
        const gambarBarang = {
            'ceramic': 'images/ceramic.png',
            'glock': 'images/glock.png',
            'blue': 'images/armor.png',
            'mini smg': 'images/mini.png',
            'submachine': 'images/smg.png',
            'p50': 'images/DE.png',
            'black revolver': 'images/black.png',
            'micro': 'images/micro.png',
            'shotgun': 'images/shotgun.png',
            'navy': 'images/navy.png',
            'tec9': 'images/tec9.png',
            '.44': 'images/ammo44.png',
            '.9mm': 'images/9mm.png',
            '.50': 'images/ammo50.png',
            'sg': 'images/sg.png',
            'seeds': 'images/canabis.png',
            'baggy': 'images/baggy.png',
            'lockpick': 'images/lp.png',
            'flashlight': 'images/tf.png',
            'supresor': 'images/supre.png',
            'tactical': 'images/tsupre.png',
            'grip': 'images/grip.png',
            'clip': 'images/clip.png',
            'drum': 'images/drum.png',
            'extended': 'images/extended.png',
            'scope': 'images/scope.png',
            'meth': 'images/meth.png',
            'red': 'images/red.png',
            'tablet': 'images/tablet.png',
            'meja': 'images/meja.png',
            // Fallback dan default
            'default': 'images/default.jpg'
        };

        // Fungsi untuk mendapatkan path gambar berdasarkan nama barang
        function getGambarBarang(namaBarang) {
            if (!namaBarang) return gambarBarang.default;
            
            const namaLower = namaBarang.toLowerCase();
            
            // Cek kata kunci dalam nama barang
            for (const [keyword, path] of Object.entries(gambarBarang)) {
                if (namaLower.includes(keyword.toLowerCase())) {
                    return path;
                }
            }
            
            // Default image jika tidak ditemukan
            return gambarBarang.default;
        }

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyApaIrtIi2FHY4gMlvC_hOfIT8jxiAC_84",
            authDomain: "brangkas-b589c.firebaseapp.com",
            databaseURL: "https://brangkas-b589c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "brangkas-b589c",
            storageBucket: "brangkas-b589c.firebasestorage.app",
            messagingSenderId: "299756262395",
            appId: "1:299756262395:web:ef8cfc8c89a51ba53eb15e",
            measurementId: "G-L94TPZ82Q7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Data barang dan transaksi
        let barangData = [];
        let transaksiData = [];
        let pesananData = [];
        let isAdmin = false;
        let currentUser = null;
        let cart = [];
        let appInitialized = false;

        // ===============================
        // AUTO REFRESH REAL-TIME SYSTEM
        // ===============================
        
        // Setup real-time listeners untuk auto refresh
        function setupRealtimeListeners() {

            database.ref('pesanan').on('value', (snapshot) => {
                const newPesananData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const pesanan = childSnapshot.val();
                        pesanan.id = childSnapshot.key;
                        if (pesanan.sudah_dikasih === undefined) {
                            pesanan.sudah_dikasih = false;
                        }
                        newPesananData.push(pesanan);
                    });
                }
                
                if (JSON.stringify(pesananData) !== JSON.stringify(newPesananData)) {
                    pesananData = newPesananData;
                    updateDashboard();
                    updatePesananUI();
                    updateLaporan();
                    updateBendaharaDashboard(); // Tambahkan ini
                    console.log('ðŸ”„ Data pesanan diperbarui secara real-time');
                }
            });
            // Listen untuk perubahan data barang
            database.ref('barang').on('value', (snapshot) => {
                const newBarangData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const barang = childSnapshot.val();
                        barang.id = childSnapshot.key;
                        // Pastikan harga berupa number
                        if (barang.harga && typeof barang.harga === 'string') {
                            barang.harga = parseInt(barang.harga.replace(/\D/g, '')) || 0;
                        }
                        // Default status jika tidak ada
                        if (!barang.status) {
                            barang.status = 'ready';
                        }
                        newBarangData.push(barang);
                    });
                }
                
                // Update hanya jika ada perubahan
                if (JSON.stringify(barangData) !== JSON.stringify(newBarangData)) {
                    barangData = newBarangData;
                    updateDashboard();
                    updateBarangUI();
                    updateBendaharaDashboard(); // Tambahkan ini
                    console.log('ðŸ”„ Data barang diperbarui secara real-time');
                }
            }
        );

            // Checkout button - dengan error handling
            const checkoutBtn = document.getElementById('checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function() {
                    console.log('ðŸ›’ Tombol checkout diklik');
                    if (cart.length === 0) {
                        showNotification('Keranjang masih kosong!', 'error');
                        return;
                    }
                    showPage('checkout');
                });
            } else {
                console.error('âŒ Tombol checkout tidak ditemukan');
            }

            // Kembali ke pesanan dari checkout
            const kembaliBtn = document.getElementById('kembali-pesanan-btn');
            if (kembaliBtn) {
                kembaliBtn.addEventListener('click', function() {
                    showPage('pemesanan');
                });
            }

            // Listen untuk perubahan data pesanan
            database.ref('pesanan').on('value', (snapshot) => {
                const newPesananData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const pesanan = childSnapshot.val();
                        pesanan.id = childSnapshot.key;
                        if (pesanan.sudah_dikasih === undefined) {
                            pesanan.sudah_dikasih = false;
                        }
                        newPesananData.push(pesanan);
                    });
                }
                
                if (JSON.stringify(pesananData) !== JSON.stringify(newPesananData)) {
                    pesananData = newPesananData;
                    updateDashboard();
                    updatePesananUI();
                    updateLaporan();
                    console.log('ðŸ”„ Data pesanan diperbarui secara real-time');
                }
            });

            // Listen untuk perubahan data transaksi
            database.ref('transaksi').on('value', (snapshot) => {
                const newTransaksiData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const transaksi = childSnapshot.val();
                        transaksi.id = childSnapshot.key;
                        newTransaksiData.push(transaksi);
                    });
                }
                
                if (JSON.stringify(transaksiData) !== JSON.stringify(newTransaksiData)) {
                    transaksiData = newTransaksiData;
                    updateDashboard();
                    updateTransaksiUI();
                    console.log('ðŸ”„ Data transaksi diperbarui secara real-time');
                }
            });
        }

        // ===============================
        // CONFIRMATION MODAL SYSTEM
        // ===============================

        let currentConfirmationCallback = null;
        let currentDeleteCallback = null;

        // Show confirmation modal
        function showConfirmation(message, callback, type = 'confirm') {
            const modal = document.getElementById('confirmation-modal');
            const messageElement = document.getElementById('confirmation-message');
            const iconElement = document.getElementById('confirmation-icon');
            const confirmBtn = document.getElementById('confirmation-confirm-btn');
            
            messageElement.textContent = message;
            currentConfirmationCallback = callback;
            
            // Set icon and button based on type
            if (type === 'success') {
                iconElement.className = 'confirmation-icon success';
                iconElement.innerHTML = '<i class="fas fa-check"></i>';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> Ya';
            } else if (type === 'warning') {
                iconElement.className = 'confirmation-icon';
                iconElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> Ya';
            } else {
                iconElement.className = 'confirmation-icon';
                iconElement.innerHTML = '<i class="fas fa-question"></i>';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> Ya';
            }
            
            modal.classList.add('active');
        }

        // ===============================
        // NEW FUNCTIONS FOR PAYMENT AND COPY FEATURES
        // ===============================

        // Fungsi untuk menandai pesanan sudah dibayar lunas
        function markPesananAsPaid(pesananId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menandai pesanan sudah dibayar!', 'error');
                return;
            }
            
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            showConfirmation(
                `Tandai pesanan ${pesanan.id} sebagai LUNAS?
                Customer: ${pesanan.customer}
                Total: ${formatDollar(pesanan.total)}
                Uang dibayar akan disesuaikan menjadi ${formatDollar(pesanan.total)}`,
                function() {
                    // Update status menjadi lunas dengan uang dibayar sama dengan total
                    database.ref('pesanan/' + pesananId).update({
                        status_pembayaran: 'lunas',
                        uang_dibayar: pesanan.total,
                        status: 'lunas'
                    })
                    .then(() => {
                        showNotification(`Pesanan ${pesanan.id} berhasil ditandai sebagai LUNAS!`, 'success');
                        closeModal('detail-pesanan-modal');
                        
                        // Otomatis buat transaksi keuangan
                        addTransactionOnPayment(pesananId);
                    })
                    .catch(error => {
                        showNotification('Gagal memperbarui status pembayaran: ' + error.message, 'error');
                    });
                },
                'warning'
            );
        }

        // Fungsi untuk menambahkan transaksi dari pesanan yang sudah dibayar
        function addTransaksiFromPesanan(pesanan) {
            const newTransaksi = {
                jenis: 'pemasukan',
                jumlah: pesanan.total,
                keterangan: `Pembayaran pesanan ${pesanan.id} dari ${pesanan.customer}`,
                tanggal: new Date().toISOString().split('T')[0],
                created_at: new Date().toISOString(),
                related_pesanan: pesanan.id
            };
            
            // Save to Firebase
            database.ref('transaksi').push(newTransaksi)
                .then(() => {
                    console.log('âœ… Transaksi pembayaran berhasil ditambahkan');
                })
                .catch(error => {
                    console.error('âŒ Gagal menambah transaksi pembayaran:', error);
                });
        }

        // ===============================
        // NEW FUNCTION FOR COPY ALL PENDING ORDERS
        // ===============================

        // Fungsi untuk menyalin semua item dari pesanan yang belum diproses
        function copyAllPendingOrders() {
            // Filter pesanan yang belum diproses (belum dikasih)
            const pendingPesanan = pesananData.filter(p => !p.sudah_dikasih);
            
            if (pendingPesanan.length === 0) {
                showNotification('Tidak ada pesanan yang belum diproses!', 'info');
                return;
            }
            
            // Gabungkan semua items dari pesanan pending
            const allItems = [];
            
            pendingPesanan.forEach(pesanan => {
                pesanan.items.forEach(item => {
                    // Cek apakah item sudah ada di allItems
                    const existingItem = allItems.find(i => i.nama === item.nama);
                    
                    if (existingItem) {
                        // Jika sudah ada, tambahkan quantity
                        existingItem.quantity += item.quantity;
                    } else {
                        // Jika belum ada, tambahkan item baru
                        allItems.push({
                            nama: item.nama,
                            quantity: item.quantity
                        });
                    }
                });
            });
            
            if (allItems.length === 0) {
                showNotification('Tidak ada items dalam pesanan pending!', 'info');
                return;
            }
            
            // Format teks untuk disalin
            let itemsText = `ITEMS PESANAN PENDING (${pendingPesanan.length} pesanan)\n\n`;
            
            allItems.forEach((item, index) => {
                itemsText += `${item.nama} - ${item.quantity}x\n`;
            });
            
            // Tambahkan ringkasan
            itemsText += `\n-------------------\n`;
            itemsText += `Total Items: ${allItems.length} jenis\n`;
            itemsText += `Total Pesanan: ${pendingPesanan.length} pesanan`;
            
            // Salin ke clipboard
            navigator.clipboard.writeText(itemsText)
                .then(() => {
                    showNotification(`Berhasil menyalin ${allItems.length} items dari ${pendingPesanan.length} pesanan pending!`, 'success');
                })
                .catch(err => {
                    console.error('Gagal menyalin teks: ', err);
                    fallbackCopyTextToClipboard(itemsText);
                });
        }

        // Fungsi untuk menyalin items pesanan ke clipboard
        function copyPesananItems(pesanan) {
            // Format teks untuk disalin - HANYA ITEM DAN QUANTITY
            let itemsText = ``;
            
            pesanan.items.forEach((item, index) => {
                itemsText += `${item.nama} - ${item.quantity}x\n`;
            });
            
            // Salin ke clipboard
            navigator.clipboard.writeText(itemsText)
                .then(() => {
                    showNotification('Items pesanan berhasil disalin ke clipboard!', 'success');
                    })
                .catch(err => {
                    console.error('Gagal menyalin teks: ', err);
                    // Fallback untuk browser yang tidak support clipboard API
                    fallbackCopyTextToClipboard(itemsText);
                });
        }

        // Fallback untuk menyalin teks (untuk browser lama)
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification('Items pesanan berhasil disalin ke clipboard!', 'success');
                } else {
                    showNotification('Gagal menyalin items pesanan!', 'error');
                }
            } catch (err) {
                console.error('Fallback copy gagal: ', err);
                showNotification('Gagal menyalin items pesanan!', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // Hide confirmation modal
        function hideConfirmation() {
            document.getElementById('confirmation-modal').classList.remove('active');
            currentConfirmationCallback = null;
        }

        // Show delete confirmation modal
        function showDeleteConfirmation(message, callback) {
            const modal = document.getElementById('delete-confirmation-modal');
            const messageElement = document.getElementById('delete-confirmation-message');
            
            messageElement.textContent = message;
            currentDeleteCallback = callback;
            modal.classList.add('active');
        }

        // Hide delete confirmation modal
        function hideDeleteConfirmation() {
            document.getElementById('delete-confirmation-modal').classList.remove('active');
            currentDeleteCallback = null;
        }

        // Setup confirmation button handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Confirmation modal
            document.getElementById('confirmation-confirm-btn').addEventListener('click', function() {
                if (currentConfirmationCallback) {
                    currentConfirmationCallback();
                }
                hideConfirmation();
            });
            
            // Delete confirmation modal
            document.getElementById('delete-confirm-btn').addEventListener('click', function() {
                if (currentDeleteCallback) {
                    currentDeleteCallback();
                }
                hideDeleteConfirmation();
            });
            
            // Close modals when clicking outside
            document.getElementById('confirmation-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideConfirmation();
                }
            });
            
            document.getElementById('delete-confirmation-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideDeleteConfirmation();
                }
            });
        });

        // ===============================
        // AUTHENTICATION SYSTEM
        // ===============================

        // Admin credentials
        const adminUsers = {
            'admin@brangkas.com': {
                password: 'admin123',
                name: 'Admin Brangkas',
                role: 'Administrator'
            }
        };

        // Initialize app for public access
        function initializeApp() {
            // Cek status login dari localStorage
            const savedUser = localStorage.getItem('brangkas_user');
            const savedAdmin = localStorage.getItem('brangkas_admin');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isAdmin = savedAdmin === 'true';
                showApp();
            } else {
                showLogin();
            }
        }

        // ===============================
        // FIXED EVENT LISTENER MANAGEMENT
        // ===============================

        let eventListenersSetup = false;

        function setupEventListeners() {
            // Cegah setup ganda
            if (eventListenersSetup) {
                console.log('âš ï¸ Event listeners sudah di-setup sebelumnya');
                return;
            }
            
            console.log('ðŸ”„ Setting up event listeners...');
            
            // Setup payment listeners
            setupPaymentListeners();
            
            const statusPembayaranElement = document.getElementById('status-pembayaran');
            if (statusPembayaranElement) {
                statusPembayaranElement.addEventListener('change', toggleUangDibayar);
            }

            // Login form - FIXED (gunakan once atau removeEventListener)
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.removeEventListener('submit', handleLogin);
                loginForm.addEventListener('submit', handleLogin);
            }
            
            const publicAccessBtn = document.getElementById('public-access-btn');
            if (publicAccessBtn) {
                publicAccessBtn.removeEventListener('click', handlePublicAccess);
                publicAccessBtn.addEventListener('click', handlePublicAccess);
            }
            
            // Navigation - FIXED (gunakan event delegation)
            document.querySelector('.nav-links').addEventListener('click', function(e) {
                if (e.target.closest('.nav-link')) {
                    e.preventDefault();
                    const link = e.target.closest('.nav-link');
                    const page = link.getAttribute('data-page');
                    showPage(page);
                }
            });

            // Tabs - FIXED (gunakan event delegation)
            document.querySelector('.tabs').addEventListener('click', function(e) {
                if (e.target.closest('.tab')) {
                    const tab = e.target.closest('.tab');
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                }
            });

            // Modal buttons - FIXED
            setupModalButtons();
            
            // Forms - FIXED
            setupFormHandlers();
            
            // Logout - FIXED
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.removeEventListener('click', handleLogout);
                logoutBtn.addEventListener('click', handleLogout);
            }

            // Real-time listeners
            setupRealtimeListeners();
            
            eventListenersSetup = true;
            console.log('âœ… Event listeners berhasil di-setup');
        }

        function setupModalButtons() {
            const buttons = [
                { id: 'tambah-barang-btn', modal: 'tambah-barang-modal' },
                { id: 'tambah-transaksi-btn', modal: 'tambah-transaksi-modal' },
                { id: 'buat-pesanan-btn', action: () => showPage('barang-brangkas') },
                { id: 'checkout-btn', action: handleCheckoutClick },
                { id: 'kembali-pesanan-btn', action: () => showPage('pemesanan') },
                { id: 'copy-all-pending-btn', action: copyAllPendingOrders },
                { id: 'kosongkan-keranjang-btn', action: kosongkanKeranjang },
                { id: 'proses-checkout-btn', action: prosesCheckout },
                { id: 'detail-hutang-btn', action: viewHutangDetail }
            ];

            buttons.forEach(button => {
                const element = document.getElementById(button.id);
                if (element) {
                    // Hapus event listener lama
                    element.removeEventListener('click', button.action || (() => showModal(button.modal)));
                    
                    // Tambah event listener baru
                    if (button.action) {
                        element.addEventListener('click', button.action);
                    } else {
                        element.addEventListener('click', () => showModal(button.modal));
                    }
                }
            });
        }

        function setupFormHandlers() {
            const forms = [
                { id: 'tambah-barang-form', handler: handleTambahBarang },
                { id: 'edit-barang-form', handler: handleEditBarang },
                { id: 'tambah-transaksi-form', handler: handleTambahTransaksi }
            ];

            forms.forEach(form => {
                const element = document.getElementById(form.id);
                if (element) {
                    element.removeEventListener('submit', form.handler);
                    element.addEventListener('submit', form.handler);
                }
            });
        }

        // ===============================
        // FIXED SHOW PAGE FUNCTION
        // ===============================

        let currentPage = 'dashboard';

        function showPage(pageId) {
            try {
                // Cegah panggilan berulang ke halaman yang sama
                if (currentPage === pageId) {
                    console.log(`â„¹ï¸ Sudah di halaman ${pageId}, skip navigasi`);
                    return;
                }
                
                console.log('ðŸ”„ Menampilkan halaman:', pageId);
                
                // Sembunyikan semua halaman
                document.querySelectorAll('.page').forEach(page => {
                    if (page && page.classList) {
                        page.classList.remove('active');
                    }
                });
                
                // Cek apakah halaman yang diminta ada
                const pageElement = document.getElementById(`${pageId}-page`);
                if (!pageElement) {
                    console.error(`âŒ Halaman ${pageId} tidak ditemukan (${pageId}-page)`);
                    // Fallback ke dashboard
                    pageId = 'dashboard';
                }
                
                // Tampilkan halaman yang dipilih
                const targetPage = document.getElementById(`${pageId}-page`);
                if (targetPage && targetPage.classList) {
                    targetPage.classList.add('active');
                } else {
                    console.error(`âŒ Tidak dapat menampilkan halaman ${pageId}`);
                    return;
                }
                
                // Update nav link active state
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link && link.classList) {
                        link.classList.remove('active');
                        if (link.getAttribute('data-page') === pageId) {
                            link.classList.add('active');
                        }
                    }
                });
                
                // Update cart badge
                updateCartBadge();
                
                // Jika pindah ke checkout page, update UI-nya
                if (pageId === 'checkout') {
                    updateCheckoutPage();
                }
                
                // Update current page
                currentPage = pageId;
                
                console.log('âœ… Halaman berhasil ditampilkan:', pageId);
                
            } catch (error) {
                console.error('âŒ Error dalam showPage:', error);
                // Fallback ke dashboard jika ada error
                try {
                    document.querySelectorAll('.page').forEach(page => {
                        if (page && page.classList) {
                            page.classList.remove('active');
                        }
                    });
                    const dashboardPage = document.getElementById('dashboard-page');
                    if (dashboardPage && dashboardPage.classList) {
                        dashboardPage.classList.add('active');
                    }
                    currentPage = 'dashboard';
                } catch (fallbackError) {
                    console.error('âŒ Error fallback:', fallbackError);
                }
            }
        }

        // ===============================
        // FIXED CHECKOUT BUTTON HANDLER
        // ===============================

        function handleCheckoutClick() {
            console.log('ðŸ›’ Tombol checkout diklik');
            if (cart.length === 0) {
                showNotification('Keranjang masih kosong!', 'error');
                return;
            }
            showPage('checkout');
        }

        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            const badge = document.querySelector('.cart-badge');
            
            if (badge) {
                if (totalItems > 0) {
                    badge.textContent = totalItems;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        // Fungsi-fungsi UI
        function showLogin() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        function showApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            
            // Tampilkan/hide menu admin berdasarkan role
            document.getElementById('admin-keuangan').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('admin-bendahara').style.display = isAdmin ? 'block' : 'none';
            
            // Update UI awal
            updateDashboard();
            updateBarangUI();
            updatePesananUI();
            if (isAdmin) {
                updateTransaksiUI();
                updateBendaharaDashboard(); // Tambahkan ini
            }
            
            showNotification('Selamat datang di Brangkas!', 'success');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function switchTab(tabId) {
            // Update tab active state
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            
            // Set message and type
            messageElement.textContent = message;
            notification.className = `notification ${type}`;
            
            // Show notification
            notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // Fungsi-fungsi Authentication
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simulasi login admin
            if (email === 'dsg@brangkas.com' && password === 'dsgjaya') {
                currentUser = { email: email, name: 'Administrator' };
                isAdmin = true;
                
                // Simpan ke localStorage
                localStorage.setItem('brangkas_user', JSON.stringify(currentUser));
                localStorage.setItem('brangkas_admin', 'true');
                
                showApp();
            } else {
                showNotification('Email atau password salah!', 'error');
            }
        }

        function handlePublicAccess() {
            currentUser = { email: 'public@brangkas.com', name: 'Pengguna Biasa' };
            isAdmin = false;
            
            // Simpan ke localStorage
            localStorage.setItem('brangkas_user', JSON.stringify(currentUser));
            localStorage.setItem('brangkas_admin', 'false');
            
            showApp();
        }

        function handleLogout() {
            currentUser = null;
            isAdmin = false;
            
            // Hapus dari localStorage
            localStorage.removeItem('brangkas_user');
            localStorage.removeItem('brangkas_admin');
            
            // Reset cart
            cart = [];
            saveCartToStorage();
            updateCartUI();
            
            showLogin();
            showNotification('Anda telah logout', 'info');
        }

        // ===============================
// FUNGSI HAPUS LAPORAN PEMBAYARAN - ADMIN ONLY
// ===============================

// Fungsi untuk menghapus laporan pembayaran lunas
function deleteLaporanPembayaran(pesananId) {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menghapus laporan pembayaran!', 'error');
        return;
    }
    
    const pesanan = pesananData.find(p => p.id === pesananId);
    if (!pesanan) {
        showNotification('Pesanan tidak ditemukan!', 'error');
        return;
    }
    
    // Konfirmasi penghapusan
    showConfirmation(
        `HAPUS LAPORAN PEMBAYARAN?
        
        ID Pesanan: ${pesanan.id}
        Customer: ${pesanan.customer}
        Total: ${formatDollar(pesanan.total)}
        Penerima: ${pesanan.penerima_pembayaran || '-'}
        
        Tindakan ini akan:
        â€¢ Menghapus pesanan dari laporan pembayaran
        â€¢ Menghapus transaksi keuangan terkait
        â€¢ Mengembalikan status pesanan
        
        Apakah Anda yakin ingin melanjutkan?`,
        function() {
            // Hapus pesanan dari Firebase
            database.ref('pesanan/' + pesananId).remove()
                .then(() => {
                    console.log(`âœ… Pesanan ${pesananId} berhasil dihapus`);
                    
                    // Hapus transaksi keuangan terkait jika ada
                    const relatedTransaction = transaksiData.find(t => t.related_pesanan === pesananId);
                    if (relatedTransaction) {
                        return database.ref('transaksi/' + relatedTransaction.id).remove();
                    }
                    return Promise.resolve();
                })
                .then(() => {
                    console.log(`âœ… Transaksi terkait berhasil dihapus`);
                    
                    // Update stok barang jika perlu (kembalikan stok)
                    const updateStockPromises = pesanan.items.map(item => {
                        const barang = barangData.find(b => b.id === item.id);
                        if (barang && barang.status === 'ready') {
                            const newStock = barang.stok + item.quantity;
                            console.log(`ðŸ“¦ Kembalikan stok ${barang.nama}: ${barang.stok} -> ${newStock}`);
                            return database.ref('barang/' + item.id).update({ stok: newStock });
                        }
                        return Promise.resolve();
                    });
                    
                    return Promise.all(updateStockPromises);
                })
                .then(() => {
                    console.log(`âœ… Stok barang berhasil dikembalikan`);
                    
                    showNotification(`Laporan pembayaran ${pesananId} berhasil dihapus!`, 'success');
                    
                    // Refresh UI
                    updatePesananUI();
                    updateLaporan();
                    updateDashboard();
                })
                .catch(error => {
                    console.error('âŒ Error menghapus laporan pembayaran:', error);
                    showNotification('Gagal menghapus laporan pembayaran: ' + error.message, 'error');
                });
        },
        'danger'
    );
}

// Fungsi untuk menghapus multiple laporan pembayaran
function deleteMultipleLaporanPembayaran(pesananIds) {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menghapus laporan pembayaran!', 'error');
        return;
    }
    
    if (!pesananIds || pesananIds.length === 0) {
        showNotification('Tidak ada laporan yang dipilih untuk dihapus!', 'error');
        return;
    }
    
    showConfirmation(
        `HAPUS ${pesananIds.length} LAPORAN PEMBAYARAN?
        
        Anda akan menghapus ${pesananIds.length} laporan pembayaran sekaligus.
        
        Tindakan ini akan:
        â€¢ Menghapus semua pesanan terpilih
        â€¢ Menghapus transaksi keuangan terkait
        â€¢ Mengembalikan stok barang
        
        Apakah Anda yakin ingin melanjutkan?`,
        function() {
            let deleteCount = 0;
            let errorCount = 0;
            
            const deletePromises = pesananIds.map(pesananId => {
                const pesanan = pesananData.find(p => p.id === pesananId);
                if (!pesanan) return Promise.resolve();
                
                return database.ref('pesanan/' + pesananId).remove()
                    .then(() => {
                        // Hapus transaksi terkait
                        const relatedTransaction = transaksiData.find(t => t.related_pesanan === pesananId);
                        if (relatedTransaction) {
                            return database.ref('transaksi/' + relatedTransaction.id).remove();
                        }
                        return Promise.resolve();
                    })
                    .then(() => {
                        // Kembalikan stok barang
                        const updateStockPromises = pesanan.items.map(item => {
                            const barang = barangData.find(b => b.id === item.id);
                            if (barang && barang.status === 'ready') {
                                const newStock = barang.stok + item.quantity;
                                return database.ref('barang/' + item.id).update({ stok: newStock });
                            }
                            return Promise.resolve();
                        });
                        
                        return Promise.all(updateStockPromises);
                    })
                    .then(() => {
                        deleteCount++;
                        console.log(`âœ… Berhasil menghapus laporan ${pesananId}`);
                    })
                    .catch(error => {
                        errorCount++;
                        console.error(`âŒ Gagal menghapus laporan ${pesananId}:`, error);
                    });
            });
            
            Promise.all(deletePromises)
                .then(() => {
                    let message = `Berhasil menghapus ${deleteCount} laporan pembayaran!`;
                    if (errorCount > 0) {
                        message += ` (${errorCount} gagal)`;
                    }
                    
                    showNotification(message, deleteCount > 0 ? 'success' : 'error');
                    
                    // Refresh UI
                    updatePesananUI();
                    updateLaporan();
                    updateDashboard();
                })
                .catch(error => {
                    showNotification('Terjadi error saat menghapus laporan: ' + error.message, 'error');
                });
        },
        'danger'
    );
}

// Fungsi untuk menghapus semua laporan dalam periode tertentu
function deleteLaporanByPeriod() {
    if (!isAdmin) {
        showNotification('Hanya admin yang dapat menghapus laporan!', 'error');
        return;
    }
    
    const laporanBulan = document.getElementById('laporan-bulan').value;
    if (!laporanBulan) {
        showNotification('Pilih periode terlebih dahulu!', 'error');
        return;
    }
    
    const pesananBulan = pesananData.filter(p => p.tanggal.startsWith(laporanBulan));
    const pesananLunasBulan = pesananBulan.filter(p => p.status_pembayaran === 'lunas');
    
    if (pesananLunasBulan.length === 0) {
        showNotification(`Tidak ada laporan pembayaran untuk periode ${laporanBulan}!`, 'info');
        return;
    }
    
    showConfirmation(
        `HAPUS SEMUA LAPORAN PERIODE ${laporanBulan}?
        
        Jumlah Laporan: ${pesananLunasBulan.length} pesanan
        Total Nilai: ${formatDollar(pesananLunasBulan.reduce((sum, p) => sum + p.total, 0))}
        
        Tindakan ini akan menghapus SEMUA laporan pembayaran pada periode tersebut.
        Tindakan ini TIDAK DAPAT DIBATALKAN!
        
        Apakah Anda yakin ingin melanjutkan?`,
        function() {
            const pesananIds = pesananLunasBulan.map(p => p.id);
            deleteMultipleLaporanPembayaran(pesananIds);
        },
        'danger'
    );
}

        // ===============================
        // CART MANAGEMENT - IMPROVED DENGAN AUTO REFRESH
        // ===============================

        // Load cart from localStorage
        function loadCartFromStorage() {
            const savedCart = localStorage.getItem('brangkas_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
            updateCartUI();
        }

        // Save cart to localStorage
        function saveCartToStorage() {
            localStorage.setItem('brangkas_cart', JSON.stringify(cart));
        }

        // Add item to cart dengan real-time update
        function addToCart(barangId, jumlah = 1) {
            const barang = barangData.find(b => b.id === barangId);
            if (!barang) {
                showNotification('Barang tidak ditemukan!', 'error');
                return;
            }

            // Check stok untuk barang ready
            if (barang.status === 'ready' && barang.stok < jumlah) {
                showNotification(`Stok ${barang.nama} tidak mencukupi! Stok tersedia: ${barang.stok}`, 'error');
                return;
            }

            // Check if item already in cart
            const existingItem = cart.find(item => item.id === barangId);
            if (existingItem) {
                // Update quantity
                existingItem.quantity += jumlah;
                if (barang.status === 'ready' && existingItem.quantity > barang.stok) {
                    existingItem.quantity = barang.stok;
                    showNotification(`Jumlah ${barang.nama} disesuaikan dengan stok tersedia: ${barang.stok}`, 'warning');
                }
            } else {
                // Add new item
                cart.push({
                    id: barangId,
                    nama: barang.nama,
                    harga: barang.harga,
                    quantity: jumlah,
                    status: barang.status // Tambahkan status barang ke cart
                });
            }

            saveCartToStorage();
            updateCartUI();
            showNotification(`${barang.nama} ditambahkan ke keranjang`, 'success');
        }

        // Remove item from cart
        function removeFromCart(barangId) {
            cart = cart.filter(item => item.id !== barangId);
            saveCartToStorage();
            updateCartUI();
            showNotification('Item dihapus dari keranjang', 'info');
        }

        // Update cart quantity
        function updateCartQuantity(barangId, quantity) {
            const item = cart.find(item => item.id === barangId);
            if (item) {
                const barang = barangData.find(b => b.id === barangId);
                if (barang && barang.status === 'ready' && quantity > barang.stok) {
                    showNotification(`Stok ${barang.nama} tidak mencukupi! Stok tersedia: ${barang.stok}`, 'error');
                    return;
                }
                
                if (quantity <= 0) {
                    removeFromCart(barangId);
                } else {
                    item.quantity = quantity;
                    saveCartToStorage();
                    updateCartUI();
                }
            }
        }

        // Clear cart
        function kosongkanKeranjang() {
            if (cart.length === 0) {
                showNotification('Keranjang sudah kosong', 'info');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin mengosongkan keranjang?')) {
                cart = [];
                saveCartToStorage();
                updateCartUI();
                showNotification('Keranjang berhasil dikosongkan', 'success');
            }
        }

        // Update cart UI
        function updateCartUI() {
            // Update cart count badge
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
            document.getElementById('cart-count-badge').textContent = totalItems;
            
            // Show/hide cart badge
            const cartBadge = document.getElementById('cart-count-badge');
            cartBadge.style.display = totalItems > 0 ? 'block' : 'none';
            
            // Show/hide checkout button
            document.getElementById('checkout-btn').style.display = totalItems > 0 ? 'inline-flex' : 'none';
            
            // Update cart items in checkout page
            updateCheckoutPage();
        }

        // Update checkout page
        function updateCheckoutPage() {
            try {
                const cartItemsContainer = document.getElementById('cart-items');
                const subtotalElement = document.getElementById('subtotal');
                const diskonElement = document.getElementById('diskon');
                const totalElement = document.getElementById('total-checkout');
                
                if (!cartItemsContainer || !subtotalElement) {
                    console.error('âŒ Elemen checkout tidak ditemukan');
                    return;
                }
                
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = `
                        <div class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Keranjang Kosong</h3>
                            <p>Silakan tambahkan barang dari halaman Barang Brangkas</p>
                        </div>
                    `;
                    if (subtotalElement) subtotalElement.textContent = '$ 0';
                    if (diskonElement) diskonElement.textContent = '$ 0';
                    if (totalElement) totalElement.textContent = '$ 0';
                    return;
                }
                
                // Calculate totals
                const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
                const diskonInput = document.getElementById('diskon-input');
                const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
                const total = subtotal - diskon;
                
                // Update totals
                subtotalElement.textContent = formatDollar(subtotal);
                diskonElement.textContent = formatDollar(diskon);
                totalElement.textContent = formatDollar(total);
                
                // Update cart items
                cartItemsContainer.innerHTML = '';
                cart.forEach(item => {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    cartItemElement.innerHTML = `
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.nama} 
                                <span class="status-badge-barang ${item.status === 'ready' ? 'status-ready' : 'status-preorder'}">
                                    ${item.status === 'ready' ? 'READY' : 'PRE-ORDER'}
                                </span>
                            </div>
                            <div class="cart-item-price">${formatDollar(item.harga)} x ${item.quantity}</div>
                        </div>
                        <div class="cart-item-controls">
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="${item.quantity}" 
                                    onchange="updateCartQuantity('${item.id}', parseInt(this.value))" min="1">
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <button class="remove-btn" onclick="removeFromCart('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemElement);
                });
                
            } catch (error) {
                console.error('âŒ Error dalam updateCheckoutPage:', error);
            }
        }

        // ===============================
        // PAYMENT STATUS MANAGEMENT
        // ===============================

        // Toggle uang dibayar field based on payment status
        function toggleUangDibayar() {
            const statusPembayaran = document.getElementById('status-pembayaran').value;
            const uangDibayarGroup = document.getElementById('uang-dibayar-group');
            const penerimaPembayaranGroup = document.getElementById('penerima-pembayaran-group');
            const keteranganGroup = document.getElementById('keterangan-pembayaran-group');
            const uangDibayarInput = document.getElementById('uang-dibayar');
            
            if (statusPembayaran === 'belum') {
                // Belum bayar - hide input uang
                uangDibayarGroup.style.display = 'none';
                penerimaPembayaranGroup.style.display = 'none';
                keteranganGroup.style.display = 'none';
                uangDibayarInput.value = '0';
            } else if (statusPembayaran === 'lunas') {
                // Lunas - show uang dibayar dan set ke total
                uangDibayarGroup.style.display = 'block';
                penerimaPembayaranGroup.style.display = 'block';
                keteranganGroup.style.display = 'block';
                
                // Calculate total
                const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
                const diskonInput = document.getElementById('diskon-input');
                const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
                const total = subtotal - diskon;
                
                uangDibayarInput.value = total;
            } else if (statusPembayaran === 'dp') {
                // DP - show uang dibayar dengan nilai default 0
                uangDibayarGroup.style.display = 'block';
                penerimaPembayaranGroup.style.display = 'block';
                keteranganGroup.style.display = 'block';
                uangDibayarInput.value = '0';
            }
            
            updatePaymentSummary();
        }

        // Update payment summary display
        function updatePaymentSummary() {
            const statusPembayaran = document.getElementById('status-pembayaran').value;
            const uangDibayar = parseInt(document.getElementById('uang-dibayar').value) || 0;
            
            // Calculate totals
            const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
            const diskonInput = document.getElementById('diskon-input');
            const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
            const total = subtotal - diskon;
            
            const sisaBayar = total - uangDibayar;
            
            // Update summary display
            let summaryHtml = `
                <div class="payment-summary">
                    <div class="payment-summary-item">
                        <span>Subtotal:</span>
                        <span>${formatDollar(subtotal)}</span>
                    </div>
                    <div class="payment-summary-item">
                        <span>Diskon:</span>
                        <span>-${formatDollar(diskon)}</span>
                    </div>
                    <div class="payment-summary-item">
                        <span>Total:</span>
                        <span>${formatDollar(total)}</span>
                    </div>
            `;
            
            if (statusPembayaran !== 'belum') {
                summaryHtml += `
                    <div class="payment-summary-item">
                        <span>Uang Dibayar:</span>
                        <span>${formatDollar(uangDibayar)}</span>
                    </div>
                    <div class="payment-summary-item">
                        <span>Sisa:</span>
                        <span style="color: ${sisaBayar > 0 ? 'var(--danger)' : 'var(--success)'}">
                            ${formatDollar(sisaBayar)}
                        </span>
                    </div>
                `;
            }
            
            summaryHtml += `</div>`;
            
            // Add payment status indicator
            let statusText = '';
            let statusClass = '';
            
            if (statusPembayaran === 'lunas' && uangDibayar >= total) {
                statusText = 'LUNAS';
                statusClass = 'lunas';
            } else if (statusPembayaran === 'dp' && uangDibayar > 0) {
                statusText = 'BAYAR SEBAGIAN';
                statusClass = 'hutang';
            } else {
                statusText = 'BELUM BAYAR';
                statusClass = 'belum';
            }
            
            summaryHtml += `<div class="payment-status ${statusClass}">${statusText}</div>`;
            
            // Update or create summary element
            let summaryElement = document.getElementById('payment-summary');
            if (!summaryElement) {
                summaryElement = document.createElement('div');
                summaryElement.id = 'payment-summary';
                const checkoutSummary = document.querySelector('.checkout-summary');
                checkoutSummary.parentNode.insertBefore(summaryElement, checkoutSummary.nextSibling);
            }
            summaryElement.innerHTML = summaryHtml;
        }

        // Update checkout page to include payment status
        function updateCheckoutPage() {
            try {
                console.log('ðŸ”„ Memperbarui halaman checkout...');
                
                const cartItemsContainer = document.getElementById('cart-items');
                const subtotalElement = document.getElementById('subtotal');
                const diskonElement = document.getElementById('diskon');
                const totalElement = document.getElementById('total-checkout');
                
                if (!cartItemsContainer || !subtotalElement) {
                    console.error('âŒ Elemen checkout tidak ditemukan');
                    return;
                }
                
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = `
                        <div class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Keranjang Kosong</h3>
                            <p>Silakan tambahkan barang dari halaman Barang Brangkas</p>
                        </div>
                    `;
                    if (subtotalElement) subtotalElement.textContent = '$ 0';
                    if (diskonElement) diskonElement.textContent = '$ 0';
                    if (totalElement) totalElement.textContent = '$ 0';
                    
                    // Reset payment status
                    document.getElementById('status-pembayaran').value = 'belum';
                    toggleUangDibayar();
                    return;
                }
                
                // Calculate totals
                const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
                const diskonInput = document.getElementById('diskon-input');
                const diskon = diskonInput ? parseInt(diskonInput.value) || 0 : 0;
                const total = subtotal - diskon;
                
                console.log('ðŸ’° Update totals:', { subtotal, diskon, total });
                
                // Update totals
                subtotalElement.textContent = formatDollar(subtotal);
                if (diskonElement) diskonElement.textContent = formatDollar(diskon);
                if (totalElement) totalElement.textContent = formatDollar(total);
                
                // Update cart items
                cartItemsContainer.innerHTML = '';
                cart.forEach(item => {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    cartItemElement.innerHTML = `
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.nama} 
                                <span class="status-badge-barang ${item.status === 'ready' ? 'status-ready' : 'status-preorder'}">
                                    ${item.status === 'ready' ? 'READY' : 'PRE-ORDER'}
                                </span>
                            </div>
                            <div class="cart-item-price">${formatDollar(item.harga)} x ${item.quantity}</div>
                        </div>
                        <div class="cart-item-controls">
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="${item.quantity}" 
                                    onchange="updateCartQuantity('${item.id}', parseInt(this.value))" min="1">
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <button class="remove-btn" onclick="removeFromCart('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemElement);
                });
                
                // Update payment summary
                updatePaymentSummary();
                
            } catch (error) {
                console.error('âŒ Error dalam updateCheckoutPage:', error);
            }
        }

        // Add event listeners for payment fields
        function setupPaymentListeners() {
            const uangDibayarInput = document.getElementById('uang-dibayar');
            const diskonInput = document.getElementById('diskon-input');
            
            if (uangDibayarInput) {
                uangDibayarInput.addEventListener('input', updatePaymentSummary);
            }
            
            if (diskonInput) {
                diskonInput.addEventListener('input', function() {
                    // Update totals first
                    const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
                    const diskon = parseInt(this.value) || 0;
                    const total = subtotal - diskon;
                    
                    document.getElementById('subtotal').textContent = formatDollar(subtotal);
                    document.getElementById('diskon').textContent = formatDollar(diskon);
                    document.getElementById('total-checkout').textContent = formatDollar(total);
                    
                    // If status is lunas, update uang dibayar to match new total
                    const statusPembayaran = document.getElementById('status-pembayaran').value;
                    if (statusPembayaran === 'lunas') {
                        document.getElementById('uang-dibayar').value = total;
                    }
                    
                    updatePaymentSummary();
                });
            }
        }

        // Update progress bar
        function updateProgressBar(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            const givenItems = pesanan.items.filter(item => item.sudah_dikasih).length;
            const totalItems = pesanan.items.length;
            const percentage = totalItems > 0 ? Math.round((givenItems / totalItems) * 100) : 0;
            
            // Update progress text
            const progressText = document.getElementById(`progress-text-${pesananId}`);
            if (progressText) {
                progressText.textContent = `${givenItems}/${totalItems}`;
            }
            
            // Update progress bar
            const progressFill = document.getElementById(`progress-fill-${pesananId}`);
            if (progressFill) {
                progressFill.style.width = `${percentage}%`;
                progressFill.style.backgroundColor = percentage === 100 ? 'var(--success)' : 'var(--primary)';
            }
        }

        // Cek apakah semua item sudah diberikan
        function checkIfAllItemsGiven(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            const allItemsGiven = pesanan.items.every(item => item.sudah_dikasih);
            
            if (allItemsGiven && !pesanan.sudah_dikasih) {
                // Tampilkan konfirmasi untuk menandai pesanan sebagai selesai
                showConfirmation(
                    'Semua items sudah diberikan. Tandai pesanan sebagai SELESAI?',
                    function() {
                        database.ref('pesanan/' + pesananId).update({
                            sudah_dikasih: true
                        })
                        .then(() => {
                            showNotification('Pesanan berhasil ditandai sebagai SELESAI!', 'success');
                            // Refresh modal
                            setTimeout(() => {
                                viewPesananDetail(pesananId);
                            }, 1000);
                        })
                        .catch(error => {
                            showNotification('Gagal menandai pesanan sebagai selesai: ' + error.message, 'error');
                        });
                    },
                    'success'
                );
            }
        }

        // Process checkout - UPDATED dengan status pembayaran dan penerima pembayaran
        function prosesCheckout() {
            console.log('ðŸ”„ Memulai proses checkout...');
            
            if (cart.length === 0) {
                showNotification('Keranjang masih kosong!', 'error');
                return;
            }
            
            // Dapatkan elemen dengan null checking
            const customerNameElement = document.getElementById('customer-name');
            const statusPembayaranElement = document.getElementById('status-pembayaran');
            const uangDibayarElement = document.getElementById('uang-dibayar');
            const penerimaPembayaranElement = document.getElementById('penerima-pembayaran');
            const diskonInputElement = document.getElementById('diskon-input');
            const keteranganElement = document.getElementById('keterangan');
            const keteranganPembayaranElement = document.getElementById('keterangan-pembayaran');
            
            // Validasi elemen exists
            if (!customerNameElement || !statusPembayaranElement) {
                console.error('âŒ Elemen form checkout tidak ditemukan');
                showNotification('Error: Form checkout tidak lengkap!', 'error');
                return;
            }

            const customerName = customerNameElement.value;
            const statusPembayaran = statusPembayaranElement.value;
            const diskon = diskonInputElement ? parseInt(diskonInputElement.value) || 0 : 0;
            const uangDibayar = uangDibayarElement ? parseInt(uangDibayarElement.value) || 0 : 0;
            const penerimaPembayaran = penerimaPembayaranElement ? penerimaPembayaranElement.value : '';
            const keterangan = keteranganElement ? keteranganElement.value : '';
            const keteranganPembayaran = keteranganPembayaranElement ? keteranganPembayaranElement.value : '';
            
            console.log('ðŸ“‹ Data checkout:', { 
                customerName, 
                statusPembayaran, 
                diskon, 
                uangDibayar,
                penerimaPembayaran,
                keteranganPembayaran
            });
            
            if (!customerName) {
                showNotification('Nama customer harus diisi!', 'error');
                customerNameElement.focus();
                return;
            }
            
            // Calculate totals
            const subtotal = cart.reduce((sum, item) => sum + (item.harga * item.quantity), 0);
            const total = subtotal - diskon;
            
            // Validasi pembayaran berdasarkan status
            if (statusPembayaran === 'lunas') {
                if (uangDibayar < total) {
                    showNotification('Untuk status LUNAS, uang dibayar harus sama dengan total!', 'error');
                    uangDibayarElement.focus();
                    return;
                }
                if (!penerimaPembayaran) {
                    showNotification('Untuk status LUNAS, pilih penerima pembayaran!', 'error');
                    penerimaPembayaranElement.focus();
                    return;
                }
            }
            
            if (statusPembayaran === 'dp' && uangDibayar <= 0) {
                showNotification('Untuk status Bayar Sebagian, uang dibayar harus lebih dari 0!', 'error');
                uangDibayarElement.focus();
                return;
            }
            
            if (statusPembayaran === 'dp' && uangDibayar >= total) {
                showNotification('Untuk status Bayar Sebagian, uang dibayar harus kurang dari total!', 'error');
                uangDibayarElement.focus();
                return;
            }
            
            // Tentukan status berdasarkan pembayaran
            let statusPesanan = 'belum';
            if (statusPembayaran === 'lunas') {
                statusPesanan = 'lunas';
            } else if (statusPembayaran === 'dp' && uangDibayar > 0) {
                statusPesanan = 'hutang';
            }
            
            // Generate order ID
            const orderId = 'ORD' + Date.now();
            
            // Create order object
            const newOrder = {
                id: orderId,
                tanggal: new Date().toISOString(),
                customer: customerName,
                items: cart.map(item => ({
                    id: item.id,
                    nama: item.nama,
                    harga: item.harga,
                    quantity: item.quantity,
                    status: item.status
                })),
                subtotal: subtotal,
                diskon: diskon,
                total: total,
                uang_dibayar: uangDibayar,
                status_pembayaran: statusPembayaran,
                penerima_pembayaran: penerimaPembayaran,
                uang_diberikan_ke_bendahara: false, // Status baru untuk bendahara
                keterangan_pembayaran: keteranganPembayaran,
                sudah_dikasih: false,
                keterangan: keterangan,
                status: statusPesanan
            };
            
            console.log('ðŸ’¾ Menyimpan pesanan:', newOrder);
            
            // Save to Firebase
            database.ref('pesanan/' + orderId).set(newOrder)
                .then(() => {
                    console.log('âœ… Pesanan berhasil disimpan ke Firebase');
                    
                    // Update stock untuk barang ready saja
                    const updatePromises = cart.map(item => {
                        const barang = barangData.find(b => b.id === item.id);
                        if (barang && barang.status === 'ready') {
                            const newStock = barang.stok - item.quantity;
                            console.log(`ðŸ“¦ Update stok ${barang.nama}: ${barang.stok} -> ${newStock}`);
                            return database.ref('barang/' + item.id).update({ stok: newStock });
                        }
                        return Promise.resolve();
                    });
                    
                    return Promise.all(updatePromises);
                })
                .then(() => {
                    console.log('âœ… Semua stok berhasil diupdate');
                    
                    // Jika pembayaran lunas, buat transaksi keuangan
                    if (statusPembayaran === 'lunas') {
                        const newTransaksi = {
                            jenis: 'pemasukan',
                            jumlah: total,
                            keterangan: `Pembayaran pesanan ${orderId} dari ${customerName} (Diterima oleh: ${penerimaPembayaran})`,
                            tanggal: new Date().toISOString().split('T')[0],
                            created_at: new Date().toISOString(),
                            related_pesanan: orderId,
                            penerima: penerimaPembayaran
                        };
                        
                        return database.ref('transaksi').push(newTransaksi);
                    }
                    return Promise.resolve();
                })
                .then(() => {
                    if (statusPembayaran === 'lunas') {
                        console.log('âœ… Transaksi keuangan berhasil dibuat');
                    }
                    
                    // Clear cart
                    cart = [];
                    saveCartToStorage();
                    updateCartUI();
                    
                    // Reset form
                    customerNameElement.value = '';
                    statusPembayaranElement.value = 'belum';
                    if (diskonInputElement) diskonInputElement.value = '0';
                    if (uangDibayarElement) uangDibayarElement.value = '0';
                    if (penerimaPembayaranElement) penerimaPembayaranElement.value = '';
                    if (keteranganElement) keteranganElement.value = '';
                    if (keteranganPembayaranElement) keteranganPembayaranElement.value = '';
                    
                    toggleUangDibayar(); // Reset UI
                    
                    // Show success message and redirect
                    showNotification(`Pesanan ${orderId} berhasil dibuat! Status: ${getStatusTextByPayment(statusPembayaran)}`, 'success');
                    setTimeout(() => {
                        showPage('pemesanan');
                    }, 2000);
                })
                .catch(error => {
                    console.error('âŒ Error saat checkout:', error);
                    showNotification('Gagal membuat pesanan: ' + error.message, 'error');
                });
        }

        const hargaModal = {
            'seeds': 550,    // Harga modal seeds canabis
            'meth': 600,     // Harga modal meth bag
            'seeds canabis': 550,
            'meth bag': 600
        };

        // Fungsi untuk mendapatkan harga modal berdasarkan nama barang
        function getHargaModal(namaBarang) {
            if (!namaBarang) return 0;
            
            const namaLower = namaBarang.toLowerCase();
            
            // Cek apakah barang termasuk dalam daftar yang memiliki profit khusus
            for (const [keyword, modal] of Object.entries(hargaModal)) {
                if (namaLower.includes(keyword.toLowerCase())) {
                    return modal;
                }
            }
            
            return 0; // Barang lain tidak ada profit khusus
        }

        // Fungsi untuk menghitung profit dari sebuah pesanan
        function calculateProfitFromPesanan(pesanan) {
            let totalProfit = 0;
            
            pesanan.items.forEach(item => {
                const modal = getHargaModal(item.nama);
                if (modal > 0) {
                    const profitPerItem = item.harga - modal;
                    totalProfit += profitPerItem * item.quantity;
                }
            });
            
            return totalProfit;
        }

        // Fungsi untuk menghitung total profit dari semua pesanan yang sudah lunas
        function calculateTotalProfit() {
            let totalProfit = 0;
            
            pesananData.forEach(pesanan => {
                // Hanya hitung profit dari pesanan yang sudah lunas
                if (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) {
                    totalProfit += calculateProfitFromPesanan(pesanan);
                }
            });
            
            return totalProfit;
        }

        // Fungsi untuk menghitung profit bulan ini
        function calculateProfitBulanIni() {
            let profitBulanIni = 0;
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            pesananData.forEach(pesanan => {
                // Hanya hitung profit dari pesanan yang sudah lunas dan di bulan ini
                if ((pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) &&
                    pesanan.tanggal.startsWith(currentMonth)) {
                    profitBulanIni += calculateProfitFromPesanan(pesanan);
                }
            });
            
            return profitBulanIni;
        }

        // Fungsi untuk menampilkan profit di dashboard
        function updateProfitDashboard() {
            if (!isAdmin) return;
            const totalProfit = calculateTotalProfit();
            const profitBulanIni = calculateProfitBulanIni();
            
            // Update atau buat card profit di dashboard
            let profitCard = document.getElementById('profit-card');
            
            if (!profitCard) {
                // Buat card profit baru
                const cardsContainer = document.querySelector('.cards');
                profitCard = document.createElement('div');
                profitCard.id = 'profit-card';
                profitCard.className = 'card profit-card';
                profitCard.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">Uang Brangkas</div>
                        <div class="card-icon bg-success">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="card-value" id="total-profit">${formatDollar(totalProfit)}</div>
                    <div class="card-desc">
                        <div>Bulan Ini: <span id="profit-bulan-ini">${formatDollar(profitBulanIni)}</span></div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem; color: var(--text-muted);">
                            Profit dari Seeds & Meth
                        </div>
                    </div>
                `;
                cardsContainer.appendChild(profitCard);
            } else {
                // Update card yang sudah ada
                document.getElementById('total-profit').textContent = formatDollar(totalProfit);
                document.getElementById('profit-bulan-ini').textContent = formatDollar(profitBulanIni);
            }
            profitCard.style.display = 'block';
        }

        // Fungsi untuk menampilkan detail profit di modal pesanan
        function addProfitToPesananDetail(pesanan) {
            if (!isAdmin) return '';
            const profit = calculateProfitFromPesanan(pesanan);
            
            if (profit > 0) {
                return `
                    <div class="profit-summary">
                        <h4 style="margin-bottom: 1rem; color: var(--success);">Profit Analysis</h4>
                        ${pesanan.items.map(item => {
                            const modal = getHargaModal(item.nama);
                            if (modal > 0) {
                                const profitPerItem = item.harga - modal;
                                const totalItemProfit = profitPerItem * item.quantity;
                                return `
                                    <div class="profit-item">
                                        <span>${item.nama} (${item.quantity}x):</span>
                                        <span>
                                            ${formatDollar(item.harga)} - ${formatDollar(modal)} = 
                                            <strong style="color: var(--success);">${formatDollar(profitPerItem)}/item</strong>
                                            (Total: ${formatDollar(totalItemProfit)})
                                        </span>
                                    </div>
                                `;
                            }
                            return '';
                        }).join('')}
                        <div class="profit-item">
                            <span>Total Profit:</span>
                            <span style="color: var(--success); font-weight: 700;">${formatDollar(profit)}</span>
                        </div>
                    </div>
                `;
            }
            return '';
        }

        // Fungsi untuk menampilkan profit di item barang
        function addProfitBadgeToBarang(barang) {
            if (!isAdmin) return '';
            const modal = getHargaModal(barang.nama);
            if (modal > 0) {
                const profit = barang.harga - modal;
                const profitPercentage = Math.round((profit / modal) * 100);
                return `<span class="profit-badge" title="Profit: ${formatDollar(profit)} (${profitPercentage}%)">Profit ${formatDollar(profit)}</span>`;
            }
            return '';
        }

        function syncPaidOrdersToFinance() {
            console.log('ðŸ”„ Memulai sinkronisasi pesanan lunas ke keuangan...');
            
            // Cari pesanan yang sudah lunas tapi belum ada di transaksi
            const paidOrders = pesananData.filter(pesanan => {
                // Pesanan yang sudah lunas (uang_dibayar >= total)
                const isPaid = pesanan.uang_dibayar >= pesanan.total;
                
                // Cek apakah sudah ada transaksi untuk pesanan ini
                const hasTransaction = transaksiData.some(transaksi => 
                    transaksi.related_pesanan === pesanan.id
                );
                
                return isPaid && !hasTransaction;
            });
            
            console.log(`ðŸ“Š Ditemukan ${paidOrders.length} pesanan lunas yang perlu disinkronisasi`);
            
            if (paidOrders.length === 0) {
                showNotification('Semua pesanan lunas sudah tersinkronisasi dengan keuangan!', 'info');
                return;
            }
            
            // Buat transaksi untuk setiap pesanan lunas
            let syncCount = 0;
            const syncPromises = paidOrders.map(pesanan => {
                const newTransaksi = {
                    jenis: 'pemasukan',
                    jumlah: pesanan.total,
                    keterangan: `Pembayaran pesanan ${pesanan.id} dari ${pesanan.customer}`,
                    tanggal: pesanan.tanggal.split('T')[0],
                    created_at: new Date().toISOString(),
                    related_pesanan: pesanan.id
                };
                
                return database.ref('transaksi').push(newTransaksi)
                    .then(() => {
                        syncCount++;
                        console.log(`âœ… Transaksi untuk pesanan ${pesanan.id} berhasil dibuat`);
                    })
                    .catch(error => {
                        console.error(`âŒ Gagal membuat transaksi untuk pesanan ${pesanan.id}:`, error);
                    });
            });
            
            Promise.all(syncPromises)
                .then(() => {
                    showNotification(`Berhasil menyinkronisasi ${syncCount} pesanan lunas ke keuangan!`, 'success');
                })
                .catch(error => {
                    showNotification('Terjadi error saat sinkronisasi: ' + error.message, 'error');
                });
        }

        function addTransactionOnPayment(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            // Cek apakah sudah ada transaksi untuk pesanan ini
            const existingTransaction = transaksiData.find(t => t.related_pesanan === pesananId);
            if (existingTransaction) {
                console.log(`â„¹ï¸ Transaksi untuk pesanan ${pesananId} sudah ada`);
                return;
            }
            
            // Buat transaksi baru
            const newTransaksi = {
                jenis: 'pemasukan',
                jumlah: pesanan.total,
                keterangan: `Pembayaran pesanan ${pesanan.id} dari ${pesanan.customer}`,
                tanggal: new Date().toISOString().split('T')[0],
                created_at: new Date().toISOString(),
                related_pesanan: pesanan.id
            };
            
            database.ref('transaksi').push(newTransaksi)
                .then(() => {
                    console.log(`âœ… Transaksi pembayaran berhasil ditambahkan untuk pesanan ${pesanan.id}`);
                })
                .catch(error => {
                    console.error('âŒ Gagal menambah transaksi pembayaran:', error);
                });
        }

        // Helper function untuk teks status pembayaran
        function getStatusTextByPayment(status) {
            const statusMap = {
                'belum': 'BELUM BAYAR',
                'lunas': 'LUNAS',
                'dp': 'BAYAR SEBAGIAN'
            };
            return statusMap[status] || 'BELUM BAYAR';
        }

        // ===============================
        // DATA MANAGEMENT - DENGAN AUTO REFRESH REAL-TIME
        // ===============================

        // Update dashboard
        function updateDashboard() {
            // Update total barang
            document.getElementById('total-barang').textContent = barangData.length;

            // Update total nilai barang
            const totalNilai = barangData.reduce((sum, barang) => sum + (barang.harga * barang.stok), 0);
            document.getElementById('total-barang').textContent = barangData.length;;
            
            // Update total pesanan aktif
            const totalPesananAktif = pesananData.filter(p => !p.sudah_dikasih).length;
            document.getElementById('total-pesanan').textContent = totalPesananAktif;
            
            // Update total keuangan
            const saldoKas = calculateSaldoKas();
            document.getElementById('total-keuangan').textContent = formatDollar(saldoKas);
            
            // Update total hutang (BARU)
            const totalHutang = calculateTotalHutang();
            document.getElementById('total-hutang').textContent = formatDollar(totalHutang);
            
            // Update profit dashboard
            updateProfitDashboard();
            
            // Update recent barang
            updateRecentBarang();
            
            // Update recent pesanan
            updateRecentPesanan();
        }

        // Fungsi untuk menghitung total hutang
        function calculateTotalHutang() {
            let totalHutang = 0;
            
            pesananData.forEach(pesanan => {
                // Hanya hitung pesanan yang belum lunas dan belum dibayar penuh
                if ((pesanan.status_pembayaran === 'belum' || pesanan.status_pembayaran === 'dp') && 
                    pesanan.uang_dibayar < pesanan.total) {
                    const sisaHutang = pesanan.total - pesanan.uang_dibayar;
                    totalHutang += sisaHutang;
                }
            });
            
            return totalHutang;
        }

        // Calculate saldo kas
        function calculateSaldoKas() {
            return transaksiData.reduce((saldo, transaksi) => {
                return transaksi.jenis === 'pemasukan' ? 
                    saldo + transaksi.jumlah : 
                    saldo - transaksi.jumlah;
            }, 0);
        }

        // Update recent barang table
        function updateRecentBarang() {
            const recentBarangContainer = document.getElementById('recent-barang');
            const recentBarang = barangData.slice(-5).reverse(); // 5 terbaru
            
            if (recentBarang.length === 0) {
                recentBarangContainer.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada data barang</td></tr>';
                return;
            }
            
            recentBarangContainer.innerHTML = recentBarang.map(barang => `
                <tr>
                    <td>${barang.nama}</td>
                    <td><span class="badge badge-secondary">${barang.kategori}</span></td>
                    <td><span class="status-badge-barang ${barang.status === 'ready' ? 'status-ready' : 'status-preorder'}">${barang.status === 'ready' ? 'READY' : 'PRE-ORDER'}</span></td>
                    <td>${barang.stok}</td>
                    <td>${formatDollar(barang.harga)}</td>
                </tr>
            `).join('');
        }

        // Update recent pesanan table
        function updateRecentPesanan() {
            const recentPesananContainer = document.getElementById('recent-pesanan');
            const recentPesanan = pesananData.slice(-5).reverse(); // 5 terbaru
            
            if (recentPesanan.length === 0) {
                recentPesananContainer.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada data pesanan</td></tr>';
                return;
            }
            
            recentPesananContainer.innerHTML = recentPesanan.map(pesanan => `
                <tr>
                    <td>${pesanan.id}</td>
                    <td>${pesanan.customer}</td>
                    <td><span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span></td>
                    <td>${formatDollar(pesanan.total)}</td>
                </tr>
            `).join('');
        }

        // Update barang UI
        function updateBarangUI() {
            const barangGrid = document.getElementById('barang-grid');
            const searchTerm = document.getElementById('search-barang').value.toLowerCase();
            const filterKategori = document.getElementById('filter-kategori').value;
            const filterStatus = document.getElementById('filter-status-barang').value;
            
            // Filter barang
            let filteredBarang = barangData.filter(barang => {
                const matchesSearch = barang.nama.toLowerCase().includes(searchTerm) || 
                                    barang.deskripsi?.toLowerCase().includes(searchTerm);
                const matchesCategory = !filterKategori || barang.kategori === filterKategori;
                const matchesStatus = !filterStatus || barang.status === filterStatus;
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            if (filteredBarang.length === 0) {
                barangGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h3>Tidak ada barang ditemukan</h3>
                        <p>Coba ubah kata kunci pencarian atau filter kategori</p>
                    </div>
                `;
                return;
            }
            
            // Render barang grid
            barangGrid.innerHTML = filteredBarang.map(barang => {
                const gambarPath = getGambarBarang(barang.nama);
                const profitBadge = addProfitBadgeToBarang(barang);
                
                return `
                    <div class="item-card">
                        <div class="item-image">
                            <img src="${gambarPath}" alt="${barang.nama}" 
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="placeholder" style="display: none;">
                                <i class="fas fa-box"></i>
                            </div>
                        </div>
                        <div class="item-content">
                            <div class="item-title">${barang.nama} ${profitBadge}</div>
                            <div class="item-desc">${barang.deskripsi || 'Tidak ada deskripsi'}</div>
                            <div class="item-meta">
                                <div class="item-value">${formatDollar(barang.harga)}</div>
                                <div class="item-stock">
                                    <span class="status-badge-barang ${barang.status === 'ready' ? 'status-ready' : 'status-preorder'}">
                                        ${barang.status === 'ready' ? 'READY' : 'PRE-ORDER'}
                                    </span>
                                    ${barang.status === 'ready' ? `Stok: ${barang.stok}` : ''}
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-primary" onclick="addToCart('${barang.id}', 1)" 
                                    ${barang.status === 'ready' && barang.stok <= 0 ? 'disabled' : ''}>
                                    <i class="fas fa-cart-plus"></i> Tambah
                                </button>
                                ${isAdmin ? `
                                <button class="btn btn-warning" onclick="editBarang('${barang.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger" onclick="deleteBarang('${barang.id}')">
                                    <i class="fas fa-trash"></i> Hapus
                                </button>
                                ` : ''}
                                <span class="badge badge-secondary">${barang.kategori}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Edit barang
        function editBarang(barangId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat mengedit barang!', 'error');
                return;
            }
            
            const barang = barangData.find(b => b.id === barangId);
            if (!barang) return;
            
            // Isi form edit
            document.getElementById('edit-barang-id').value = barang.id;
            document.getElementById('edit-nama-barang').value = barang.nama;
            document.getElementById('edit-kategori-barang').value = barang.kategori;
            document.getElementById('edit-status-barang').value = barang.status;
            document.getElementById('edit-harga-barang').value = barang.harga;
            document.getElementById('edit-stok-barang').value = barang.stok;
            document.getElementById('edit-deskripsi-barang').value = barang.deskripsi || '';
            
            showModal('edit-barang-modal');
        }

        // Delete barang
        function deleteBarang(barangId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menghapus barang!', 'error');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus barang ini?')) {
                database.ref('barang/' + barangId).remove()
                    .then(() => {
                        showNotification('Barang berhasil dihapus!', 'success');
                    })
                    .catch(error => {
                        showNotification('Gagal menghapus barang: ' + error.message, 'error');
                    });
            }
        }

        // Update pesanan UI
        function updatePesananUI() {
            updateSemuaPesananTable();
            updatePesananAktifTable();
            updatePesananLunasTable();
            updatePesananHutangTable();
        }

        // Update semua pesanan table - MODIFIED dengan status pembayaran
        function updateSemuaPesananTable() {
            const tableBody = document.getElementById('semua-pesanan-table');
            if (pesananData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Tidak ada data pesanan</td></tr>';
                return;
            }
            
            tableBody.innerHTML = pesananData.map(pesanan => `
                <tr class="${pesanan.sudah_dikasih ? 'pesanan-lunas' : 'pesanan-card'}">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td>
                        <span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span>
                    </td>
                    <td>
                        <span class="payment-badge ${getPaymentStatusClass(pesanan)}">
                            ${getPaymentStatusText(pesanan)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${!pesanan.sudah_dikasih && isAdmin ? `
                        <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        ` : ''}
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Update pesanan hutang table - MODIFIED dengan status pembayaran
        function updatePesananHutangTable() {
            const tableBody = document.getElementById('pesanan-hutang-table');
            const hutangPesanan = pesananData.filter(p => p.status === 'hutang' && !p.sudah_dikasih);
            
            if (hutangPesanan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Tidak ada pesanan hutang</td></tr>';
                return;
            }
            
            tableBody.innerHTML = hutangPesanan.map(pesanan => `
                <tr class="pesanan-hutang">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td>
                        <span class="status status-danger">Hutang</span>
                    </td>
                    <td>
                        <span class="payment-badge ${getPaymentStatusClass(pesanan)}">
                            ${getPaymentStatusText(pesanan)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${isAdmin ? `
                        <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        ` : ''}
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Update pesanan aktif table
        function updatePesananAktifTable() {
            const tableBody = document.getElementById('pesanan-aktif-table');
            const aktifPesanan = pesananData.filter(p => !p.sudah_dikasih);
            
            if (aktifPesanan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada pesanan aktif</td></tr>';
                return;
            }
            
            tableBody.innerHTML = aktifPesanan.map(pesanan => `
                <tr class="pesanan-card">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td><span class="status ${getStatusClass(pesanan)}">${getStatusText(pesanan)}</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Update pesanan lunas table - MODIFIED dengan penerima pembayaran
        function updatePesananLunasTable() {
            const tableBody = document.getElementById('pesanan-lunas-table');
            const lunasPesanan = pesananData.filter(p => p.sudah_dikasih);
            
            if (lunasPesanan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada pesanan lunas</td></tr>';
                return;
            }
            
            tableBody.innerHTML = lunasPesanan.map(pesanan => `
                <tr class="pesanan-lunas">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td>
                        ${pesanan.penerima_pembayaran ? `
                            <span class="penerima-badge ${pesanan.uang_diberikan_ke_bendahara ? 'penerima-dibayar' : ''}">
                                ${pesanan.penerima_pembayaran}
                                ${pesanan.uang_diberikan_ke_bendahara ? ' âœ“' : ''}
                            </span>
                        ` : '-'}
                    </td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${isAdmin && pesanan.penerima_pembayaran && !pesanan.uang_diberikan_ke_bendahara ? `
                        <button class="btn btn-success btn-sm" onclick="markUangDiberikanKeBendahara('${pesanan.id}')">
                            <i class="fas fa-money-bill-wave"></i> Bendahara
                        </button>
                        ` : ''}
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // ===============================
        // PAYMENT STATUS HELPER FUNCTIONS
        // ===============================

        // Get payment status class
        function getPaymentStatusClass(pesanan) {
            if (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) {
                return 'lunas';
            } else if (pesanan.status_pembayaran === 'dp' || (pesanan.uang_dibayar > 0 && pesanan.uang_dibayar < pesanan.total)) {
                return 'sebagian';
            } else if (pesanan.status_pembayaran === 'belum' || pesanan.uang_dibayar === 0) {
                return 'belum';
            }
            return 'belum';
        }

        // Get payment status text
        function getPaymentStatusText(pesanan) {
            if (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) {
                return 'LUNAS';
            } else if (pesanan.status_pembayaran === 'dp' || (pesanan.uang_dibayar > 0 && pesanan.uang_dibayar < pesanan.total)) {
                const persentase = Math.round((pesanan.uang_dibayar / pesanan.total) * 100);
                return `DP ${persentase}%`;
            } else if (pesanan.status_pembayaran === 'belum' || pesanan.uang_dibayar === 0) {
                return 'BELUM';
            }
            return 'BELUM';
        }

        // Get detailed payment status text for modal
        function getDetailedPaymentStatus(pesanan) {
            if (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total) {
                return 'LUNAS';
            } else if (pesanan.status_pembayaran === 'dp' || (pesanan.uang_dibayar > 0 && pesanan.uang_dibayar < pesanan.total)) {
                const persentase = Math.round((pesanan.uang_dibayar / pesanan.total) * 100);
                const sisa = pesanan.total - pesanan.uang_dibayar;
                return `BAYAR SEBAGIAN (${persentase}%) - Sisa: ${formatDollar(sisa)}`;
            } else if (pesanan.status_pembayaran === 'belum' || pesanan.uang_dibayar === 0) {
                return 'BELUM BAYAR';
            }
            return 'BELUM BAYAR';
        }

        // Update pesanan hutang table
        function updatePesananHutangTable() {
            const tableBody = document.getElementById('pesanan-hutang-table');
            const hutangPesanan = pesananData.filter(p => p.status === 'hutang' && !p.sudah_dikasih);
            
            if (hutangPesanan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada pesanan hutang</td></tr>';
                return;
            }
            
            tableBody.innerHTML = hutangPesanan.map(pesanan => {
                const sisaHutang = pesanan.total - pesanan.uang_dibayar;
                return `
                <tr class="pesanan-hutang">
                    <td>${pesanan.id}</td>
                    <td>${formatDate(pesanan.tanggal)}</td>
                    <td>${pesanan.customer}</td>
                    <td>${pesanan.items.length} item</td>
                    <td>${formatDollar(pesanan.total)}</td>
                    <td>${formatDollar(sisaHutang)}</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-success btn-sm" onclick="markAsGiven('${pesanan.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        ${isAdmin ? `
                        <button class="btn btn-danger btn-sm" onclick="deletePesanan('${pesanan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `}).join('');
        }

        // Update transaksi UI
        function updateTransaksiUI() {
            const transaksiTable = document.getElementById('transaksi-table');
            const saldoKasElement = document.getElementById('saldo-kas');
            const pemasukanBulanElement = document.getElementById('pemasukan-bulan');
            const pengeluaranBulanElement = document.getElementById('pengeluaran-bulan');
            const labaBulanElement = document.getElementById('laba-bulan');
            
            // Filter transaksi
            const searchTerm = document.getElementById('search-keuangan').value.toLowerCase();
            const filterJenis = document.getElementById('filter-jenis').value;
            const filterBulan = document.getElementById('filter-bulan').value;
            
            let filteredTransaksi = transaksiData.filter(transaksi => {
                const matchesSearch = transaksi.keterangan.toLowerCase().includes(searchTerm);
                const matchesJenis = !filterJenis || transaksi.jenis === filterJenis;
                const matchesBulan = !filterBulan || transaksi.tanggal.startsWith(filterBulan);
                return matchesSearch && matchesJenis && matchesBulan;
            });
            
            // Update table
            if (filteredTransaksi.length === 0) {
                transaksiTable.innerHTML = '<tr><td colspan="6" class="text-center">Tidak ada data transaksi</td></tr>';
            } else {
                let runningBalance = 0;
                transaksiTable.innerHTML = filteredTransaksi.map(transaksi => {
                    runningBalance += transaksi.jenis === 'pemasukan' ? transaksi.jumlah : -transaksi.jumlah;
                    return `
                        <tr>
                            <td>${formatDate(transaksi.tanggal)}</td>
                            <td>${transaksi.keterangan}</td>
                            <td><span class="badge ${transaksi.jenis === 'pemasukan' ? 'badge-success' : 'badge-danger'}">${transaksi.jenis}</span></td>
                            <td>${formatDollar(transaksi.jumlah)}</td>
                            <td>${formatDollar(runningBalance)}</td>
                            <td>
                                ${isAdmin ? `
                                <button class="btn btn-danger btn-sm" onclick="deleteTransaksi('${transaksi.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update summary cards
            const saldoKas = calculateSaldoKas();
            const currentMonth = new Date().toISOString().slice(0, 7);
            const totalHutang = calculateTotalHutang();
            
            const pemasukanBulan = transaksiData
                .filter(t => t.jenis === 'pemasukan' && t.tanggal.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const pengeluaranBulan = transaksiData
                .filter(t => t.jenis === 'pengeluaran' && t.tanggal.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const labaBulan = pemasukanBulan - pengeluaranBulan;
            
            saldoKasElement.textContent = formatDollar(saldoKas);
            pemasukanBulanElement.textContent = formatDollar(pemasukanBulan);
            pengeluaranBulanElement.textContent = formatDollar(pengeluaranBulan);
            labaBulanElement.textContent = formatDollar(labaBulan);
            
            // Tambahkan ringkasan hutang di halaman keuangan
            showHutangSummary(totalHutang);
        }

        // Fungsi untuk menampilkan ringkasan hutang di halaman keuangan
        function showHutangSummary(totalHutang) {
            let hutangSummary = document.getElementById('hutang-summary');
            
            if (!hutangSummary) {
                hutangSummary = document.createElement('div');
                hutangSummary.id = 'hutang-summary';
                hutangSummary.className = 'hutang-summary';
                
                const cardsContainer = document.querySelector('.cards');
                cardsContainer.parentNode.insertBefore(hutangSummary, cardsContainer.nextSibling);
            }
            
            const hutangPesanan = pesananData.filter(p => 
                (p.status_pembayaran === 'belum' || p.status_pembayaran === 'dp') && 
                p.uang_dibayar < p.total
            );
            
            hutangSummary.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4 style="margin: 0; color: var(--text-primary);">Ringkasan Piutang</h4>
                        <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">
                            Total uang yang belum diterima dari pesanan
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--danger);">
                            ${formatDollar(totalHutang)}
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">
                            ${hutangPesanan.length} pesanan
                        </div>
                    </div>
                </div>
            `;
        }

        // Update laporan
        function updateLaporan() {
            const laporanBulan = document.getElementById('laporan-bulan').value || new Date().toISOString().slice(0, 7);
            
            // Filter data berdasarkan bulan
            const transaksiBulan = transaksiData.filter(t => t.tanggal.startsWith(laporanBulan));
            const pesananBulan = pesananData.filter(p => p.tanggal.startsWith(laporanBulan));
            const pesananLunasBulan = pesananBulan.filter(p => p.status_pembayaran === 'lunas');
            
            // Calculate totals
            const totalPemasukan = transaksiBulan
                .filter(t => t.jenis === 'pemasukan')
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const totalPengeluaran = transaksiBulan
                .filter(t => t.jenis === 'pengeluaran')
                .reduce((sum, t) => sum + t.jumlah, 0);
                
            const totalLaba = totalPemasukan - totalPengeluaran;
            const totalPesanan = pesananBulan.length;
            
            // Update summary cards
            document.getElementById('laporan-pemasukan').textContent = formatDollar(totalPemasukan);
            document.getElementById('laporan-pengeluaran').textContent = formatDollar(totalPengeluaran);
            document.getElementById('laporan-laba').textContent = formatDollar(totalLaba);
            document.getElementById('laporan-pesanan').textContent = totalPesanan;
            
            // Update tables
            updateLaporanTransaksiTable(transaksiBulan);
            updateLaporanPembayaranTable(pesananLunasBulan);
        }

        // Update laporan transaksi table
        function updateLaporanTransaksiTable(transaksiBulan) {
            const tableBody = document.getElementById('laporan-transaksi-table');
            
            if (transaksiBulan.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada transaksi pada periode ini</td></tr>';
                return;
            }
            
            tableBody.innerHTML = transaksiBulan.map(transaksi => `
                <tr>
                    <td>${formatDate(transaksi.tanggal)}</td>
                    <td>${transaksi.keterangan}</td>
                    <td><span class="badge ${transaksi.jenis === 'pemasukan' ? 'badge-success' : 'badge-danger'}">${transaksi.jenis}</span></td>
                    <td>${formatDollar(transaksi.jumlah)}</td>
                </tr>
            `).join('');
        }

        // ===============================
// BENDHARA DASHBOARD FUNCTIONS
// ===============================

// Update dashboard bendahara
function updateBendaharaDashboard() {
    if (!isAdmin) return;
    
    // Filter pesanan yang sudah lunas
    const pesananLunas = pesananData.filter(p => 
        p.status_pembayaran === 'lunas' || p.uang_dibayar >= p.total
    );
    
    // Hitung statistik
    const uangSudahDikasih = pesananLunas.filter(p => p.uang_diberikan_ke_bendahara);
    const uangBelumDikasih = pesananLunas.filter(p => !p.uang_diberikan_ke_bendahara);
    
    const totalUangDikasih = uangSudahDikasih.reduce((sum, p) => sum + p.total, 0);
    const totalUangBelumDikasih = uangBelumDikasih.reduce((sum, p) => sum + p.total, 0);
    
    const rataRataDikasih = uangSudahDikasih.length > 0 ? totalUangDikasih / uangSudahDikasih.length : 0;
    
    // Update stats cards
    document.getElementById('total-uang-dikasih').textContent = formatDollar(totalUangDikasih);
    document.getElementById('total-pesanan-dikasih').textContent = uangSudahDikasih.length;
    document.getElementById('total-pesanan-belum').textContent = uangBelumDikasih.length;
    document.getElementById('rata-rata-dikasih').textContent = formatDollar(rataRataDikasih);
    
    // Update summary
    document.getElementById('summary-sudah-dikasih').textContent = formatDollar(totalUangDikasih);
    document.getElementById('summary-belum-dikasih').textContent = formatDollar(totalUangBelumDikasih);
    
    // Update breakdown per penerima
    updatePenerimaBreakdown(pesananLunas);
    
    // Update recent uang dikasih
    updateRecentUangDikasih(uangSudahDikasih);
}

// Update breakdown per penerima
function updatePenerimaBreakdown(pesananLunas) {
    const tableBody = document.getElementById('penerima-breakdown');
    
    // Group by penerima
    const penerimaMap = {};
    
    pesananLunas.forEach(pesanan => {
        if (!pesanan.penerima_pembayaran) return;
        
        if (!penerimaMap[pesanan.penerima_pembayaran]) {
            penerimaMap[pesanan.penerima_pembayaran] = {
                sudahDikasih: 0,
                belumDikasih: 0,
                totalSudah: 0,
                totalBelum: 0
            };
        }
        
        if (pesanan.uang_diberikan_ke_bendahara) {
            penerimaMap[pesanan.penerima_pembayaran].sudahDikasih++;
            penerimaMap[pesanan.penerima_pembayaran].totalSudah += pesanan.total;
        } else {
            penerimaMap[pesanan.penerima_pembayaran].belumDikasih++;
            penerimaMap[pesanan.penerima_pembayaran].totalBelum += pesanan.total;
        }
    });
    
    if (Object.keys(penerimaMap).length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada data penerima</td></tr>';
        return;
    }
    
    tableBody.innerHTML = Object.entries(penerimaMap).map(([penerima, data]) => {
        const totalPesanan = data.sudahDikasih + data.belumDikasih;
        const totalUang = data.totalSudah + data.totalBelum;
        const progressPercentage = totalPesanan > 0 ? Math.round((data.sudahDikasih / totalPesanan) * 100) : 0;
        
        return `
            <tr>
                <td>
                    <div style="font-weight: 600;">${penerima}</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                        ${progressPercentage}% sudah dikasih
                    </div>
                </td>
                <td>${totalPesanan} pesanan</td>
                <td>${formatDollar(totalUang)}</td>
                <td>
                    <span class="badge ${data.belumDikasih === 0 ? 'badge-success' : 'badge-warning'}">
                        ${data.belumDikasih === 0 ? 'LENGKAP' : 'BELUM DIKIRIM KE BENDAHARA'}
                    </span>
                </td>
            </tr>
        `;
    }).join('');
}

// Update recent uang dikasih
function updateRecentUangDikasih(uangSudahDikasih) {
    const tableBody = document.getElementById('recent-uang-dikasih');
    const recentData = uangSudahDikasih.slice(-10).reverse(); // 10 terbaru
    
    if (recentData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="6" class="text-center">Belum ada uang yang dikasih ke bendahara</td></tr>';
        return;
    }
    
    tableBody.innerHTML = recentData.map(pesanan => `
        <tr>
            <td>
                <div style="font-weight: 600; color: var(--primary);">${pesanan.id}</div>
            </td>
            <td>${formatDate(pesanan.tanggal)}</td>
            <td>${pesanan.customer}</td>
            <td>
                <span class="penerima-badge penerima-dibayar">
                    ${pesanan.penerima_pembayaran}
                </span>
            </td>
            <td>
                <div style="font-weight: 700; color: var(--success);">${formatDollar(pesanan.total)}</div>
            </td>
            <td>
                <span class="badge badge-success">
                    <i class="fas fa-check"></i> SUDAH DIKASIH
                </span>
            </td>
        </tr>
    `).join('');
}

// Fungsi untuk export laporan bendahara
function exportLaporanBendahara() {
    const pesananLunas = pesananData.filter(p => 
        p.status_pembayaran === 'lunas' || p.uang_dibayar >= p.total
    );
    
    const uangSudahDikasih = pesananLunas.filter(p => p.uang_diberikan_ke_bendahara);
    const uangBelumDikasih = pesananLunas.filter(p => !p.uang_diberikan_ke_bendahara);
    
    let laporanText = `LAPORAN BENDHARA - ${new Date().toLocaleDateString('id-ID')}\n\n`;
    laporanText += `PERIODE: ${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}\n\n`;
    
    laporanText += `STATISTIK:\n`;
    laporanText += `Total Uang Sudah Dikasih: ${formatDollar(uangSudahDikasih.reduce((sum, p) => sum + p.total, 0))}\n`;
    laporanText += `Total Uang Belum Dikasih: ${formatDollar(uangBelumDikasih.reduce((sum, p) => sum + p.total, 0))}\n`;
    laporanText += `Jumlah Pesanan Sudah Dikasih: ${uangSudahDikasih.length}\n`;
    laporanText += `Jumlah Pesanan Belum Dikasih: ${uangBelumDikasih.length}\n\n`;
    
    laporanText += `DETAIL UANG SUDAH DIKASIH:\n`;
    laporanText += `========================\n`;
    
    uangSudahDikasih.forEach(pesanan => {
        laporanText += `${pesanan.id} | ${pesanan.customer} | ${pesanan.penerima_pembayaran} | ${formatDollar(pesanan.total)} | ${formatDate(pesanan.tanggal)}\n`;
    });
    
    laporanText += `\nDETAIL UANG BELUM DIKASIH:\n`;
    laporanText += `========================\n`;
    
    uangBelumDikasih.forEach(pesanan => {
        laporanText += `${pesanan.id} | ${pesanan.customer} | ${pesanan.penerima_pembayaran} | ${formatDollar(pesanan.total)} | ${formatDate(pesanan.tanggal)}\n`;
    });
    
    // Salin ke clipboard
    navigator.clipboard.writeText(laporanText)
        .then(() => {
            showNotification('Laporan bendahara berhasil disalin ke clipboard!', 'success');
        })
        .catch(err => {
            console.error('Gagal menyalin laporan: ', err);
            fallbackCopyTextToClipboard(laporanText);
        });
}

        // Update laporan pembayaran table
        // Update laporan pembayaran table - FIXED tampilan
// Update laporan pembayaran table - MODIFIED dengan tombol hapus untuk admin
function updateLaporanPembayaranTable(pesananLunasBulan) {
    const tableBody = document.getElementById('laporan-pembayaran-table');
    
    if (pesananLunasBulan.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="6" class="text-center">Tidak ada pembayaran pada periode ini</td></tr>';
        return;
    }
    
    tableBody.innerHTML = pesananLunasBulan.map(pesanan => {
        const statusClass = pesanan.uang_diberikan_ke_bendahara ? 'status-sudah-dikasih' : 'status-belum-dikasih';
        const statusText = pesanan.uang_diberikan_ke_bendahara ? 'SUDAH DIKASIH' : 'BELUM DIKASIH';
        
        return `
            <tr>
                <td>
                    <div style="font-weight: 600; color: var(--primary);">${pesanan.id}</div>
                    <div style="font-size: 0.75rem; color: var(--text-muted);">
                        ${formatDate(pesanan.tanggal)}
                    </div>
                </td>
                <td>
                    <div style="font-weight: 600;">${pesanan.customer}</div>
                </td>
                <td>
                    <div style="font-weight: 700; color: var(--success);">${formatDollar(pesanan.total)}</div>
                    ${pesanan.uang_dibayar > 0 ? `
                    <div style="font-size: 0.75rem; color: var(--text-muted);">
                        Dibayar: ${formatDollar(pesanan.uang_dibayar)}
                    </div>
                    ` : ''}
                </td>
                <td>
                    ${pesanan.penerima_pembayaran ? `
                        <div class="penerima-badge ${pesanan.uang_diberikan_ke_bendahara ? 'penerima-dibayar' : ''}">
                            ${pesanan.penerima_pembayaran}
                            ${pesanan.uang_diberikan_ke_bendahara ? ' âœ“' : ''}
                        </div>
                    ` : 
                    '<span style="color: var(--text-muted); font-style: italic;">-</span>'
                    }
                </td>
                <td>
                    <span class="status-badge-kasih ${statusClass}">
                        ${statusText}
                    </span>
                </td>
                <td style="text-align: center;">
                    <div style="display: flex; gap: 0.25rem; justify-content: center;">
                        <button class="btn btn-info btn-sm" onclick="viewPesananDetail('${pesanan.id}')" title="Lihat Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${isAdmin && pesanan.penerima_pembayaran && !pesanan.uang_diberikan_ke_bendahara ? `
                        <button class="btn btn-success btn-sm" onclick="markUangDiberikanKeBendahara('${pesanan.id}')" title="Tandai Sudah Dikasih">
                            <i class="fas fa-check"></i>
                        </button>
                        ` : ''}
                        ${isAdmin ? `
                        <button class="btn btn-delete btn-sm" onclick="deleteLaporanPembayaran('${pesanan.id}')" title="Hapus Laporan">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </div>
                </td>
            </tr>
        `;
    }).join('');
}

        // ===============================
        // FORM HANDLERS
        // ===============================

        // Handle tambah barang
        function handleTambahBarang(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menambah barang!', 'error');
                return;
            }
            
            const nama = document.getElementById('nama-barang').value;
            const kategori = document.getElementById('kategori-barang').value;
            const status = document.getElementById('status-barang').value;
            const harga = parseInt(document.getElementById('harga-barang').value);
            const stok = parseInt(document.getElementById('stok-barang').value);
            const deskripsi = document.getElementById('deskripsi-barang').value;
            
            const newBarang = {
                nama: nama,
                kategori: kategori,
                status: status,
                harga: harga,
                stok: stok,
                deskripsi: deskripsi,
                created_at: new Date().toISOString()
            };
            
            // Save to Firebase
            database.ref('barang').push(newBarang)
                .then(() => {
                    showNotification('Barang berhasil ditambahkan!', 'success');
                    closeModal('tambah-barang-modal');
                    document.getElementById('tambah-barang-form').reset();
                })
                .catch(error => {
                    showNotification('Gagal menambah barang: ' + error.message, 'error');
                });
        }

        // Handle edit barang
        function handleEditBarang(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat mengedit barang!', 'error');
                return;
            }
            
            const barangId = document.getElementById('edit-barang-id').value;
            const nama = document.getElementById('edit-nama-barang').value;
            const kategori = document.getElementById('edit-kategori-barang').value;
            const status = document.getElementById('edit-status-barang').value;
            const harga = parseInt(document.getElementById('edit-harga-barang').value);
            const stok = parseInt(document.getElementById('edit-stok-barang').value);
            const deskripsi = document.getElementById('edit-deskripsi-barang').value;
            
            const updatedBarang = {
                nama: nama,
                kategori: kategori,
                status: status,
                harga: harga,
                stok: stok,
                deskripsi: deskripsi,
                updated_at: new Date().toISOString()
            };
            
            // Update to Firebase
            database.ref('barang/' + barangId).update(updatedBarang)
                .then(() => {
                    showNotification('Barang berhasil diupdate!', 'success');
                    closeModal('edit-barang-modal');
                })
                .catch(error => {
                    showNotification('Gagal mengupdate barang: ' + error.message, 'error');
                });
        }

        // Handle tambah transaksi
        function handleTambahTransaksi(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menambah transaksi!', 'error');
                return;
            }
            
            const jenis = document.getElementById('jenis-transaksi').value;
            const jumlah = parseInt(document.getElementById('jumlah-transaksi').value);
            const keterangan = document.getElementById('keterangan-transaksi').value;
            const tanggal = document.getElementById('tanggal-transaksi').value;
            
            const newTransaksi = {
                jenis: jenis,
                jumlah: jumlah,
                keterangan: keterangan,
                tanggal: tanggal,
                created_at: new Date().toISOString()
            };
            
            // Save to Firebase
            database.ref('transaksi').push(newTransaksi)
                .then(() => {
                    showNotification('Transaksi berhasil ditambahkan!', 'success');
                    closeModal('tambah-transaksi-modal');
                    document.getElementById('tambah-transaksi-form').reset();
                })
                .catch(error => {
                    showNotification('Gagal menambah transaksi: ' + error.message, 'error');
                });
        }

        // ===============================
        // UTILITY FUNCTIONS
        // ===============================

        // Format currency to Dollar
        function formatDollar(amount) {
            if (isNaN(amount) || amount === null) {
                return '$ 0';
            }
            return '$ ' + amount.toLocaleString('en-US');
        }

        // Format date
        function formatDate(dateString) {
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        // Get status class for pesanan
        function getStatusClass(pesanan) {
            if (pesanan.sudah_dikasih) return 'status-success';
            if (pesanan.status === 'hutang') return 'status-danger';
            return 'status-warning';
        }

        // Get status text for pesanan
        function getStatusText(pesanan) {
            if (pesanan.sudah_dikasih) return 'Selesai';
            if (pesanan.status === 'hutang') return 'Hutang';
            return 'Proses';
        }

        // Calculate saldo kas
        function calculateSaldoKas() {
            return transaksiData.reduce((saldo, transaksi) => {
                return transaksi.jenis === 'pemasukan' ? 
                    saldo + transaksi.jumlah : 
                    saldo - transaksi.jumlah;
            }, 0);
        }

        // Mark pesanan as given - MODIFIED untuk handle items
        function markAsGiven(pesananId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menandai pesanan sudah diberikan!', 'error');
                return;
            }
            
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            showConfirmation(
                `Tandai pesanan ${pesanan.id} sebagai SELESAI?
                Semua items akan ditandai sebagai sudah diberikan.`,
                function() {
                    // Update semua items sebagai sudah diberikan
                    const updatedItems = pesanan.items.map(item => ({
                        ...item,
                        sudah_dikasih: true
                    }));
                    
                    // Update pesanan
                    database.ref('pesanan/' + pesananId).update({
                        sudah_dikasih: true,
                        items: updatedItems
                    })
                    .then(() => {
                        showNotification('Pesanan berhasil ditandai sudah diberikan!', 'success');
                        closeModal('detail-pesanan-modal');
                    })
                    .catch(error => {
                        showNotification('Gagal memperbarui pesanan: ' + error.message, 'error');
                    });
                },
                'warning'
            );
        }

        // Delete pesanan - MODIFIED dengan modal kustom
        function deletePesanan(pesananId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menghapus pesanan!', 'error');
                return;
            }
            
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            showDeleteConfirmation(
                `Apakah Anda yakin ingin menghapus pesanan ${pesanan.id}
               Customer: ${pesanan.customer} - Total: ${formatDollar(pesanan.total)}`,
                function() {
                    database.ref('pesanan/' + pesananId).remove()
                        .then(() => {
                            showNotification('Pesanan berhasil dihapus!', 'success');
                        })
                        .catch(error => {
                            showNotification('Gagal menghapus pesanan: ' + error.message, 'error');
                        });
                }
            );
        }

        // Delete barang - MODIFIED dengan modal kustom
        function deleteBarang(barangId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menghapus barang!', 'error');
                return;
            }
            
            const barang = barangData.find(b => b.id === barangId);
            if (!barang) return;
            
            showDeleteConfirmation(
                `Apakah Anda yakin ingin menghapus barang <strong>${barang.nama}</strong>?<br>
                <small style="color: var(--text-muted);">Kategori: ${barang.kategori} - Stok: ${barang.stok}</small>`,
                function() {
                    database.ref('barang/' + barangId).remove()
                        .then(() => {
                            showNotification('Barang berhasil dihapus!', 'success');
                        })
                        .catch(error => {
                            showNotification('Gagal menghapus barang: ' + error.message, 'error');
                        });
                }
            );
        }

        // Delete transaksi - MODIFIED dengan modal kustom
        function deleteTransaksi(transaksiId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menghapus transaksi!', 'error');
                return;
            }
            
            const transaksi = transaksiData.find(t => t.id === transaksiId);
            if (!transaksi) return;
            
            showDeleteConfirmation(
                `Apakah Anda yakin ingin menghapus transaksi ini?<br>
                <small style="color: var(--text-muted);">${transaksi.keterangan} - ${formatDollar(transaksi.jumlah)}</small>`,
                function() {
                    database.ref('transaksi/' + transaksiId).remove()
                        .then(() => {
                            showNotification('Transaksi berhasil dihapus!', 'success');
                        })
                        .catch(error => {
                            showNotification('Gagal menghapus transaksi: ' + error.message, 'error');
                        });
                }
            );
        }

        // Kosongkan keranjang - MODIFIED dengan modal kustom
        function kosongkanKeranjang() {
            if (cart.length === 0) {
                showNotification('Keranjang sudah kosong', 'info');
                return;
            }
            
            showConfirmation(
                'Apakah Anda yakin ingin mengosongkan keranjang?<br><small style="color: var(--text-muted);">Semua item dalam keranjang akan dihapus</small>',
                function() {
                    cart = [];
                    saveCartToStorage();
                    updateCartUI();
                    showNotification('Keranjang berhasil dikosongkan', 'success');
                },
                'warning'
            );
        }

        // ===============================
        // FUNGSI UNTUK EDIT PENERIMA PEMBAYARAN
        // ===============================

        // Fungsi untuk render section penerima pembayaran
        function renderPenerimaSection(pesanan) {
            if (pesanan.penerima_pembayaran) {
                return `
                    <div class="penerima-display">
                        <div class="penerima-info">
                            <span class="penerima-badge ${pesanan.uang_diberikan_ke_bendahara ? 'penerima-dibayar' : ''}">
                                ${pesanan.penerima_pembayaran}
                                ${pesanan.uang_diberikan_ke_bendahara ? ' âœ“' : ''}
                            </span>
                        </div>
                        ${isAdmin ? `
                        <button class="btn-edit" onclick="showEditPenerimaForm('${pesanan.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        ` : ''}
                    </div>
                `;
            } else {
                return `
                    <div class="penerima-display">
                        <span style="color: var(--text-muted); font-style: italic;">Belum ada penerima</span>
                        ${isAdmin ? `
                        <button class="btn-edit" onclick="showEditPenerimaForm('${pesanan.id}')">
                            <i class="fas fa-plus"></i> Tambah
                        </button>
                        ` : ''}
                    </div>
                `;
            }
        }

        // Fungsi untuk menampilkan form edit penerima
        function showEditPenerimaForm(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            const formHtml = `
                <div class="edit-penerima-form">
                    <div style="margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">
                        ${pesanan.penerima_pembayaran ? 'Edit Penerima Pembayaran' : 'Tambah Penerima Pembayaran'}
                    </div>
                    <div class="edit-penerima-row">
                        <div class="edit-penerima-input">
                            <select id="edit-penerima-select-${pesananId}" class="form-control" style="font-size: 0.85rem; padding: 0.4rem;">
                                <option value="">Pilih Penerima</option>
                                <option value="Zowed" ${pesanan.penerima_pembayaran === 'Zowed' ? 'selected' : ''}>Zowed</option>
                                <option value="Asap" ${pesanan.penerima_pembayaran === 'Asap' ? 'selected' : ''}>Asap</option>
                                <option value="Ruuna" ${pesanan.penerima_pembayaran === 'Ruuna' ? 'selected' : ''}>Ruuna</option>
                                <option value="Vyan" ${pesanan.penerima_pembayaran === 'Vyan' ? 'selected' : ''}>Vyan</option>
                                <option value="custom">Custom...</option>
                            </select>
                            <input type="text" id="edit-penerima-custom-${pesananId}" 
                                   class="form-control" 
                                   style="font-size: 0.85rem; padding: 0.4rem; margin-top: 0.3rem; display: none;" 
                                   placeholder="Masukkan nama penerima custom">
                        </div>
                        <div class="edit-penerima-actions">
                            <button class="btn-save" onclick="savePenerimaPembayaran('${pesananId}')">
                                <i class="fas fa-save"></i> Simpan
                            </button>
                            <button class="btn-cancel" onclick="cancelEditPenerima('${pesananId}')">
                                <i class="fas fa-times"></i> Batal
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById(`penerima-display-${pesananId}`).innerHTML = formHtml;
            
            // Setup event listener untuk select
            const selectElement = document.getElementById(`edit-penerima-select-${pesananId}`);
            const customInput = document.getElementById(`edit-penerima-custom-${pesananId}`);
            
            selectElement.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customInput.style.display = 'block';
                    customInput.focus();
                } else {
                    customInput.style.display = 'none';
                }
            });
            
            // Jika sebelumnya sudah ada custom value, tampilkan input
            if (pesanan.penerima_pembayaran && 
                !['Zowed', 'Asap', 'Ruuna', 'Vyan'].includes(pesanan.penerima_pembayaran)) {
                selectElement.value = 'custom';
                customInput.style.display = 'block';
                customInput.value = pesanan.penerima_pembayaran;
            }
        }

        // Fungsi untuk menyimpan penerima pembayaran
        function savePenerimaPembayaran(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            const selectElement = document.getElementById(`edit-penerima-select-${pesananId}`);
            const customInput = document.getElementById(`edit-penerima-custom-${pesananId}`);
            
            let penerimaValue = '';
            
            if (selectElement.value === 'custom') {
                penerimaValue = customInput.value.trim();
            } else {
                penerimaValue = selectElement.value;
            }
            
            if (!penerimaValue) {
                showNotification('Penerima pembayaran harus diisi!', 'error');
                return;
            }
            
            // Update ke Firebase
            database.ref('pesanan/' + pesananId).update({
                penerima_pembayaran: penerimaValue
            })
            .then(() => {
                showNotification('Penerima pembayaran berhasil diperbarui!', 'success');
                
                // Refresh tampilan penerima
                setTimeout(() => {
                    const updatedPesanan = pesananData.find(p => p.id === pesananId);
                    if (updatedPesanan) {
                        document.getElementById(`penerima-display-${pesananId}`).innerHTML = 
                            renderPenerimaSection(updatedPesanan);
                    }
                }, 500);
            })
            .catch(error => {
                showNotification('Gagal memperbarui penerima pembayaran: ' + error.message, 'error');
            });
        }

        // Fungsi untuk membatalkan edit penerima
        function cancelEditPenerima(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            // Kembalikan ke tampilan normal
            document.getElementById(`penerima-display-${pesananId}`).innerHTML = 
                renderPenerimaSection(pesanan);
        }

        // View pesanan detail dengan modal - MODIFIED dengan edit penerima
        function viewPesananDetail(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) {
                showNotification('Pesanan tidak ditemukan!', 'error');
                return;
            }

            // Hitung progress
            const givenItems = pesanan.items.filter(item => item.sudah_dikasih).length;
            const totalItems = pesanan.items.length;
            const progressPercentage = totalItems > 0 ? Math.round((givenItems / totalItems) * 100) : 0;

            // Buat HTML dengan layout yang lebih rapi dan kompak
            let detailHtml = `
                <div class="detail-pesanan-container">
                    <!-- Header -->
                    <div class="detail-pesanan-header">
                        <div class="detail-pesanan-title">Detail Pesanan</div>
                        <span class="badge ${pesanan.sudah_dikasih ? 'badge-success' : 'badge-warning'} badge-sm">
                            ${pesanan.sudah_dikasih ? 'SELESAI' : 'PROSES'}
                        </span>
                    </div>

                    <!-- Informasi Pesanan -->
                    <div class="info-section">
                        <div class="info-row">
                            <span class="info-label">ID Pesanan:</span>
                            <span class="info-value">${pesanan.id}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Customer:</span>
                            <span class="info-value">${pesanan.customer}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tanggal:</span>
                            <span class="info-value">${formatDate(pesanan.tanggal)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status Awal:</span>
                            <span class="info-value">
                                <span class="badge ${pesanan.status_pembayaran === 'lunas' ? 'badge-success' : pesanan.status_pembayaran === 'dp' ? 'badge-warning' : 'badge-danger'} badge-sm">
                                    ${pesanan.status_pembayaran === 'lunas' ? 'LUNAS' : pesanan.status_pembayaran === 'dp' ? 'DP' : 'BELUM BAYAR'}
                                </span>
                            </span>
                        </div>
                        
                        <!-- Bagian Penerima Pembayaran yang bisa diedit -->
                        <div class="info-row">
                            <span class="info-label">Penerima:</span>
                            <span class="info-value" id="penerima-display-${pesanan.id}">
                                ${renderPenerimaSection(pesanan)}
                            </span>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="compact-progress">
                        <div class="progress-row">
                            <span class="progress-label">Progress Pemberian Barang:</span>
                            <span class="progress-count">${givenItems}/${totalItems}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                        </div>
                    </div>

                    <!-- Header Items dengan Tombol Aksi -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem;">
                        <h4 style="margin: 0; font-size: 1rem;">Items Pesanan</h4>
                        ${isAdmin && !pesanan.sudah_dikasih ? `
                        <div style="display: flex; gap: 0.3rem;">
                            <button class="btn btn-success btn-compact" onclick="markAllItemsAsGiven('${pesanan.id}')">
                                <i class="fas fa-check-double"></i> Tandai Semua
                            </button>
                            <button class="btn btn-warning btn-compact" onclick="unmarkAllItemsAsGiven('${pesanan.id}')">
                                <i class="fas fa-times"></i> Batal Semua
                            </button>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Tabel Items -->
                    <table class="compact-table">
                        <thead>
                            <tr>
                                ${isAdmin && !pesanan.sudah_dikasih ? '<th width="40">âœ“</th>' : ''}
                                <th>NAMA BARANG</th>
                                <th width="60">STATUS</th>
                                <th width="80">HARGA</th>
                                <th width="50">QTY</th>
                                <th width="90">SUBTOTAL</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Tambahkan items
            pesanan.items.forEach((item, index) => {
                const subtotal = item.harga * item.quantity;
                const isGiven = item.sudah_dikasih || false;
                
                detailHtml += `
                    <tr class="${isGiven ? 'item-given-compact' : ''}">
                        ${isAdmin && !pesanan.sudah_dikasih ? `
                        <td>
                            <input type="checkbox" class="compact-checkbox" 
                                ${isGiven ? 'checked' : ''} 
                                onchange="toggleItemGiven('${pesanan.id}', ${index}, this.checked)">
                        </td>
                        ` : ''}
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.3rem;">
                                ${item.nama}
                                ${isGiven ? '<span class="badge badge-success badge-sm"><i class="fas fa-check"></i></span>' : ''}
                            </div>
                        </td>
                        <td>
                            <span class="status-badge-barang ${item.status === 'ready' ? 'status-ready' : 'status-preorder'} badge-sm">
                                ${item.status === 'ready' ? 'READY' : 'PRE-ORDER'}
                            </span>
                        </td>
                        <td>${formatDollar(item.harga)}</td>
                        <td>${item.quantity}</td>
                        <td>${formatDollar(subtotal)}</td>
                    </tr>
                `;
            });

            // Summary Section
            detailHtml += `
                        </tbody>
                    </table>

                    <!-- Ringkasan -->
                    <div class="compact-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span>${formatDollar(pesanan.subtotal || pesanan.total)}</span>
                        </div>
                        ${pesanan.diskon ? `
                        <div class="summary-row">
                            <span>Diskon:</span>
                            <span>-${formatDollar(pesanan.diskon)}</span>
                        </div>
                        ` : ''}
                        <div class="summary-total-row">
                            <span>Total:</span>
                            <span style="color: var(--success);">${formatDollar(pesanan.total)}</span>
                        </div>
                        ${pesanan.uang_dibayar > 0 ? `
                        <div class="summary-row">
                            <span>Uang Dibayar:</span>
                            <span>${formatDollar(pesanan.uang_dibayar)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Sisa:</span>
                            <span style="color: ${(pesanan.total - pesanan.uang_dibayar) > 0 ? 'var(--danger)' : 'var(--success)'}">
                                ${formatDollar(pesanan.total - pesanan.uang_dibayar)}
                            </span>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Tombol Aksi -->
                    <div class="compact-actions">
                        <button class="btn btn-info btn-compact" onclick="copyPesananItems('${pesanan.id}')">
                            <i class="fas fa-copy"></i> Salin Items
                        </button>
                        ${isAdmin && (pesanan.status_pembayaran !== 'lunas' || pesanan.uang_dibayar < pesanan.total) ? `
                        <button class="btn btn-success btn-compact" onclick="markPesananAsPaid('${pesanan.id}')">
                            <i class="fas fa-money-bill-wave"></i> Tandai Dibayar
                        </button>
                        ` : ''}
                        ${isAdmin && pesanan.penerima_pembayaran && !pesanan.uang_diberikan_ke_bendahara ? `
                        <button class="btn btn-primary btn-compact" onclick="markUangDiberikanKeBendahara('${pesanan.id}')">
                            <i class="fas fa-hand-holding-usd"></i> Kasih ke Bendahara
                        </button>
                        ` : ''}
                        ${isAdmin && !pesanan.sudah_dikasih ? `
                        <button class="btn btn-primary btn-compact" onclick="markAsGiven('${pesanan.id}')">
                            <i class="fas fa-check"></i> Selesai
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;

            // Tampilkan modal
            document.getElementById('detail-pesanan-content').innerHTML = detailHtml;
            
            // Set modal class untuk styling kompak
            document.getElementById('detail-pesanan-modal').classList.add('compact-modal');
            
            // Sembunyikan tombol footer modal karena sudah ada di content
            document.querySelector('.modal-footer').style.display = 'none';
            
            showModal('detail-pesanan-modal');
        }

        // ===============================
        // ITEM CHECKLIST MANAGEMENT
        // ===============================

        // Toggle status pemberian item
        function toggleItemGiven(pesananId, itemIndex, isGiven) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            // Update status item
            if (!pesanan.items[itemIndex]) return;
            
            // Buat salinan items untuk menghindari mutasi langsung
            const updatedItems = [...pesanan.items];
            updatedItems[itemIndex] = {
                ...updatedItems[itemIndex],
                sudah_dikasih: isGiven
            };
            
            // Update ke Firebase
            database.ref('pesanan/' + pesananId + '/items').set(updatedItems)
                .then(() => {
                    console.log(`âœ… Item ${itemIndex} berhasil diupdate: ${isGiven ? 'Diberikan' : 'Belum diberikan'}`);
                    
                    // Update progress bar
                    updateProgressBar(pesananId);
                    
                    // Cek apakah semua item sudah diberikan
                    checkIfAllItemsGiven(pesananId);
                })
                .catch(error => {
                    console.error('âŒ Gagal mengupdate status item:', error);
                    showNotification('Gagal mengupdate status item: ' + error.message, 'error');
                });
        }

        // Tandai semua item sebagai sudah diberikan
        function markAllItemsAsGiven(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            showConfirmation(
                'Tandai SEMUA items sebagai sudah diberikan?',
                function() {
                    const updatedItems = pesanan.items.map(item => ({
                        ...item,
                        sudah_dikasih: true
                    }));
                    
                    database.ref('pesanan/' + pesananId + '/items').set(updatedItems)
                        .then(() => {
                            showNotification('Semua items berhasil ditandai sebagai sudah diberikan!', 'success');
                            // Refresh modal
                            viewPesananDetail(pesananId);
                        })
                        .catch(error => {
                            showNotification('Gagal menandai semua items: ' + error.message, 'error');
                        });
                },
                'warning'
            );
        }

        // Batalkan semua tanda item sebagai diberikan
        function unmarkAllItemsAsGiven(pesananId) {
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            showConfirmation(
                'Batalkan tanda SEMUA items sebagai sudah diberikan?',
                function() {
                    const updatedItems = pesanan.items.map(item => ({
                        ...item,
                        sudah_dikasih: false
                    }));
                    
                    database.ref('pesanan/' + pesananId + '/items').set(updatedItems)
                        .then(() => {
                            showNotification('Tanda semua items berhasil dibatalkan!', 'success');
                            // Refresh modal
                            viewPesananDetail(pesananId);
                        })
                        .catch(error => {
                            showNotification('Gagal membatalkan tanda items: ' + error.message, 'error');
                        });
                },
                'warning'
            );
        }

        // ===============================
        // FUNGSI UNTUK MELIHAT DETAIL HUTANG
        // ===============================

        // Fungsi untuk melihat detail semua hutang
        function viewHutangDetail() {
            const hutangPesanan = pesananData.filter(p => 
                (p.status_pembayaran === 'belum' || p.status_pembayaran === 'dp') && 
                p.uang_dibayar < p.total
            );
            
            if (hutangPesanan.length === 0) {
                showNotification('Tidak ada piutang yang belum diterima!', 'info');
                return;
            }
            
            let detailHtml = `
                <div class="detail-pesanan-container">
                    <div class="detail-pesanan-header">
                        <div class="detail-pesanan-title">Detail Piutang</div>
                        <span class="badge badge-danger badge-sm">
                            ${hutangPesanan.length} PESANAN
                        </span>
                    </div>
                    
                    <div class="hutang-summary">
                        <h4 style="margin-bottom: 1rem; color: var(--danger);">Total Piutang: ${formatDollar(calculateTotalHutang())}</h4>
                        
                        <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            hutangPesanan.forEach(pesanan => {
                const sisaHutang = pesanan.total - pesanan.uang_dibayar;
                const persentaseBayar = Math.round((pesanan.uang_dibayar / pesanan.total) * 100);
                
                detailHtml += `
                    <div class="hutang-item">
                        <div>
                            <div class="hutang-customer">${pesanan.customer}</div>
                            <div class="hutang-status">
                                ${pesanan.id} â€¢ ${formatDate(pesanan.tanggal)} â€¢ 
                                ${pesanan.uang_dibayar > 0 ? `DP ${persentaseBayar}%` : 'BELUM BAYAR'}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="hutang-amount">${formatDollar(sisaHutang)}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">
                                Total: ${formatDollar(pesanan.total)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            detailHtml += `
                        </div>
                    </div>
                    
                    <div class="compact-actions">
                        <button class="btn btn-info btn-compact" onclick="copyHutangSummary()">
                            <i class="fas fa-copy"></i> Salin Ringkasan
                        </button>
                        <button class="btn btn-primary btn-compact" onclick="closeModal('detail-pesanan-modal')">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('detail-pesanan-content').innerHTML = detailHtml;
            showModal('detail-pesanan-modal');
        }

        // Fungsi untuk menyalin ringkasan hutang
        function copyHutangSummary() {
            const hutangPesanan = pesananData.filter(p => 
                (p.status_pembayaran === 'belum' || p.status_pembayaran === 'dp') && 
                p.uang_dibayar < p.total
            );
            
            let summaryText = `RINGKASAN PIUTANG - ${new Date().toLocaleDateString('id-ID')}\n\n`;
            let totalHutang = 0;
            
            hutangPesanan.forEach(pesanan => {
                const sisaHutang = pesanan.total - pesanan.uang_dibayar;
                totalHutang += sisaHutang;
                
                summaryText += `${pesanan.customer} - ${pesanan.id}\n`;
                summaryText += `Total: ${formatDollar(pesanan.total)} | `;
                summaryText += `Dibayar: ${formatDollar(pesanan.uang_dibayar)} | `;
                summaryText += `Sisa: ${formatDollar(sisaHutang)}\n\n`;
            });
            
            summaryText += `TOTAL PIUTANG: ${formatDollar(totalHutang)}\n`;
            summaryText += `JUMLAH PESANAN: ${hutangPesanan.length}`;
            
            navigator.clipboard.writeText(summaryText)
                .then(() => {
                    showNotification('Ringkasan piutang berhasil disalin!', 'success');
                })
                .catch(err => {
                    console.error('Gagal menyalin teks: ', err);
                    fallbackCopyTextToClipboard(summaryText);
                });
        }

        // ===============================
        // FUNGSI BENDHARA - UANG SUDAH DIKASIH KE BENDHARA
        // ===============================

        // Fungsi untuk menandai uang sudah diberikan ke bendahara
        function markUangDiberikanKeBendahara(pesananId) {
            if (!isAdmin) {
                showNotification('Hanya admin yang dapat menandai uang sudah diberikan ke bendahara!', 'error');
                return;
            }
            
            const pesanan = pesananData.find(p => p.id === pesananId);
            if (!pesanan) return;
            
            showConfirmation(
                `Tandai uang dari pesanan ${pesanan.id} sudah diberikan ke bendahara?
                Customer: ${pesanan.customer}
                Total: ${formatDollar(pesanan.total)}
                Penerima: ${pesanan.penerima_pembayaran}`,
                function() {
                    database.ref('pesanan/' + pesananId).update({
                        uang_diberikan_ke_bendahara: true
                    })
                    .then(() => {
                        showNotification(`Uang dari pesanan ${pesanan.id} berhasil ditandai sudah diberikan ke bendahara!`, 'success');
                        // Refresh UI
                        updatePesananUI();
                        updateLaporan();
                    })
                    .catch(error => {
                        showNotification('Gagal memperbarui status: ' + error.message, 'error');
                    });
                },
                'warning'
            );
        }

        // Fungsi untuk menampilkan laporan profit
        function showProfitReport() {
            const totalProfit = calculateTotalProfit();
            const profitBulanIni = calculateProfitBulanIni();
            
            // Filter pesanan yang menghasilkan profit
            const profitablePesanan = pesananData.filter(pesanan => {
                const profit = calculateProfitFromPesanan(pesanan);
                return profit > 0 && (pesanan.status_pembayaran === 'lunas' || pesanan.uang_dibayar >= pesanan.total);
            });
            
            let reportHtml = `
                <div class="detail-section">
                    <h4>Ringkasan Profit</h4>
                    <div class="profit-item">
                        <span>Total Profit Keseluruhan:</span>
                        <span style="color: var(--success); font-weight: 700;">${formatDollar(totalProfit)}</span>
                    </div>
                    <div class="profit-item">
                        <span>Profit Bulan Ini:</span>
                        <span style="color: var(--success);">${formatDollar(profitBulanIni)}</span>
                    </div>
                    <div class="profit-item">
                        <span>Total Pesanan Menguntungkan:</span>
                        <span>${profitablePesanan.length} pesanan</span>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>Detail Pesanan Menguntungkan</h4>
            `;
            
            if (profitablePesanan.length === 0) {
                reportHtml += `<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Belum ada pesanan yang menghasilkan profit</p>`;
            } else {
                reportHtml += `
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>ID Pesanan</th>
                                <th>Tanggal</th>
                                <th>Customer</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                profitablePesanan.forEach(pesanan => {
                    const profit = calculateProfitFromPesanan(pesanan);
                    reportHtml += `
                        <tr>
                            <td>${pesanan.id}</td>
                            <td>${formatDate(pesanan.tanggal)}</td>
                            <td>${pesanan.customer}</td>
                            <td style="color: var(--success); font-weight: 600;">${formatDollar(profit)}</td>
                        </tr>
                    `;
                });
                
                reportHtml += `</tbody></table>`;
            }
            
            reportHtml += `</div>`;
            
            // Tampilkan modal laporan profit
            document.getElementById('detail-pesanan-content').innerHTML = reportHtml;
            
            // Setup tombol
            const copyItemsBtn = document.getElementById('copy-items-btn');
            const markPaidBtn = document.getElementById('mark-paid-btn');
            
            copyItemsBtn.style.display = 'none';
            markPaidBtn.style.display = 'none';
            
            showModal('detail-pesanan-modal');
        }

        // ===============================
        // INITIALIZATION - DENGAN PROFIT SYSTEM
        // ===============================

        document.addEventListener('DOMContentLoaded', function() {
            // Cegah inisialisasi ganda
            if (appInitialized) {
                console.log('âš ï¸ Aplikasi sudah diinisialisasi sebelumnya');
                return;
            }
            
            console.log('ðŸš€ Initializing Brangkas System...');

            initializeApp();
            setupEventListeners();
            loadCartFromStorage();
            
            // Setup search and filter events
            document.getElementById('search-barang').addEventListener('input', updateBarangUI);
            document.getElementById('filter-kategori').addEventListener('change', updateBarangUI);
            document.getElementById('filter-status-barang').addEventListener('change', updateBarangUI);
            document.getElementById('search-keuangan').addEventListener('input', updateTransaksiUI);
            document.getElementById('filter-jenis').addEventListener('change', updateTransaksiUI);
            document.getElementById('filter-bulan').addEventListener('change', updateTransaksiUI);
            document.getElementById('laporan-bulan').addEventListener('change', updateLaporan);
            document.getElementById('generate-laporan-btn').addEventListener('click', updateLaporan);
            
            // Setup real-time indicator
            setInterval(() => {
                const indicator = document.getElementById('real-time-indicator');
                indicator.style.opacity = indicator.style.opacity === '0.7' ? '1' : '0.7';
            }, 2000);

            // Tambahkan tombol hapus laporan periode di halaman laporan
            const exportPdfBtn = document.querySelector('#laporan-page .btn-success');
            if (exportPdfBtn) {
                const deletePeriodBtn = document.createElement('button');
                deletePeriodBtn.className = 'btn btn-danger';
                deletePeriodBtn.innerHTML = '<i class="fas fa-trash"></i> Hapus Laporan Periode';
                deletePeriodBtn.onclick = deleteLaporanByPeriod;
                deletePeriodBtn.style.marginLeft = '10px';
                exportPdfBtn.parentNode.appendChild(deletePeriodBtn);
            }
            
            // Tambahkan tombol sinkronisasi di halaman keuangan
            const tambahTransaksiBtn = document.getElementById('tambah-transaksi-btn');
            if (tambahTransaksiBtn) {
                const syncBtn = document.createElement('button');
                syncBtn.className = 'btn btn-warning';
                syncBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Sync Pesanan Lunas';
                syncBtn.onclick = syncPaidOrdersToFinance;
                syncBtn.style.marginLeft = '10px';
                tambahTransaksiBtn.parentNode.appendChild(syncBtn);
                
                // Tambahkan tombol laporan profit
                const profitReportBtn = document.createElement('button');
                profitReportBtn.className = 'btn btn-success';
                profitReportBtn.innerHTML = '<i class="fas fa-chart-line"></i> Laporan Profit';
                profitReportBtn.onclick = showProfitReport;
                profitReportBtn.style.marginLeft = '10px';
                tambahTransaksiBtn.parentNode.appendChild(profitReportBtn);
            }
            
            console.log('ðŸš€ Brangkas System initialized with STATUS BARANG & PENERIMA PEMBAYARAN SYSTEM');
            appInitialized = true;
        });
    </script>
    <!-- Modal Detail Pesanan - MODIFIED -->
    <div class="modal" id="detail-pesanan-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title">Detail Pesanan</div>
                <button class="close-modal" onclick="closeModal('detail-pesanan-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="detail-pesanan-content">
                    <!-- Konten detail pesanan akan diisi oleh JavaScript -->
                </div>
            </div>
            <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid var(--dark-surface-light); display: flex; justify-content: space-between; align-items: center;">
                <div class="footer-actions-left">
                    <button class="btn btn-copy" id="copy-items-btn" style="display: none;">
                        <i class="fas fa-copy"></i> Salin Items
                    </button>
                </div>
                <div class="footer-actions-right">
                    <button class="btn btn-paid" id="mark-paid-btn" style="display: none;">
                        <i class="fas fa-money-bill-wave"></i> Tandai Sudah Dibayar
                    </button>
                    <button class="btn btn-primary" onclick="closeModal('detail-pesanan-modal')">
                        <i class="fas fa-times"></i> Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-icon" id="confirmation-icon">
                <i class="fas fa-question"></i>
            </div>
            <div class="confirmation-title" id="confirmation-title">Konfirmasi</div>
            <div class="confirmation-message" id="confirmation-message">
                Apakah Anda yakin ingin melakukan tindakan ini?
            </div>
            <div class="confirmation-actions">
                <button class="confirmation-btn cancel" onclick="hideConfirmation()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="confirmation-btn confirm" id="confirmation-confirm-btn">
                    <i class="fas fa-check"></i> Ya
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="confirmation-modal" id="delete-confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-icon danger">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="confirmation-title">Hapus Data</div>
            <div class="confirmation-message" id="delete-confirmation-message">
                Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.
            </div>
            <div class="confirmation-actions">
                <button class="confirmation-btn cancel" onclick="hideDeleteConfirmation()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="confirmation-btn delete" id="delete-confirm-btn">
                    <i class="fas fa-trash"></i> Hapus
                </button>
            </div>
        </div>
    </div>
</body>
</html>